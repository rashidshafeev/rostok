Directory Structure:
├── auth/
├── api/
│   ├── authenticationEndpoints.ts
│   ├── types.ts
│   ├── verificationEndpoints.ts
├── index.ts
├── lib/
├── model/
│   ├── userSlice.ts
├── types/
│   ├── index.ts
│   ├── UserState.ts
├── ui/
│   ├── modals/
│   │   ├── AuthModal.tsx
│   │   ├── AuthWithEmail.tsx
│   │   ├── CheckAuth.tsx
│   │   ├── index.ts
│   │   ├── LogoutModal.tsx
│   │   ├── Register.tsx
│   │   ├── ResetPassword.tsx
├── cart/
├── api/
│   ├── cartApi.ts
│   ├── index.ts
│   ├── types.ts
├── index.ts
├── lib/
│   ├── transfromData.ts
├── model/
│   ├── cartSlice.ts
│   ├── hooks/
│   │   ├── index.ts
│   │   ├── useAddToCart.ts
│   │   ├── useCart.ts
│   │   ├── useQuantityControl.ts
│   │   ├── useRemoveFromCart.ts
│   ├── index.ts
│   ├── types.ts
├── ui/
│   ├── Cart.tsx
│   ├── components/
│   │   ├── CartDetail.tsx
│   │   ├── CartItem.tsx
│   │   ├── CartItemLine.tsx
│   │   ├── CartOrderInfo.tsx
│   │   ├── index.ts
│   │   ├── MobileCartItem.tsx
│   │   ├── MobileToCheckoutBar.tsx
│   │   ├── RecommendedWithSection.tsx
│   │   ├── SelectCartItemButton.tsx
│   ├── controls/
│   │   ├── AddToCartButton.tsx
│   │   ├── index.ts
│   │   ├── QuantityControl.tsx
│   │   ├── RemoveFormCartButton.tsx
│   ├── index.ts
├── catalog/
├── CustomPagination.tsx
├── comparison/
├── api/
│   ├── comparisonApi.ts
│   ├── index.ts
│   ├── types.ts
├── index.ts
├── model/
│   ├── comparisonSlice.ts
│   ├── hooks/
│   │   ├── useComparison.ts
│   ├── index.ts
│   ├── types.ts
├── ui/
│   ├── controls/
│   │   ├── ComparisonButton.tsx
│   ├── index.ts
├── favorite/
├── api/
│   ├── favoritesEndpoints.ts
│   ├── index.ts
│   ├── types.ts
├── index.ts
├── model/
│   ├── favoriteSlice.ts
│   ├── hooks/
│   │   ├── useFavorites.ts
│   ├── index.ts
│   ├── types.ts
├── ui/
│   ├── controls/
│   │   ├── FavoriteButton.tsx
│   ├── index.ts
├── filters/
├── lib/
│   ├── index.ts
│   ├── queryParams/
│   │   ├── CatalogQueryParams.ts
│   │   ├── index.ts
├── modals/
├── index.ts
├── model/
│   ├── context.tsx
│   ├── types.ts
├── ui/
│   ├── ModalManager.tsx
│   ├── modals/
│   │   ├── AddOrganizationModal.tsx
│   │   ├── AddressModal/
│   │   │   ├── AddressBar.tsx
│   │   │   ├── AddressModal.tsx
│   │   ├── AllFiltersModal/
│   │   │   ├── AllFiltersModal.tsx
│   │   ├── CatalogModal.tsx
│   │   ├── CatalogModalMobile.tsx
│   │   ├── CitiesModal.tsx
│   │   ├── ConfirmationModal.tsx
│   │   ├── DeleteOrganizationModal.tsx
│   │   ├── FastOrderModal.tsx
│   │   ├── index.ts
│   │   ├── ModalSnackbar.tsx
│   │   ├── ModificationAttributesModal.tsx
│   │   ├── PickupPointModal.tsx
│   │   ├── QuestionModal.tsx
│   │   ├── ReviewModal.tsx
│   │   ├── SearchFiltersModal.tsx
│   │   ├── ShareCartModal.tsx
│   │   ├── ShareModal.tsx
│   │   ├── ShowSharedCartModal.tsx
│   │   ├── UpdateOrganizationModal.tsx
├── recent-items/
├── api/
│   ├── recentItemsApi.ts
│   ├── types.ts
├── index.ts
├── lib/
│   ├── hooks/
│   │   ├── useAddToRecentItems.ts
├── model/
│   ├── recentItemsSlice.ts
│   ├── types.ts
├── ui/
│   ├── RecentlyVisitedSection.tsx
├── storage/
├── lib/
│   ├── index.ts
│   ├── storageManagement.ts


File Contents:

================
src/features/auth/api/authenticationEndpoints.ts
================

import { api } from '@/shared/api/api';

export const authenticationEndpoints = api.injectEndpoints({
  endpoints: (builder) => ({
    registrationCheck: builder.mutation({
      query: (data) => ({
        url: '/api/User/check',
        method: 'POST',
        body: data,
      }),
    }),
    authWithEmail: builder.mutation({
      query: (data) => ({
        url: '/api/User/auth',
        method: 'POST',
        body: data,
      }),
    }),
    userRegister: builder.mutation({
      query: (data) => ({
        url: '/api/User/register',
        method: 'POST',
        body: data,
      }),
    }),
    resetPassword: builder.mutation({
      query: (email) => ({
        url: '/api/User/sendPasswordResetLink',
        method: 'POST',
        body: { email: email },
      }),
    }),
    changePassword: builder.mutation({
      query: (params) => ({
        url: '/api/Profile/updatePass',
        method: 'POST',
        body: params,
      }),
    }),
  }),
});

export const {
  useRegistrationCheckMutation,
  useAuthWithEmailMutation,
  useUserRegisterMutation,
  useResetPasswordMutation,
  useChangePasswordMutation,
} = authenticationEndpoints;

================
src/features/auth/api/types.ts
================

import type { ProductListCategoryChain } from '@/entities/category/ProductListCategoryChain';
import type { Product } from '@/entities/product/Product';
import type { User } from '@/entities/user/User';
import type { AdditionalServerResponseData } from '@/shared/types/AdditionalServerResponseData';

export interface CartData {
  items_count: number;
  quantity: number;
}

export interface FavoritesData {
  items_count: number;
}

export interface ComparisonData {
  items_count: number;
}

export interface GetUserDataResponse extends AdditionalServerResponseData {
  user: User;
  cart: CartData;
  favorites: FavoritesData;
  comparison: ComparisonData;
}

================
src/features/auth/api/verificationEndpoints.ts
================

import { api } from '@/shared/api/api';

export const verificationEndpoints = api.injectEndpoints({
  endpoints: (builder) => ({
    sendVerificationCode: builder.mutation({
      query: (data) => ({
        url: '/api/User/phone/sendVerificationCode',
        method: 'POST',
        body: data,
      }),
    }),
    confirmVerificationCode: builder.mutation({
      query: (data) => ({
        url: '/api/User/phone/confirmVerificationCode',
        method: 'POST',
        body: data,
      }),
    }),
  }),
});

export const {
  useSendVerificationCodeMutation,
  useConfirmVerificationCodeMutation,
} = verificationEndpoints;

================
src/features/auth/index.ts
================

export { userSlice } from './model/userSlice';
export * from './model/userSlice';
export * from './api/authenticationEndpoints';
export * from '../../entities/user/api/profileEndpoints';
export * from './api/verificationEndpoints';
export * from '../recent-items/api/recentItemsApi';

================
src/features/auth/model/userSlice.ts
================

import { createSlice } from '@reduxjs/toolkit';

import { getTokenFromCookies, saveTokenToCookies } from '@/shared/lib';

import type { UserState } from '@/features/auth/types';
import type { PayloadAction } from '@reduxjs/toolkit';

const initialState: UserState = {
  token: getTokenFromCookies(),
};

export const userSlice = createSlice({
  name: 'user',
  initialState: initialState,
  reducers: {
    setToken: (state, action: PayloadAction<string>) => {
      saveTokenToCookies(action.payload);
      state.token = action.payload;
    },
  },
});

export const { setToken } = userSlice.actions;
export default userSlice.reducer;

================
src/features/auth/types/index.ts
================

export * from './GetUserDataResponse';
export * from './User';
export * from './UserState';

================
src/features/auth/types/UserState.ts
================

export interface UserState {
  token: string | null;
}

================
src/features/auth/ui/modals/AuthModal.tsx
================

// src/AuthModal/AuthModal.tsx
import React, { useState } from 'react';

import { KeyboardArrowLeft } from '@mui/icons-material';
import { Modal, Box } from '@mui/material';
 
import { useModal } from '@/features/modals/model/context';
import modalLogo from '@/shared/assets/images/modal-logo.svg';

import { AuthWithEmail } from "./AuthWithEmail";
import { CheckAuth } from "./CheckAuth";
import { ResetPassword } from './ResetPassword';
import { Register } from './Register';


export const AuthModal = () => {
  const { hideModal, modalContent, isModalVisible } = useModal();
  const [content, setContent] = useState(modalContent?.content || 'checkAuth');
  const [login, setLogin] = useState('');

  if (!isModalVisible) return null;

  return (
    <Modal
      open={isModalVisible ? modalContent.type === 'auth' : null}
      onClose={() => hideModal()}
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none pt-10 pb-4 px-4 mm:py-10 mm:px-8 max-w-[500px] w-[95%] mm:w-full">
        {content !== 'checkAuth' ? <span
            onClick={() => {
              setContent('checkAuth');
              //   setResError(null);
              //   reset();
            }}
            className='absolute top-3 left-3 text-sm text-colBlack font-semibold cursor-pointer pr-4'
          >
            <KeyboardArrowLeft className='!w-4 pb-[2px]' />
            Назад
          </span> : null}
        <span
          onClick={() => hideModal()}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>
        <img className="w-[116px] mb-4 mx-auto" src={modalLogo} alt="*" />
        {content === 'checkAuth' ? <CheckAuth setContent={setContent} setLogin={setLogin} /> : null}
        {content === 'authWithEmail' ? <AuthWithEmail hideModal={hideModal} setContent={setContent} login={login} /> : null}
        {content === 'resetPassword' ? <ResetPassword
            // control={control}
            // handleSubmit={handleSubmit}
            setContent={setContent}
          />
         : null}
        {content === 'register' ? <Register hideModal={hideModal} setContent={setContent} login={login}/> : null}
      </Box>
    </Modal>
  );
};

================
src/features/auth/ui/modals/AuthWithEmail.tsx
================

// src/AuthModal/AuthWithEmail.tsx

import React, { useState } from 'react';

import { Visibility, VisibilityOff } from '@mui/icons-material';
import { Controller, useForm } from 'react-hook-form';
import { useDispatch, useSelector } from 'react-redux';
import { useNavigate } from 'react-router-dom';
import { toast } from 'sonner';

import { useAuthWithEmailMutation } from '@/features/auth/api/authenticationEndpoints';
import { setToken } from '@/features/auth/model/userSlice';
import { useSendCartMutation } from '@/features/cart/api/cartApi';
import { setCart } from '@/features/cart/model/cartSlice';
import { useSendComparisonMutation } from '@/features/comparison/api/comparisonApi';
import { setComparison } from '@/features/comparison/model/comparisonSlice';
import { useSendFavoritesMutation } from '@/features/favorite/api/favoritesEndpoints';
import { setFavorite } from '@/features/favorite/model/favoriteSlice';
import CTextField from '@/shared/ui/inputs/CTextField';
import { LoadingSmall } from '@/shared/ui/Loader';

export const AuthWithEmail = ({
  hideModal,
  setContent,
  login: enteredLogin,
}) => {
  const {
    control,
    handleSubmit,
    reset,
    register,
    watch,
    formState: { errors, isValid },
  } = useForm({ mode: 'onChange' });

  const [isShow, setIsShow] = useState(false);
  const [responseError, setResponseError] = useState(null);

  const cart = useSelector((state) => state.cart.cart);
  const comparison = useSelector((state) => state.comparison.comparison);
  const favorite = useSelector((state) => state.favorite.favorite);

  const dispatch = useDispatch();
  const navigate = useNavigate();

  const [authWithEmail, { isLoading: authIsLoading }] =
    useAuthWithEmailMutation();
  const [sendCart, { isLoading: sendCartIsloading }] = useSendCartMutation();
  const [sendFavorites, { isLoading: sendFavoritesIsloading }] =
    useSendFavoritesMutation();
  const [sendComparison, { isLoading: sendComparisonIsloading }] =
    useSendComparisonMutation();

  const isLoading =
    authIsLoading ||
    sendCartIsloading ||
    sendComparisonIsloading ||
    sendFavoritesIsloading;

  const sendAndClearData = async () => {
    try {
      await sendCart({
        items: cart.map((item) => ({
          id: item.id,
          quantity: item.quantity,
          selected: item.selected ? 1 : 0,
        })),
      });
      await sendComparison(comparison.map((item) => item.id));
      await sendFavorites(favorite.map((item) => item.id));
      sessionStorage.removeItem('cart');
      sessionStorage.removeItem('comparison');
      sessionStorage.removeItem('favorite');
      dispatch(
        setCart({
          cart: [],
          selected: {
            amount: 0,
            count: 0,
            quantity: 0,
            discount: 0,
          },
          total: {
            amount: 0,
            count: 0,
            quantity: 0,
            discount: 0,
          },
          currency: {
            code: 'RUB',
            symbol: '₽',
            title: 'Рубль',
          },
        })
      );
      dispatch(setComparison([]));
      dispatch(setFavorite([]));
    } catch (error) {
      console.error('Error sending data to server:', error);
    }
  };

  const onSubmitAuthWithEmail = async (data) => {
    try {
      const auth = await authWithEmail(data);
      if (auth.data.success) {
        dispatch(setToken(auth.data.token));
        await sendAndClearData();
        hideModal();
        navigate('/');
        return;
      } else if (!auth.data.success) {
        setResponseError(auth.data.err);
      }
    } catch (error) {
      console.error('Authorization failed:', error);
    }
  };

  return (
    // <Box>
    <form onSubmit={handleSubmit(onSubmitAuthWithEmail)}>
      <Controller
        name="login"
        control={control}
        defaultValue={enteredLogin.login}
        render={({ field }) => (
          <CTextField
            label="Эл. почта / телефон"
            type="text"
            required={true}
            {...field}
          />
        )}
      />
      <div className="flex relative mt-5">
        <Controller
          name="password"
          control={control}
          defaultValue=""
          render={({ field }) => (
            <CTextField
              label="Пароль"
              type={isShow ? 'text' : 'password'}
              required={true}
              {...field}
            />
          )}
        />
        {isShow ? (
          <VisibilityOff
            onClick={() => setIsShow(false)}
            className="absolute top-1/2 -translate-y-1/2 right-3 opacity-60 cursor-pointer"
          />
        ) : (
          <Visibility
            onClick={() => setIsShow(true)}
            className="absolute top-1/2 -translate-y-1/2 right-3 opacity-60 cursor-pointer"
          />
        )}
      </div>
      {responseError ? <p className="text-xs mt-1">{responseError}</p> : null}

      <button className="w-full h-10 px-6 bg-colGreen rounded mt-5 text-white font-semibold flex justify-center items-center">
        {!isLoading ? <>Войти</> : null}
        {isLoading ? <LoadingSmall extraStyle="white" /> : null}
      </button>
      <p
        onClick={() => setContent('resetPassword')}
        className="text-center mt-4 text-colGray2 font-medium cursor-pointer"
      >
        Забыли пароль?
      </p>
    </form>
    // </Box>
  );
};

================
src/features/auth/ui/modals/CheckAuth.tsx
================

// src/AuthModal/CheckAuth.tsx

import { KeyboardArrowRight } from '@mui/icons-material';
import { Controller, useForm } from 'react-hook-form';

import { useRegistrationCheckMutation } from '@/features/auth';
import CTextField from '@/shared/ui/inputs/CTextField';
import { LoadingSmall } from '@/shared/ui/Loader';

export const CheckAuth = ({ setContent, setLogin }) => {
  const {
    control,
    handleSubmit,
    reset,
    register,
    watch,
    formState: { errors, isValid },
  } = useForm({ mode: 'onChange' });

  const [registrationCheck, { isLoading }] = useRegistrationCheckMutation();

  const onSubmitAuthCheck = async (data) => {
    try {
      const check = await registrationCheck(data);
      if (check.data.success) {
        console.log(check.data);
        if (
          check.data.login_type === 'email' ||
          check.data.login_type === 'phone'
        ) {
          setLogin({ type: check.data.login_type, login: data.login });
          setContent('authWithEmail');
        }
      } else {
        setLogin({ type: check.data.login_type, login: data.login });
        setContent('register');
      }
    } catch (error) {
      console.log(error);
    }
  };

  return (
    // <Box>
    <>
      <h1 className="text-2xl mm:text-3xl text-colBlack text-center pt-2 pb-8 font-semibold">
        Вход или Регистрация
      </h1>
      <form onSubmit={handleSubmit(onSubmitAuthCheck)}>
        <Controller
          name="login"
          control={control}
          defaultValue=""
          render={({ field }) => (
            <CTextField
              label="Эл. почта / телефон"
              type="text"
              required={true}
              onChange={field.onChange}
              value={field.value}
            />
          )}
        />
        <button
          disabled={isLoading}
          className="w-full h-10 px-6 bg-colGreen rounded mt-5 text-white font-semibold flex justify-center items-center"
        >
          {!isLoading ? (
            <>
              Продолжить
              <KeyboardArrowRight className="!w-5" />
            </>
          ) : null}
          {isLoading ? <LoadingSmall extraStyle="white" /> : null}
        </button>
      </form>
    </>
    // </Box>
  );
};

================
src/features/auth/ui/modals/index.ts
================

export { AuthModal } from './AuthModal';
export { CheckAuth } from './CheckAuth';
export { AuthWithEmail } from './AuthWithEmail';
export { ResetPassword } from './ResetPassword';
export { Register } from './Register';
export { LogoutModal } from './LogoutModal';

================
src/features/auth/ui/modals/LogoutModal.tsx
================

import React from 'react';

import { Box, Modal } from '@mui/material';
import { useDispatch } from 'react-redux';
import { useNavigate } from 'react-router-dom';

import { setToken } from '@/features/auth/model/userSlice';
import { useModal } from '@/features/modals/model/context';

export const LogoutModal = () => {
  const dispatch = useDispatch();
  const navigate = useNavigate();

  const { hideModal, modalContent, isModalVisible } = useModal();

  const logout = () => {
    dispatch(setToken());
    hideModal();
    navigate('/');
  };

  if (!isModalVisible) return null;

  return (
    <Modal
      open={isModalVisible ? modalContent.type === 'logout' : null}
      onClose={hideModal}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none px-6 py-8 max-w-[480px] w-[95%] mm:w-full">
        <span
          onClick={hideModal}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>
        <h1 className="pt-1 text-2xl mm:text-3xl text-colBlack font-semibold">
          Выход из аккаунта
        </h1>
        <p className="text-colBlack my-2">
          Вы уверены, что хотите выйти из аккаунта?
        </p>
        <div className="flex space-x-3 pt-5">
          <button
            onClick={() => hideModal()}
            className="w-1/2 h-[38px] px-6 border border-colGreen bg-white rounded text-colGreen font-semibold"
          >
            Отменить
          </button>
          <button
            onClick={logout}
            className="w-1/2 h-[38px] px-6 bg-colGreen rounded text-white font-semibold"
          >
            Да
          </button>
        </div>
      </Box>
    </Modal>
  );
};

================
src/features/auth/ui/modals/Register.tsx
================

// src/AuthModal/Register.tsx

import { useEffect, useState } from 'react';

import { Visibility, VisibilityOff } from '@mui/icons-material';
import { Checkbox, FormControlLabel } from '@mui/material';
import { Controller, FormProvider, useForm } from 'react-hook-form';
import { useDispatch, useSelector } from 'react-redux';
import { NavLink, useNavigate } from 'react-router-dom';
import { toast } from 'sonner';

import { useUserRegisterMutation } from '@/features/auth';
import { setToken } from '@/features/auth/model/userSlice';
import { useSendCartMutation } from '@/features/cart/api/cartApi';
import { setCart } from '@/features/cart/model/cartSlice';
import { useSendComparisonMutation } from '@/features/comparison/api/comparisonApi';
import { setComparison } from '@/features/comparison/model/comparisonSlice';
import { useSendFavoritesMutation } from '@/features/favorite/api/favoritesEndpoints';
import { setFavorite } from '@/features/favorite/model/favoriteSlice';
import PhoneVerificationField from '@/helpers/PhoneVerificationField/PhoneVerificationField';
import CTextField from '@/shared/ui/inputs/CTextField';
import { LoadingSmall } from '@/shared/ui/Loader';

export const Register = ({ hideModal, login: enteredLogin }) => {
  const methods = useForm({ mode: 'onSubmit' });
  const {
    control,
    handleSubmit,
    reset,
    register,
    watch,
    trigger,
    formState: { errors, isValid },
  } = methods;
  const password = watch('password');
  const [resError, setResError] = useState(null);
  const [showPassword, setShowPassword] = useState(false);
  const [showPasswordConfirm, setShowPasswordConfirm] = useState(false);

  const cart = useSelector((state) => state.cart.cart);
  const comparison = useSelector((state) => state.comparison.comparison);
  const favorite = useSelector((state) => state.favorite.favorite);

  const dispatch = useDispatch();
  const navigate = useNavigate();

  const [userRegister, { isLoading: registerIsLoading }] =
    useUserRegisterMutation();
  const [sendCart, { isLoading: sendCartIsloading }] = useSendCartMutation();
  const [sendFavorites, { isLoading: sendFavoritesIsloading }] =
    useSendFavoritesMutation();
  const [sendComparison, { isLoading: sendComparisonIsloading }] =
    useSendComparisonMutation();

  const isLoading =
    registerIsLoading ||
    sendCartIsloading ||
    sendComparisonIsloading ||
    sendFavoritesIsloading;

  useEffect(() => {
    if (enteredLogin) {
      reset({
        email: enteredLogin.type === 'email' ? enteredLogin.login : '',
        phone:
          enteredLogin.type === 'phone' ? enteredLogin.login.slice(-10) : '',
      });
    }
  }, [enteredLogin, reset]);

  const sendAndClearData = async () => {
    try {
      await sendCart({
        items: cart.map((item) => ({
          id: item.id,
          quantity: item.quantity,
          selected: item.selected ? 1 : 0,
        })),
      });
      await sendComparison(comparison.map((item) => item.id));
      await sendFavorites(favorite.map((item) => item.id));
      sessionStorage.removeItem('cart');
      sessionStorage.removeItem('comparison');
      sessionStorage.removeItem('favorite');
      dispatch(
        setCart({
          cart: [],
          selected: [],
          itemsQuantity: 0,
          selectedQuantity: 0,
        })
      );
      dispatch(setComparison([]));
      dispatch(setFavorite([]));
    } catch (error) {
      console.error('Error sending data to server:', error);
    }
  };

  const onSubmitRegister = async (data) => {
    const sendData = {
      name: data.name,
      phone: data.phone,
      email: data.email,
      password: data.password,
      // privacyPolicy: data.privacyPolicy,
      // legalRepresentative: data.legalRepresentative,
    };

    try {
      const auth = await userRegister(sendData);
      if (auth?.data?.success) {
        dispatch(setToken(auth?.data?.token));
        await sendAndClearData();
        hideModal();
        navigate('/profile/orders');
        toast('Регистрация прошла успешно');

        return;
      } else if (!auth?.data?.success) {
        toast(`Не удалось зарегистрироваться. ${auth?.data?.err}`);
      }
    } catch (error) {
      console.error('Registration failed:', error);
    }

    hideModal();
    navigate('/');
    return;
  };

  return (
    <>
      <h1 className="text-3xl text-colBlack text-center py-5 font-semibold">
        Регистрация
      </h1>
      <FormProvider {...methods}>
        <form onSubmit={handleSubmit(onSubmitRegister)}>
          <div className="w-full space-y-5">
            <div>
              <Controller
                name="name"
                control={control}
                defaultValue=""
                rules={{
                  required: 'Поле обязательно к заполнению!',
                }}
                render={({ field }) => (
                  <CTextField label="Имя" type="text" {...field} />
                )}
              />
              {errors?.name ? (
                <p className="text-red-500 mt-1 text-xs font-medium">
                  {errors?.name?.message || 'Error!'}
                </p>
              ) : null}
            </div>
            <div>
              <PhoneVerificationField
                defaultValue={enteredLogin?.login.slice(-10)}
              />
            </div>
            {/* <div>
              <Controller
                name="email"
                control={control}
                defaultValue=""
                required
                rules={{
                  required: "Поле обязательно к заполнению!",
                  pattern: {
                    value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,
                    message: "Введите корректный адрес электронной почты",
                  },
                }}
                render={({ field }) => (
                  <CTextField
                    label="Электронная почта"
                    type="email"
                    {...field}
                    // onChange={(e) => {
                    //   field.onChange(e);
                    //   trigger("email"); // trigger validation
                    // }}
                  />
                )}
              />
              {errors?.email && (
                <p className="text-red-500 mt-1 text-xs font-medium">
                  {errors?.email?.message || "Error!"}
                </p>
              )}
            </div> */}
            <div>
              <div className="flex relative mt-5">
                <Controller
                  name="password"
                  control={control}
                  defaultValue=""
                  // rules={{
                  //   validate: (value) => {
                  //     if (!/^(?=.*[a-z])(?=.*[A-Z])/.test(value)) {
                  //       return "Требуется хотя бы одна строчная и прописная буква!";
                  //     }
                  //     if (!/(?=.*\d)/.test(value)) {
                  //       return "Требуется хотя бы одна цифра!";
                  //     }
                  //     if (!/(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?])/.test(value)) {
                  //       return "Требуется хотя бы один специальный символ!";
                  //     }
                  //     if (value.length < 8) {
                  //       return "Минимальная длина пароля - 8 символов!";
                  //     }
                  //     return true;
                  //   },
                  // }}
                  render={({ field }) => (
                    <CTextField
                      label="Пароль"
                      type={`${showPassword ? 'text' : 'password'}`}
                      {...field}
                    />
                  )}
                />
                {showPassword ? (
                  <VisibilityOff
                    onClick={() => setShowPassword(false)}
                    className="absolute top-5 -translate-y-1/2 right-3 opacity-60 cursor-pointer"
                  />
                ) : (
                  <Visibility
                    onClick={() => setShowPassword(true)}
                    className="absolute top-5 -translate-y-1/2 right-3 opacity-60 cursor-pointer"
                  />
                )}
              </div>
              {errors?.password ? (
                <p className="text-red-500 mt-1 text-xs font-medium">
                  {errors?.password.message || 'Error!'}
                </p>
              ) : null}
            </div>
            <div>
              <div className="flex relative mt-5">
                <Controller
                  name="confirmPassword"
                  control={control}
                  defaultValue=""
                  rules={{
                    validate: (value) => {
                      if (value !== password) {
                        return 'Пароли не совпадают!';
                      }
                      return true;
                    },
                  }}
                  render={({ field }) => (
                    <CTextField
                      label="Подтвердите пароль"
                      type={`${showPasswordConfirm ? 'text' : 'password'}`}
                      {...field}
                      onChange={(e) => {
                        field.onChange(e);
                        trigger('confirmPassword'); // trigger validation
                      }}
                    />
                  )}
                />
                {showPasswordConfirm ? (
                  <VisibilityOff
                    onClick={() => setShowPasswordConfirm(false)}
                    className="absolute top-1/2 -translate-y-1/2 right-3 opacity-60 cursor-pointer"
                  />
                ) : (
                  <Visibility
                    onClick={() => setShowPasswordConfirm(true)}
                    className="absolute top-1/2 -translate-y-1/2 right-3 opacity-60 cursor-pointer"
                  />
                )}
              </div>
              {errors?.confirmPassword ? (
                <p className="text-red-500 mt-1 text-xs font-medium">
                  {errors?.confirmPassword?.message || 'Error!'}
                </p>
              ) : null}
            </div>
          </div>
          <FormControlLabel
            control={
              <Checkbox
                {...register('legalRepresentative')}
                sx={{
                  color: '#15765B',
                  '&.Mui-checked': {
                    color: '#15765B',
                  },
                }}
              />
            }
            label={
              <span className="text-sm font-medium text-colBlack">
                Я представитель юридического лица или ИП
              </span>
            }
          />
          {resError ? (
            <p className="text-red-500 mt-1 text-sm font-medium">{resError}</p>
          ) : null}
          <button
            type="submit"
            disabled={!isValid}
            className={`${
              isValid ? 'bg-colGreen' : 'bg-colGray'
            } w-full h-10 px-6 rounded my-2 text-white font-semibold flex justify-center items-center`}
          >
            {!registerIsLoading ? <>Зарегистрироваться</> : null}
            {registerIsLoading ? <LoadingSmall extraStyle="white" /> : null}
          </button>
          <FormControlLabel
            sx={{
              display: 'flex',
              alignItems: 'flex-start',
            }}
            control={
              <Checkbox
                {...register('privacyPolicy')}
                defaultChecked
                required
                sx={{
                  color: '#15765B',
                  padding: '0 9px',
                  '&.Mui-checked': {
                    color: '#15765B',
                  },
                }}
              />
            }
            label={
              <p className="text-xs leading-[14px] text-colDarkGray">
                Я даю согласие на обработку моих персональных данных и принимаю
                условия{' '}
                <NavLink className="text-colGreen" to="#">
                  Пользовательского соглашения
                </NavLink>{' '}
                и{' '}
                <NavLink className="text-colGreen" to="#">
                  Политики обработки персональных данных
                </NavLink>
              </p>
            }
          />
        </form>
      </FormProvider>
    </>
    // </Box>
  );
};

================
src/features/auth/ui/modals/ResetPassword.tsx
================

// src/AuthModal/ResetPassword.tsx

import { useState } from 'react';

import { KeyboardArrowLeft } from '@mui/icons-material';
import { Box } from '@mui/material';
import { Controller, useForm } from 'react-hook-form';

import { useResetPasswordMutation } from '@/features/auth';
import CTextField from '@/shared/ui/inputs/CTextField';
import { Loading, LoadingSmall } from '@/shared/ui/Loader';

export const ResetPassword = ({ setContent }) => {
  const {
    control,
    handleSubmit,
    reset,
    register,
    watch,
    formState: { errors, isValid },
  } = useForm({ mode: 'onChange' });

  const [resPassword, setResPassword] = useState({
    successTxt: null,
    errorTxt: null,
  });

  const [resetPassword, { isLoading }] = useResetPasswordMutation();

  const onSubmitResetPassword = async (data) => {
    try {
      const auth = await resetPassword(data.email);
      if (auth?.data?.success) {
        setResPassword({
          successTxt: auth?.data?.message,
          errorTxt: null,
        });
      } else {
        setResPassword({ successTxt: null, errorTxt: auth?.data?.err });
      }
    } catch (error) {
      setResPassword({ successTxt: null, errorTxt: 'Что-то пошло не так' });
    }
  };

  return (
    // <Box>
    <>
      <h1 className="text-3xl text-colBlack text-center py-5 font-semibold">
        Сброс пароля
      </h1>
      <form onSubmit={handleSubmit(onSubmitResetPassword)}>
        <Controller
          name="email"
          control={control}
          defaultValue=""
          render={({ field }) => (
            <CTextField
              label="Эл. почта"
              type="text"
              required={true}
              {...field}
            />
          )}
        />
        <button className="w-full h-10 px-6 bg-colGreen rounded mt-5 text-white font-semibold">
          {!isLoading ? <>Сбросить пароль</> : null}
          {isLoading ? <LoadingSmall extraStyle="white" /> : null}
        </button>
        {/* <p onClick={() => setContent('authWithEmail')} className="text-center mt-4 text-colGray2 font-medium cursor-pointer">
                    <KeyboardArrowLeft className="!w-5" /> Назад
                </p> */}
        {/* {isLoading && <Loading />} */}
        {resPassword.successTxt ? (
          <p className="text-center mt-4 text-green-500 font-medium">
            {resPassword.successTxt}
          </p>
        ) : null}
        {resPassword.errorTxt ? (
          <p className="text-center mt-4 text-red-500 font-medium">
            {resPassword.errorTxt}
          </p>
        ) : null}
      </form>
    </>
    // </Box>
  );
};

================
src/features/cart/api/cartApi.ts
================

import { api } from '@/shared/api/api';

import type {
  GetUserCartResponse,
  SendCartResponse,
  SendCartRequest,
} from './types';
import type { AdditionalServerResponseData } from '@/shared/types/AdditionalServerResponseData';
import type { ProductListRequest } from '@/shared/types/ProductListRequest';

export const cartEndpoints = api.injectEndpoints({
  endpoints: (builder) => ({
    getSuggestions: builder.mutation({
      query: (params) => ({
        url: '/api/Products/search/suggestions',
        method: 'POST',
        body: params,
      }),
    }),
    getUserCart: builder.query<GetUserCartResponse, void>({
      query: () => '/api/ProductsCart/get',
      providesTags: [{ type: 'Cart', id: 'LIST' }],
    }),
    sendCart: builder.mutation<SendCartResponse, SendCartRequest>({
      query: (data) => ({
        url: '/api/ProductsCart/set',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: (result, error, { products }) => [
        { type: 'Cart', id: 'LIST' },
        { type: 'User', id: 'DATA' },
      ],
    }),
    removeFromCart: builder.mutation<
      AdditionalServerResponseData,
      ProductListRequest
    >({
      query: (data) => ({
        url: '/api/ProductsCart/delete',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: (result, error, { products }) => [
        { type: 'Cart', id: 'LIST' },
        { type: 'User', id: 'DATA' },
      ],
    }),
    getCartShareCode: builder.mutation({
      query: () => ({
        url: '/api/ProductsCart/share/create',
        method: 'POST',
      }),
    }),
    getCartShareItemsByCode: builder.mutation({
      query: (data) => ({
        url: '/api/ProductsCart/share/get',
        method: 'POST',
        body: data,
      }),
    }),
    addSharedCart: builder.mutation({
      query: (data) => ({
        url: '/api/ProductsCart/share/add',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: [
        { type: 'Cart', id: 'LIST' },
        { type: 'User', id: 'DATA' },
      ],
    }),
  }),
});

// Export hooks for cart endpoints
export const {
  useSendCartMutation,
  useGetSuggestionsMutation,
  useGetUserCartQuery,
  useRemoveFromCartMutation,
  useGetCartShareCodeMutation,
  useGetCartShareItemsByCodeMutation,
  useAddSharedCartMutation,
} = cartEndpoints;

================
src/features/cart/api/index.ts
================

export * from './cartApi';
export * from './types';

================
src/features/cart/api/types.ts
================

import type { ServerCartState } from '../';
import type { AdditionalServerResponseData, PriceType } from '@/shared/types';

export interface GetUserCartResponse
  extends AdditionalServerResponseData,
    ServerCartState {}

export interface SendCartPayload {
  id: number;
  quantity: number;
  selected: boolean;
}

export type SendCartRequest = SendCartPayload | { items: SendCartPayload[] };

export interface SendCartResponse extends AdditionalServerResponseData {
  data: [];
  total_amount: number;
  total_quantity: number;
}
export interface GetCartItemPriceResponse extends AdditionalServerResponseData {
  data: null | {
    item_id: number;
    price: PriceType;
  };
  total_amount: number;
  total_quantity: number;
}

export interface GetCartItemPriceRequest {
  item_id: number;
  quantity: number;
}

export interface GetCartShareLinkResponse {
  data: string;
}

================
src/features/cart/index.ts
================

export * from './ui';
export * from './api';
export * from './model';
export * from './lib/transfromData';

================
src/features/cart/lib/transfromData.ts
================

import type {
  ServerCartState,
  LocalCartState,
} from '@/features/cart/model/types';

export const transformServerCartToLocalCart = (
  serverCart: ServerCartState
): LocalCartState => ({
  cart: serverCart.data,
  total: serverCart.total,
  selected: serverCart.selected,
  currency: serverCart.current_currency,
});

================
src/features/cart/model/cartSlice.ts
================

import { createSlice } from '@reduxjs/toolkit';

import { saveToSessionStorage } from '@/features/storage/lib';
import { getTokenFromCookies } from '@/shared/lib';

import type { LocalCartState } from './types';
import type { PriceType } from '@/entities/price';
import type { Product } from '@/entities/product';
import type { PayloadAction } from '@reduxjs/toolkit';

const initialState: LocalCartState = {
  cart: [],
  total: {
    items_count: 0,
    quantity: 0,
    price_before_discount: 0,
    discount: 0,
    price_after_discount: 0,
  },
  selected: {
    items_count: 0,
    quantity: 0,
    price_before_discount: 0,
    discount: 0,
    price_after_discount: 0,
  },
  currency: {
    code: 'RUB',
    title: 'Рубль',
    symbol: '₽',
  },
};

const updateTotals = (state: LocalCartState) => {
  let totalItemsCount = 0;
  let totalQuantity = 0;
  let totalPriceBeforeDiscount = 0;
  let totalDiscount = 0;
  let selectedItemsCount = 0;
  let selectedQuantity = 0;
  let selectedPriceBeforeDiscount = 0;
  let selectedDiscount = 0;

  state?.cart?.forEach((product) => {
    const quantity = Number(product.quantity);
    const priceBeforeDiscount = product.price.base * quantity;
    const discount = product.price.discount
      ? product.price.discount.discount_amount * quantity
      : 0;

    totalItemsCount += 1;
    totalQuantity += quantity;
    totalPriceBeforeDiscount += priceBeforeDiscount;
    totalDiscount += discount;

    if (product.selected) {
      selectedItemsCount += 1;
      selectedQuantity += quantity;
      selectedPriceBeforeDiscount += priceBeforeDiscount;
      selectedDiscount += discount;
    }
  });

  state.total = {
    items_count: totalItemsCount,
    quantity: totalQuantity,
    price_before_discount: totalPriceBeforeDiscount,
    discount: totalDiscount,
    price_after_discount: totalPriceBeforeDiscount - totalDiscount,
  };

  state.selected = {
    items_count: selectedItemsCount,
    quantity: selectedQuantity,
    price_before_discount: selectedPriceBeforeDiscount,
    discount: selectedDiscount,
    price_after_discount: selectedPriceBeforeDiscount - selectedDiscount,
  };
};

export const cartSlice = createSlice({
  name: 'cart',
  initialState,
  reducers: {
    setCart: (state, action: PayloadAction<LocalCartState>) => {
      if (!action.payload) {
        // Reset state to initial state
        state.cart = [];
        state.total = initialState.total;
        state.selected = initialState.selected;
        state.currency = initialState.currency;
      } else {
        // Update state with the payload
        state.cart = action.payload.cart;
        state.total = action.payload.total;
        state.selected = action.payload.selected;
        state.currency = action.payload.currency;
      }

      updateTotals(state);
    },
    addToCart: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();
      const product = state.cart.find((item) => item.id === action.payload.id);
      if (product) {
        product.quantity += 1;
      } else {
        const newProduct = { ...action.payload, quantity: 1, selected: false };
        state.cart.push(newProduct);
      }
      updateTotals(state);

      if (!token) {
        saveToSessionStorage('cart', state);
      }
    },
    removeFromCart: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();
      state.cart = state.cart.filter(
        (product) => product.id !== action.payload.id
      );
      updateTotals(state);

      if (!token) {
        saveToSessionStorage('cart', state);
      }
    },
    changeQuantity: (
      state,
      action: PayloadAction<{ id: number; quantity: number; price: PriceType }>
    ) => {
      const token = getTokenFromCookies();
      const product = state.cart.find((item) => item.id === action.payload.id);
      console.log('action.payload.quantity', action.payload.quantity);

      if (product) {
        if (action.payload.quantity <= 0) {
          // Remove product if quantity is 0 or negative
          state.cart = state.cart.filter(
            (item) => item.id !== action.payload.id
          );
        } else {
          // Update quantity and price
          product.quantity = action.payload.quantity;
          product.price = action.payload.price;
        }

        updateTotals(state);

        if (!token) {
          saveToSessionStorage('cart', state);
        }
      }
    },
    selectItem: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();

      const product = state.cart.find((item) => item.id === action.payload.id);
      if (product) {
        product.selected = true;
        updateTotals(state);
      }

      if (!token) {
        saveToSessionStorage('cart', state);
      }
    },
    unselectItem: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();

      const product = state.cart.find((item) => item.id === action.payload.id);
      if (product) {
        product.selected = false;
        updateTotals(state);
      }

      if (!token) {
        saveToSessionStorage('cart', state);
      }
    },
  },
});

export const {
  setCart,
  addToCart,
  removeFromCart,
  changeQuantity,
  selectItem,
  unselectItem,
} = cartSlice.actions;

export default cartSlice.reducer;

================
src/features/cart/model/hooks/index.ts
================

export * from './useAddToCart';
export * from './useRemoveFromCart';
export * from './useQuantityControl';
export * from './useCart';

================
src/features/cart/model/hooks/useAddToCart.ts
================

import { useMemo } from 'react';

import { useDispatch } from 'react-redux';
import { toast } from 'sonner';

import { useGetCartItemPriceMutation } from '@/entities/price';
import { useSendCartMutation, addToCart } from '@/features/cart';
import { getTokenFromCookies } from '@/shared/lib';

import type { Product } from '@/entities/product';

interface UseAddToCartReturn {
  handleAddToCartClick: (e: React.MouseEvent) => Promise<void>;
  buttonState: {
    text: string;
    disabled: boolean;
    loading: boolean;
  };
}

export const useAddToCart = (product: Product): UseAddToCartReturn => {
  const dispatch = useDispatch();
  const token = getTokenFromCookies();

  const [sendCart, { isLoading: sendCartLoading }] = useSendCartMutation();
  const [getItemPrice, { isLoading: priceLoading }] =
    useGetCartItemPriceMutation();

  const handleAddToCartClick = async (e: React.MouseEvent) => {
    e.preventDefault();

    try {
      if (token) {
        const result = await sendCart({
          id: product.id,
          quantity: 1,
          selected: 0,
        });
        if ('error' in result) {
          toast.error('Failed to add product to cart');
          return;
        }
      }

      const price = await getItemPrice({ item_id: product.id });
      if ('data' in price) {
        const newProduct = { ...product, price: price.data.data.price };
        dispatch(addToCart(newProduct));
      }
    } catch (error) {
      toast.error('Failed to add product to cart');
    }
  };

  // Determine button state based on product availability
  const buttonState = useMemo(() => {
    let text = 'В корзину';
    let disabled = false;

    if (product?.availability) {
      if (product.availability.stock === 0) {
        if (product.availability.preorder === null) {
          disabled = true;
          text = 'Нет в наличии';
        } else {
          text = product.availability.preorder.formatted;
        }
      }
    } else {
      disabled = true;
      text = 'Нет в наличии';
    }

    return {
      text,
      disabled,
      loading: sendCartLoading || priceLoading,
    };
  }, [product?.availability, sendCartLoading, priceLoading]);

  return {
    handleAddToCartClick,
    buttonState,
  };
};

================
src/features/cart/model/hooks/useCart.ts
================

import { useSelector } from 'react-redux';

import {
  useGetUserCartQuery,
  transformServerCartToLocalCart,
} from '@/features/cart';
import { getTokenFromCookies } from '@/shared/lib';

import type { RootState } from '@/app/providers/store';
import type { LocalCartState } from '@/features/cart';

export const useCart = () => {
  const token = getTokenFromCookies();
  const localCart = useSelector((state: RootState) => state.cart);

  const {
    data: serverCart,
    isLoading,
    isSuccess,
    error,
  } = useGetUserCartQuery(undefined, { skip: !token });

  const cart: LocalCartState =
    token && isSuccess ? transformServerCartToLocalCart(serverCart) : localCart;

  return {
    cart,
    isLoading,
    isError: !!error,
  };
};

================
src/features/cart/model/hooks/useQuantityControl.ts
================

import { useState, useRef, useEffect } from 'react';

import { useDispatch } from 'react-redux';

import { useGetCartItemPriceMutation } from '@/entities/price';
import { useSendCartMutation } from '@/features/cart';
import { getTokenFromCookies } from '@/shared/lib';

import { changeQuantity, removeFromCart } from '../';

import type { CartProduct } from '../types';

interface UseQuantityControlProps {
  product: CartProduct;
  enableRemove?: boolean;
}

export const useQuantityControl = ({
  product,
  enableRemove = false,
}: UseQuantityControlProps) => {
  const token = getTokenFromCookies();
  const dispatch = useDispatch();
  const [quantity, setQuantity] = useState(product.quantity || 1);
  const isFirstRender = useRef(true);
  const debounceTimer = useRef<NodeJS.Timeout | null>(null);

  const [sendCart, { isLoading }] = useSendCartMutation();
  const [getItemPrice] = useGetCartItemPriceMutation();

  useEffect(() => {
    setQuantity(Number(product.quantity));
  }, [product.quantity]);

  useEffect(() => {
    if (isFirstRender.current) {
      isFirstRender.current = false;
    }

    return () => {
      if (debounceTimer.current) {
        clearTimeout(debounceTimer.current);
      }
    };
  }, []);

  const updateQuantity = async (newQuantity: number) => {
    setQuantity(newQuantity);

    if (debounceTimer.current) {
      clearTimeout(debounceTimer.current);
    }

    debounceTimer.current = setTimeout(async () => {
      try {
        if (!isFirstRender.current) {
          if (token) {
            await sendCart({
              id: product.id,
              quantity: newQuantity,
              selected: product.selected,
            });
          }

          const priceResponse = await getItemPrice({
            item_id: product.id,
            quantity: newQuantity,
          });

          dispatch(
            changeQuantity({
              id: product.id,
              quantity: newQuantity,
              price: priceResponse.data?.data?.price || product.price,
            })
          );
        }
      } catch (error) {
        console.error('Failed to update quantity:', error);
        setQuantity(product.quantity);
      }
    }, 500);
  };

  const handleIncrease = (e: React.MouseEvent) => {
    e.preventDefault();
    updateQuantity(quantity + 1);
  };

  const handleDecrease = async (e: React.MouseEvent) => {
    e.preventDefault();
    if (quantity > 1) {
      updateQuantity(quantity - 1);
    } else if (enableRemove && quantity === 1) {
      if (debounceTimer.current) {
        clearTimeout(debounceTimer.current);
      }
      if (token) {
        await sendCart({
          id: product.id,
          quantity: 0,
          selected: product.selected,
        });
      }
      dispatch(removeFromCart(product));
    }
  };

  return {
    quantity,
    isLoading,
    handleIncrease,
    handleDecrease,
    isMinQuantity: !enableRemove && quantity === 1,
  };
};

================
src/features/cart/model/hooks/useRemoveFromCart.ts
================

import { useDispatch } from 'react-redux';

import { useSendCartMutation } from '@/features/cart';
import { useModal } from '@/features/modals/model/context';
import { getTokenFromCookies } from '@/shared/lib';

import { removeFromCart } from '../';

import type { Product } from '@/entities/product';

interface UseRemoveFromCartOptions {
  withConfirmation?: boolean;
}

export const useRemoveFromCart = (
  product: Product,
  options: UseRemoveFromCartOptions = {}
) => {
  const { withConfirmation = false } = options;
  const { showModal } = useModal();
  const token = getTokenFromCookies();
  const dispatch = useDispatch();

  const [sendCart, { isLoading }] = useSendCartMutation();

  const remove = async () => {
    if (token) {
      await sendCart({ id: product.id, quantity: 0, selected: 0 });
    }
    dispatch(removeFromCart(product));
  };

  const handleRemove = (e: React.MouseEvent) => {
    e.preventDefault();

    if (withConfirmation) {
      showModal({
        type: 'confirmation',
        title: 'Удаление',
        text: 'Удалить товар из корзины?',
        action: () => remove(),
        product,
      });
      return;
    }

    remove();
  };

  return {
    handleRemove,
    isLoading,
  };
};

================
src/features/cart/model/index.ts
================

export * from './cartSlice';
export * from './types';
export * from './hooks';

================
src/features/cart/model/types.ts
================

import type { Currency } from '@/entities/price';
import type { Product } from '@/entities/product';

export interface ServerCartState {
  data: CartProduct[];
  total: CartTotals;
  selected: CartTotals;
  current_currency: Currency;
}

export interface LocalCartState {
  cart: CartProduct[];
  total: CartTotals;
  selected: CartTotals;
  currency: Currency;
}

export interface CartProduct extends Product {
  quantity: number;
  selected: boolean;
}

export interface CartTotals {
  items_count: number;
  quantity: number;
  price_before_discount: number;
  discount: number;
  price_after_discount: number;
}

export type CartModalType = 'showSharedCart' | 'shareCart';

================
src/features/cart/ui/Cart.tsx
================

import React, { useEffect, useRef, useState } from 'react';

import { useSelector } from 'react-redux';
import { useLocation } from 'react-router-dom';
import { useIntersection } from 'react-use';
import { toast } from 'sonner';

import {
  CartDetail,
  CartOrderInfo,
  MobileToCheckoutBar,
  transformServerCartToLocalCart,
} from '@/features/cart';
import { useGetUserCartQuery } from '@/features/cart/api/cartApi';
import { useModal } from '@/features/modals/model/context';
import { RecentlyVisitedSection } from '@/features/recent-items';
import ErrorEmpty from '@/helpers/Errors/ErrorEmpty';
import docIcon from '@/shared/assets/icons/download-pdf.svg';
import shareIcon from '@/shared/assets/icons/share.svg';
import { getTokenFromCookies } from '@/shared/lib';
import { scrollToTop } from '@/shared/lib/scrollToTop';
import { CSearchField } from '@/shared/ui/inputs/CSearchField';
import { Breadcrumbs } from '@/widgets/breadcrumbs';

import type { RootState } from '@/app/providers/store';
import type { LocalCartState, CartProduct } from '@/features/cart';

export const Cart = (): JSX.Element => {
  const token = getTokenFromCookies();

  const localCart: LocalCartState = useSelector(
    (state: RootState) => state.cart
  );
  const {
    data: serverCart,
    isLoading,
    isSuccess,
    error,
  } = useGetUserCartQuery(undefined, { skip: !token });

  const cart: LocalCartState =
    token && isSuccess ? transformServerCartToLocalCart(serverCart) : localCart;

  const selected: CartProduct[] = cart?.cart?.filter(
    (item) => item.selected === true || item.selected.toString() === '1'
  );

  useEffect(() => {
    scrollToTop();
  }, []);

  const [filteredCart, setFilteredCart] = useState<CartProduct[]>([]);

  const handleFilter = (event) => {
    const filterValue = event.target.value;

    const filteredCart = cart?.cart?.filter(
      (product) =>
        product.name.toLowerCase().includes(filterValue.toLowerCase()) ||
        product.groupName.toLowerCase().includes(filterValue.toLowerCase()) ||
        product.sku.toString().includes(filterValue)
    );

    setFilteredCart(filteredCart);
  };

  useEffect(() => {
    setFilteredCart(cart?.cart);
  }, [cart]);

  const orderInfo = useRef(null);
  const orderInfoVisible = useIntersection(orderInfo, {
    root: null,
    rootMargin: '0px',
    threshold: 1,
  });
  const { showModal } = useModal();

  const location = useLocation();

  useEffect(() => {
    const params = new URLSearchParams(location.search);
    const cartCode = params.get('cart');

    if (cartCode) {
      showModal({ type: 'showSharedCart', code: cartCode });
    }
  }, [location.search]);

  return (
    <div className="content pb-6 lining-nums proportional-nums">
      <Breadcrumbs />
      <h1 className="block text-2xl md:text-[40px] font-semibold text-colBlack">
        Корзина
      </h1>
      {cart?.cart?.length > 0 ? (
        <>
          <div className="hidden lg:flex justify-between items-end">
            <div className="flex max-w-[460px] w-full pt-3">
              <CSearchField
                label="Введите наименование или код товара"
                name="search"
                type="search"
                handleChange={handleFilter}
              />
            </div>
            <div className="flex justify-end items-center space-x-4 ">
              <div
                className="flex cursor-pointer"
                onClick={() => {
                  if (selected.length === 0) {
                    toast('Выберите товары, которыми хотите поделиться');
                    return;
                  }
                  showModal({ type: 'shareCart', showLink: true });
                }}
              >
                <img src={shareIcon} alt="*" />
                <span className="text-xs font-medium text-colBlack pl-2">
                  Поделиться
                </span>
              </div>
              <div className="flex cursor-pointer">
                <img src={docIcon} alt="*" />
                <span className="text-xs font-medium text-colBlack pl-2">
                  Скачать PDF заказа
                </span>
              </div>
            </div>
          </div>
          <div className="flex flex-wrap gap-10 py-5">
            <div className="lg:basis-[calc(70%-20px)] basis-full">
              <CartDetail
                cart={cart}
                isLoading={isLoading}
                filteredCart={filteredCart}
                selected={selected}
              />
            </div>

            <div
              ref={orderInfo}
              className="lg:basis-[calc(30%-20px)] basis-full"
            >
              <CartOrderInfo cart={cart} selected={selected} />
            </div>
          </div>

          {orderInfoVisible && orderInfoVisible.intersectionRatio < 1 ? (
            <MobileToCheckoutBar
              selected={selected}
              quantity={cart?.selected?.quantity}
            />
          ) : null}
        </>
      ) : null}
      {cart?.cart?.length === 0 ? (
        <ErrorEmpty
          title="Корзина пуста!"
          desc="Воспользуйтесь поиском, чтобы найти всё, что нужно."
          height="230px"
          hideBtn={true}
        />
      ) : null}
      <RecentlyVisitedSection />
    </div>
  );
};

================
src/features/cart/ui/components/CartDetail.tsx
================

import type React from 'react';
import { useEffect, useRef, useState } from 'react';

import { useDispatch } from 'react-redux';
import { useWindowSize } from 'react-use';
import { toast } from 'sonner';

import {
  removeFromCart,
  selectItem,
  unselectItem,
  useSendCartMutation,
  SendCartRequest,
} from '@/features/cart';
import { useModal } from '@/features/modals/model/context';
import docIcon from '@/shared/assets/icons/download-pdf.svg';
import shareIcon from '@/shared/assets/icons/share.svg';
import { getTokenFromCookies } from '@/shared/lib';
import { CCheckBoxField } from '@/shared/ui';
import {
  ProductCardLineSkeleton,
  ProductCardLineSmallSkeleton,
} from '@/widgets/product-card';

import { CartItem } from './CartItem';
import { CartItemLine } from './CartItemLine';
import { MobileCartItem } from './MobileCartItem';

import type { AppDispatch } from '@/app/providers/store';
import type {
  SendCartPayload,
  CartProduct,
  LocalCartState,
} from '@/features/cart';

type CartDetail = {
  cart: LocalCartState;
  isLoading: boolean;
  filteredCart: CartProduct[];
  selected: CartProduct[];
};

export const CartDetail: React.FC<CartDetail> = ({
  cart,
  isLoading,
  filteredCart,
  selected,
}) => {
  const token = getTokenFromCookies();

  const [sendCart, { isLoading: sendCartIsLoading }] = useSendCartMutation();

  const [itemType, setItemType] = useState('lineBig');

  const { width, height } = useWindowSize();

  const dispatch: AppDispatch = useDispatch();

  const handleSelectAllChange = (event) => {
    const isChecked = event.target.checked;

    if (!isChecked) {
      const payload: SendCartPayload[] = selected.map((item) => ({
        id: item.id,
        quantity: item.quantity,
        selected: false,
      }));

      token
        ? sendCart({ items: payload })
        : selected.forEach((item) => dispatch(unselectItem(item)));
    } else {
      const unselectedItems = cart?.cart?.filter((item) => !item.selected);

      const payload: SendCartPayload[] = unselectedItems.map((item) => ({
        id: item.id,
        quantity: item.quantity,
        selected: true,
      }));

      token
        ? sendCart({ items: payload })
        : unselectedItems.forEach((item) => dispatch(selectItem(item)));
    }
  };

  const handleRemoveSelected = () => {
    const payload = selected.map((item) => ({
      id: item.id,
      quantity: 0,
      selected: 0,
    }));

    if (token) {
      sendCart({ items: payload });
    }
    selected.forEach((item) => dispatch(removeFromCart(item)));
  };

  const [containerHeight, setContainerHeight] = useState('auto');
  const containerRef = useRef(null);
  const previousCartLengthRef = useRef(cart?.cart?.length || 0);

  useEffect(() => {
    if (containerRef.current) {
      const itemHeight = 138; // Height of each item
      const heightChange =
        (cart?.cart?.length - previousCartLengthRef.current) * itemHeight;
      const newHeight = containerRef.current.scrollHeight + heightChange;
      setContainerHeight(`${newHeight}px`);
      window.scroll({
        top:
          window.scrollY +
          (cart?.cart?.length - previousCartLengthRef.current) * itemHeight,
        behavior: 'smooth',
      });
      previousCartLengthRef.current = cart?.cart?.length; // Update the previous cart length
    }
  }, [cart]);

  useEffect(() => {
    if (containerRef.current) {
      setContainerHeight('auto');
    }
  }, []);

  const { showModal } = useModal();
  return (
    <>
      <div className="flex justify-between items-center pb-2">
        <div className="flex items-center">
          <div className="pb-[3px]">
            <CCheckBoxField
              label="Выбрать всё"
              onChange={handleSelectAllChange}
              checked={
                cart?.cart?.length > 0
                  ? cart?.cart?.length === selected?.length
                  : null
              }
              styles="text-colBlack font-medium text-sm"
            />
          </div>
          {selected?.length !== 0 ? (
            <button
              onClick={handleRemoveSelected}
              className="text-colDarkGray font-medium text-sm ml-4"
            >
              Удалить выбранные
            </button>
          ) : null}
        </div>
        <div className="block lg:hidden">
          <img
            className="w-6 h-6"
            src={shareIcon}
            alt=""
            onClick={() => {
              if (selected.length === 0) {
                toast('Выберите товары, которыми хотите поделиться');
                return;
              }
              showModal({ type: 'shareCart', showLink: true });
            }}
          />
        </div>
        <div className="hidden lg:flex justify-end items-center space-x-2 ">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            className="cursor-pointer"
            onClick={() => setItemType('lineBig')}
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M2.33301 2.6665C1.78072 2.6665 1.33301 3.11422 1.33301 3.6665V5.6665C1.33301 6.21879 1.78072 6.6665 2.33301 6.6665H4.33301C4.88529 6.6665 5.33301 6.21879 5.33301 5.6665V3.6665C5.33301 3.11422 4.88529 2.6665 4.33301 2.6665H2.33301ZM2.33301 7.99984C1.78072 7.99984 1.33301 8.44755 1.33301 8.99984V10.9998C1.33301 11.5521 1.78072 11.9998 2.33301 11.9998H4.33301C4.88529 11.9998 5.33301 11.5521 5.33301 10.9998V8.99984C5.33301 8.44755 4.88529 7.99984 4.33301 7.99984H2.33301ZM1.33301 14.3332C1.33301 13.7809 1.78072 13.3332 2.33301 13.3332H4.33301C4.88529 13.3332 5.33301 13.7809 5.33301 14.3332V16.3332C5.33301 16.8855 4.88529 17.3332 4.33301 17.3332H2.33301C1.78072 17.3332 1.33301 16.8855 1.33301 16.3332V14.3332ZM9 2.6665C8.44772 2.6665 8 3.11422 8 3.6665V5.6665C8 6.21879 8.44772 6.6665 9 6.6665H17.6667C18.219 6.6665 18.6667 6.21879 18.6667 5.6665V3.6665C18.6667 3.11422 18.219 2.6665 17.6667 2.6665H9ZM8 9C8 8.44772 8.44772 8 9 8H17.6667C18.219 8 18.6667 8.44772 18.6667 9V11C18.6667 11.5523 18.219 12 17.6667 12H9C8.44772 12 8 11.5523 8 11V9ZM9 13.333C8.44772 13.333 8 13.7807 8 14.333V16.333C8 16.8853 8.44772 17.333 9 17.333H17.6667C18.219 17.333 18.6667 16.8853 18.6667 16.333V14.333C18.6667 13.7807 18.219 13.333 17.6667 13.333H9Z"
              fill={`${itemType === 'lineSmall' ? '#B5B5B5' : '#15765B'}`}
            />
          </svg>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            className="cursor-pointer"
            onClick={() => setItemType('lineSmall')}
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M1.33301 3.6665C1.33301 3.11422 1.78072 2.6665 2.33301 2.6665H17.6663C18.2186 2.6665 18.6663 3.11422 18.6663 3.6665V5.6665C18.6663 6.21879 18.2186 6.6665 17.6663 6.6665H2.33301C1.78072 6.6665 1.33301 6.21879 1.33301 5.6665V3.6665ZM1.33301 8.99984C1.33301 8.44755 1.78072 7.99984 2.33301 7.99984H17.6663C18.2186 7.99984 18.6663 8.44755 18.6663 8.99984V10.9998C18.6663 11.5521 18.2186 11.9998 17.6663 11.9998H2.33301C1.78072 11.9998 1.33301 11.5521 1.33301 10.9998V8.99984ZM2.33301 13.3332C1.78072 13.3332 1.33301 13.7809 1.33301 14.3332V16.3332C1.33301 16.8855 1.78072 17.3332 2.33301 17.3332H17.6663C18.2186 17.3332 18.6663 16.8855 18.6663 16.3332V14.3332C18.6663 13.7809 18.2186 13.3332 17.6663 13.3332H2.33301Z"
              fill={`${itemType === 'lineBig' ? '#B5B5B5' : '#15765B'}`}
            />
          </svg>
        </div>
      </div>
      {isLoading ? (
        <div className="flex flex-col gap-3">
          {Array.from({ length: 6 }).map((_, index) => (
            <CardLineSkeleton key={index} />
          ))}
        </div>
      ) : null}
      {/* <div  className='transition-all duration-700'> */}
      <div
        ref={containerRef}
        style={{ height: containerHeight }}
        className="transition-all duration-700"
      >
        {itemType === 'lineBig' && width > 991 && !isLoading ? (
          <ShCartItem cart={filteredCart} selectedItems={selected} />
        ) : itemType === 'lineSmall' && width > 991 && !isLoading ? (
          <ShCartItemLine cart={filteredCart} selectedItems={selected} />
        ) : (
          <MobileShCartItem cart={filteredCart} selectedItems={selected} />
        )}
      </div>
    </>
  );
};

================
src/features/cart/ui/components/CartItem.tsx
================

import { ExpandMore, AddOutlined, RemoveOutlined } from '@mui/icons-material';
import { useDispatch, useSelector } from 'react-redux';
import { NavLink, useNavigate,  } from 'react-router-dom';

import {
  addToCart,
  changeQuantity,
  removeFromCart,
  selectItem,
  QuantityControl,
  RemoveFromCartButton
} from '@/features/cart';
import { SelectCartItemButton } from './SelectCartItemButton';

import { FavoriteButton } from '@/features/favorite';
import noImg from '@/shared/assets/images/no-image.png';
import { CCheckBoxField } from '@/shared/ui/';
import { DeleteIcon, FavoriteIcon } from '@/shared/ui/icons';
import { PriceDisplay } from '@/widgets/product-card';

import type { CartProduct } from '@/features/cart/model/types';


type CartItemProps = {
  cart: CartProduct[];
};

export const CartItem = ({ cart }: CartItemProps) => {
  const navigate = useNavigate();
  const dispatch = useDispatch();

  return (
    <>
      {cart?.map((product, index) => (
        <div
          key={index}
          className="flex border-t border-b border-[#EBEBEB] pt-2 pb-4"
        >
          <div className="w-1/2 flex space-x-4">
            <div className="flex items-start">
              <SelectCartItemButton product={product}>
                {({ isLoading, isSelected, handleSelectClick }) => (
                  <CCheckBoxField
                    isLoading={isLoading}
                    checked={isSelected}
                    onChange={handleSelectClick}
                  />
                )}
              </SelectCartItemButton>
              <NavLink
                to={`/catalog/${product?.category?.slug}/${product?.slug}`}
              >
                <div>
        <PreviewGallery product={product} />
      </div>
              </NavLink>
            </div>
            <div className="pr-3">
              {product?.tags?.length > 0 ? (
                <span
                  style={{ color: product?.tags[0]?.text_color }}
                  className={`bg-[${product?.tags[0]?.background_color}] py-1 px-2 uppercase text-xs font-bold rounded-xl`}
                >
                  {product?.tags[0]?.text}
                </span>
              ) : (
                <span></span>
              )}
              <NavLink
                to={`/catalog/${product?.category?.slug}/${product?.slug}`}
              >
                <span className="font-semibold cursor-pointer text-colBlack leading-5 hover:underline line-clamp-3 break-all mt-1">
                  {`${product?.groupName} ${product?.name}`}
                </span>
              </NavLink>

              <div className="space-y-1 pt-1">
                <p className="text-xs text-colDarkGray flex items-center space-x-2">
                  <span>Код товара:</span>
                  <span>{product?.sku}</span>
                </p>
                <div className="flex gap-x-2 flex-wrap">
                  {product.attributes
                    ? product?.attributes?.map((attribute, index) => (
                        <p
                          key={index}
                          className="text-xs text-colDarkGray flex items-center space-x-1"
                        >
                          <span>{attribute?.name}:</span>
                          <span className="font-semibold">
                            {attribute.color ? (
                              <div
                                style={{
                                  backgroundColor: `${attribute.color}`,
                                }}
                                className="w-3 h-3 rounded-full border"
                              ></div>
                            ) : (
                              attribute.text
                            )}
                          </span>
                        </p>
                      ))
                    : null}
                </div>
              </div>
              <div className="flex pt-2">
                <button className="flex items-center outline-none">
                  <span className="text-sm font-semibold text-colBlack">
                    С этим товаром покупают
                  </span>
                  <ExpandMore />
                </button>
                <div className="flex space-x-2 pl-5">
                  <FavoriteButton product={product}>
                    {({ isLoading, isInFavorite, handleFavoriteClick }) => (
                      <FavoriteIcon
                        onClick={handleFavoriteClick}
                        favorite={isInFavorite ? 'true' : 'false'}
                        className={`transition-all duration-300 hover:scale-110  ${
                          isLoading ? 'cursor-wait' : 'cursor-pointer'
                        }`}
                      />
                    )}
                  </FavoriteButton>
                  <RemoveFromCartButton
                    product={product}
                    withConfirmation={true}
                  >
                    {({ isLoading, handleRemoveFromCartClick }) => (
                      <DeleteIcon
                        className={`transition-all duration-300 hover:scale-110 ${
                          isLoading ? 'cursor-wait' : 'cursor-pointer'
                        }`}
                        onClick={handleRemoveFromCartClick}
                      />
                    )}
                  </RemoveFromCartButton>
                </div>
              </div>
            </div>
          </div>
          <div className="w-1/2">
            <div className="grid grid-cols-3 items-center gap-4 pt-[27px]">
              {/* <PriceDisplay price={product?.price} alignment="center"/> */}
              <div className="text-center">
              <QuantityControl product={productInCart}  />

              </div>
              <div className="text-center font-bold text-colBlack">
                {product?.price?.total
                  ? `${product?.price?.total}${product?.price?.currency?.symbol || ''}`
                  : 'Цена не указана'}
              </div>
            </div>
          </div>
        </div>
      ))}
    </>
  );
};

================
src/features/cart/ui/components/CartItemLine.tsx
================

import { AddOutlined, RemoveOutlined } from '@mui/icons-material';
import { useDispatch, useSelector } from 'react-redux';
import { NavLink, useNavigate, useOutletContext } from 'react-router-dom';

import { QuantityControl, RemoveFromCartButton } from '@/features/cart';
import {
  addToCart,
  changeQuantity,
  removeFromCart,
  selectItem,
} from '@/features/cart/model/cartSlice';
import { FavoriteButton } from '@/features/favorite';
import noImg from '@/shared/assets/images/no-image.png';
import { CCheckBoxField } from '@/shared/ui';
import { FavoriteIcon, DeleteIcon } from '@/shared/ui/icons';
import { PriceDisplay } from '@/widgets/product-card';

import { SelectCartItemButton } from './SelectCartItemButton';
// import { toggleFavorite } from '@store/slices/favoriteSlice';

export const CartItemLine = ({ cart }) => {
  const navigate = useNavigate();

  return (
    <>
      {cart?.map((product, index) => (
        <div
          key={index}
          className="flex justify-between items-center border-t border-b border-[#EBEBEB] pt-2 pb-4"
        >
          <div className="max-w-[480px] pr-8 w-full flex space-x-4">
            <div className="flex items-start">
              <SelectCartItemButton product={product}>
                {({ isSelected, handleSelectClick }) => (
                  <CCheckBoxField
                    checked={isSelected}
                    onChange={handleSelectClick}
                  />
                )}
              </SelectCartItemButton>
              <div
                onClick={(e) => {
                  e.preventDefault();
                  navigate(`/catalog/category/${product.slug}`);
                }}
                className="cursor-pointer min-w-[56px] w-14 h-14 overflow-hidden bg-gray-100 rounded-md"
              >
                <img
                  className="w-full h-full object-contain"
                  src={product?.files[0]?.large || noImg}
                  onError={(e) => {
                    e.target.onError = null;
                    e.target.src = noImg;
                  }}
                  alt="*"
                />
              </div>
            </div>
            <div className="pr-3">
              <span
                to="#"
                onClick={(e) => {
                  e.preventDefault();
                  navigate(`/catalog/category/${product.slug}`);
                }}
                className="font-semibold cursor-pointer text-colBlack leading-5 hover:underline line-clamp-1 break-all mt-1"
              >
                {`${product?.groupName} ${product?.name}`}
              </span>
              <div className="space-y-1 pt-1">
                <p className="text-xs text-colDarkGray flex items-center space-x-2">
                  <span>Код товара:</span>
                  <span>{product?.sku}</span>
                </p>
              </div>
            </div>
          </div>
          <div className="flex items-center justify-between space-x-5 pt-3">
            <PriceDisplay price={product?.price} />
            <div className="flex items-center justify-between">
              <QuantityControl product={product} />
            </div>
            <div className="flex items-center text-colBlack font-bold">
              <div>
                {product?.price?.total
                  ? product?.price?.total
                  : 'Цена не указана'}
                <span className="pl-1">
                  {product?.price?.total && product?.price?.currency
                    ? product?.price?.currency?.symbol
                    : ''}
                </span>
              </div>
            </div>
            <div className="flex space-x-2">
              <FavoriteButton product={product}>
                {({ isInFavorite, handleFavoriteClick }) => (
                  <FavoriteIcon
                    onClick={handleFavoriteClick}
                    favorite={isInFavorite ? 'true' : 'false'}
                    className="transition-all duration-300 hover:scale-110 cursor-pointer"
                  />
                )}
              </FavoriteButton>
              <RemoveFromCartButton product={product} withConfirmation={true}>
                {({ handleRemoveFromCartClick }) => (
                  <DeleteIcon
                    className="transition-all duration-300 hover:scale-110  cursor-pointer"
                    onClick={handleRemoveFromCartClick}
                  />
                )}
              </RemoveFromCartButton>
            </div>
          </div>
        </div>
      ))}
    </>
  );
};

================
src/features/cart/ui/components/CartOrderInfo.tsx
================

import type React from 'react';
import { useRef } from 'react';

import plural from 'plural-ru';
import { NavLink } from 'react-router-dom';
import { useIntersection } from 'react-use';

import { getTokenFromCookies } from '@/shared/lib';

import type { CartProduct } from '@/types/Store/Cart/CartProduct';
import type { LocalCartState } from '@/types/Store/Cart/CartState';

type CartOrderInfoProps = {
  cart: LocalCartState;
  selected: CartProduct[];
};

export const CartOrderInfo: React.FC<CartOrderInfoProps> = ({
  cart,
  selected,
}) => {
  const token = getTokenFromCookies();
  const hasZeroPriceItems =
    selected.filter((item) => item.price.base === null || item.price.base === 0)
      .length > 0;

  return (
    <div className="border border-[#EBEBEB] rounded-[10px] p-5">
      {selected?.length === 0 ? (
        <div className="text-center text-[#828282] text-lg font-medium mb-5">
          Выберите товары, которые хотите заказать
        </div>
      ) : (
        <>
          <div className="flex justify-between items-center pb-3">
            <span className="text-xl font-semibold text-colBlack">Итого</span>
            <span className="text-xl font-semibold text-colBlack">
              {cart?.selected?.items_count}{' '}
              {plural(
                cart?.selected?.items_count,
                'товар',
                'товара',
                'товаров'
              )}
            </span>
          </div>
          <div className="flex justify-between items-center">
            <span className="text-colBlack text-sm whitespace-nowrap">
              Количество
            </span>
            <span className="w-full border-b border-colGray border-dashed mt-2 mx-1"></span>
            <span className="font-bold whitespace-nowrap">
              {cart?.selected?.quantity} шт
            </span>
          </div>
          {/* <div className='flex justify-between items-center pt-2'>
            <span className='text-colBlack text-sm'>Вес</span>
            <span className='w-full border-b border-colGray border-dashed mt-2 mx-1'></span>
            <span className='font-bold whitespace-nowrap'>19.5 кг</span>
          </div> */}
          <br />
          <div className="flex justify-between items-center">
            <span className="text-colBlack text-sm">Сумма</span>
            <span className="w-full border-b border-colGray border-dashed mt-2 mx-1"></span>
            <span className="font-bold whitespace-nowrap">
              {cart?.selected?.price_before_discount} {cart.currency.symbol}
            </span>
          </div>
          {cart?.selected?.discount > 0 ? (
            <div className="flex justify-between items-center pt-2">
              <span className="text-colBlack text-sm">Скидка</span>
              <span className="w-full border-b border-colGray border-dashed mt-2 mx-1"></span>
              <span className="font-bold whitespace-nowrap">
                -{cart?.selected?.discount} {cart?.currency?.symbol}
              </span>
            </div>
          ) : null}
          <div className="flex justify-between items-center pt-3 pb-5">
            <span className="text-lg font-semibold text-colBlack">Итого</span>
            <span className="text-lg font-semibold text-colBlack">
              {cart?.selected?.price_after_discount} {cart.currency.symbol}
            </span>
          </div>
        </>
      )}

      {selected?.length === 0 ? (
        <button className="text-white cursor-auto font-semibold bg-colGray rounded w-full h-[50px] flex justify-center items-center">
          Перейти к оформлению
        </button>
      ) : null}
      {selected?.length !== 0 && hasZeroPriceItems ? (
        <>
          <button className="text-white cursor-not-allowed font-semibold bg-colGray rounded w-full h-[50px] flex justify-center items-center">
            Перейти к оформлению
          </button>
          <div className="text-sm mt-2 text-center">
            Нельзя оформить заказ на товары с не указанной ценой
          </div>
        </>
      ) : null}
      {selected?.length !== 0 && !hasZeroPriceItems ? (
        <NavLink
          to="/checkout"
          className="text-white font-semibold bg-colGreen rounded w-full h-[50px] flex justify-center items-center"
        >
          Перейти к оформлению
        </NavLink>
      ) : null}
    </div>
  );
};

================
src/features/cart/ui/components/index.ts
================

export * from './CartItem';
export * from './CartItemLine';
// export * from './CartItemSkeleton';
// export * from './CartItemLineSkeleton';
// export * from './MobileCartItemSkeleton';
export * from './CartOrderInfo';
export * from './CartDetail';
export * from './MobileCartItem';
export * from './MobileToCheckoutBar';
export * from './RecommendedWithSection';

================
src/features/cart/ui/components/MobileCartItem.tsx
================

import { ExpandMore, AddOutlined, RemoveOutlined } from '@mui/icons-material';
import { useDispatch, useSelector } from 'react-redux';
import { NavLink, useNavigate, useOutletContext } from 'react-router-dom';

import {
  addToCart,
  changeQuantity,
  removeFromCart,
  selectItem,
  QuantityControl,
  RemoveFromCartButton,
} from '@/features/cart';
import { FavoriteButton } from '@/features/favorite';
import noImg from '@/shared/assets/images/no-image.png';
import { DeleteIcon, FavoriteIcon } from '@/shared/ui/icons';
import { CCheckBoxField } from '@/shared/ui/inputs';
import { PriceDisplay } from '@/widgets/product-card';

import { SelectCartItemButton } from './SelectCartItemButton';

export const MobileCartItem = ({ cart, selectedItems, handleItemChange }) => {
  // eslint-disable-next-line no-unused-vars
  // const [cartProducts, addToCart, removeFromCart] = useOutletContext();
  const navigate = useNavigate();
  const dispatch = useDispatch();
  // const cart = useSelector(state => state?.cart?.cart)
  const favorite = useSelector((state) => state?.favorite);

  return (
    <>
      {cart?.map((product, index) => (
        <div
          key={index}
          className="flex flex-col border-t border-b border-[#EBEBEB] pt-2 pb-4"
        >
          <div className="flex space-x-4">
            <div className="flex items-start">
              <SelectCartItemButton product={product}>
                {({ isSelected, handleSelectClick }) => (
                  <CCheckBoxField
                    checked={isSelected}
                    onChange={handleSelectClick}
                  />
                )}
              </SelectCartItemButton>
              <div
                onClick={(e) => {
                  e.preventDefault();
                  navigate(`/catalog/category/${product.slug}`);
                }}
                className="cursor-pointer min-w-[112px] w-28 h-28 overflow-hidden bg-gray-100 rounded-md"
              >
                <img
                  className="w-full h-full object-contain"
                  src={product?.files[0]?.large || noImg}
                  onError={(e) => {
                    e.target.onError = null;
                    e.target.src = noImg;
                  }}
                  alt="*"
                />
              </div>
            </div>
            <div className="pr-3">
              {product?.tags?.length > 0 ? (
                <span
                  style={{ color: product?.tags[0]?.text_color }}
                  className={`bg-[${product?.tags[0]?.background_color}] py-1 px-2 uppercase text-xs font-bold rounded-xl`}
                >
                  {product?.tags[0]?.text}
                </span>
              ) : (
                <span></span>
              )}
              <span
                // to={product.slug}
                onClick={(e) => {
                  e.preventDefault();
                  navigate(`/catalog/category/${product.slug}`);
                }}
                className="font-semibold cursor-pointer text-colBlack leading-5 hover:underline line-clamp-3 break-all mt-1"
              >
                {product?.name}
              </span>
              <div className="space-y-1 pt-1">
                <p className="text-xs text-colDarkGray flex items-center space-x-2">
                  {!product?.price ? 'Не указано' : null}
                  {product?.price?.discount ? (
                    <div>{`${product?.price?.discount?.price} ${product?.price?.currency}/${product?.price?.unit}`}</div>
                  ) : null}
                  {product?.price && !product?.price?.discount ? (
                    <div>{`${product?.price?.default} ${product?.price?.currency}/${product?.price?.unit}`}</div>
                  ) : null}
                </p>
                {product?.price?.discount?.price ? (
                  <p className="text-xs text-colDarkGray flex items-center space-x-2">
                    <span>{product?.price?.discount?.price}</span>
                  </p>
                ) : null}
              </div>
              <div className="flex pt-2">
                <p className="text-xs text-colDarkGray flex items-center space-x-2">
                  <span>Цвет:</span>
                  <span className="w-3 h-3 min-w-[12px] bg-black rounded-full"></span>
                  <span>Чёрный</span>
                </p>
                {/* <button className='flex items-center outline-none'>
                  <span className='text-sm font-semibold text-colBlack'>
                    С этим товаром покупают
                  </span>
                  <ExpandMore />
                </button> */}
              </div>
              <div className="flex pt-2">
                <p className="text-xs text-colDarkGray flex items-center space-x-2">
                  <span>Можно забрать</span>
                  <span className="text-colGreen">сегодня</span>
                </p>
              </div>
            </div>
          </div>
          <div className="flex items-center justify-between space-x-3 pt-[27px]">
            <div className="flex space-x-2 pl-5">
              <FavoriteButton product={product}>
                {({ isLoading, isInFavorite, handleFavoriteClick }) => (
                  <FavoriteIcon
                    onClick={handleFavoriteClick}
                    favorite={isInFavorite ? 'true' : 'false'}
                    className={`transition-all duration-300 hover:scale-110  ${
                      isLoading ? 'cursor-wait' : 'cursor-pointer'
                    }`}
                  />
                )}
              </FavoriteButton>
              <RemoveFromCartButton product={product}>
                {({ isLoading, handleRemoveFromCartClick }) => (
                  <DeleteIcon
                    className={`transition-all duration-300 hover:scale-110 ${
                      isLoading ? 'cursor-wait' : 'cursor-pointer'
                    }`}
                    onClick={handleRemoveFromCartClick}
                  />
                )}
              </RemoveFromCartButton>
            </div>
            <div className="flex items-center text-colBlack font-bold">
              <PriceDisplay price={product?.price} />
            </div>
            <div className="flex items-center space-x-3">
              <ChangeQuantityGroup product={product} />
            </div>
          </div>
        </div>
      ))}
    </>
  );
};

================
src/features/cart/ui/components/MobileToCheckoutBar.tsx
================

import React from 'react';

import plural from 'plural-ru';
import { NavLink } from 'react-router-dom';

import type { CartProduct } from '@/features/cart';

export type MobileToCheckoutBarProps = {
  selected: CartProduct[];
  quantity: number;
};

export const MobileToCheckoutBar = ({
  selected,
  quantity,
}: MobileToCheckoutBarProps) => {
  return (
    <div className="lg:hidden z-10 fixed bottom-[72px] w-full bg-white">
      <div className="flex justify-between px-5 py-3">
        <div className="flex justify-between w-full">
          <div className="flex flex-col justify-between items-center basis-1/3">
            <span className="text-xl font-semibold text-colBlack">
              40 000 ₽
            </span>
            <span className="text-sm text-colBlack">
              {quantity} {plural(quantity, 'товар', 'товара', 'товаров')}
            </span>
          </div>
          <NavLink
            to="../checkout"
            className={`text-white font-semibold ${selected?.length === 0 ? 'bg-colGray' : 'bg-colGreen'} rounded w-full h-[50px] flex justify-center items-center`}
          >
            Перейти к оформлению
          </NavLink>
        </div>
      </div>
    </div>
  );
};

export default MobileToCheckoutBar;

================
src/features/cart/ui/components/RecommendedWithSection.tsx
================

import React, { useState } from 'react';

export const RecommendedWithSection = ({ title, content }) => {
  const [isActive, setIsActive] = useState(false);

  return (
    <div className="accordion-item">
      <div className="accordion-title" onClick={() => setIsActive(!isActive)}>
        <div>{title}</div>
        <div>{isActive ? '-' : '+'}</div>
      </div>
      {isActive ? <div className="accordion-content">{content}</div> : null}
    </div>
  );
};


================
src/features/cart/ui/components/SelectCartItemButton.tsx
================

// src/helpers/SelectCartItemButton/SelectCartItemButton.jsx

import type React from 'react';

import { useDispatch, useSelector } from 'react-redux';

import {
  selectItem,
  unselectItem,
  transformServerCartToLocalCart,
  useGetUserCartQuery,
  useSendCartMutation,
} from '@/features/cart';
import { getTokenFromCookies } from '@/shared/lib';

import type { AppDispatch, RootState } from '@/app/providers/store';
import type { CartProduct, LocalCartState } from '@/features/cart';

interface SelectCartItemButtonProps {
  product: CartProduct;
  children: (props: {
    isLoading: boolean;
    isSelected: boolean;
    handleSelectClick: (e: React.MouseEvent<HTMLButtonElement>) => void;
  }) => React.ReactNode;
}

export const SelectCartItemButton: React.FC<SelectCartItemButtonProps> = ({
  product,
  children,
}) => {
  const dispatch: AppDispatch = useDispatch();
  const token = getTokenFromCookies();

  const localCart: LocalCartState = useSelector(
    (state: RootState) => state.cart
  );

  // Fetching cart data from the server if the user is logged in
  const {
    data: serverCart,
    // isLoading,
    isSuccess,
    error,
  } = useGetUserCartQuery(undefined, { skip: !token });

  const cart: LocalCartState =
    token && isSuccess ? transformServerCartToLocalCart(serverCart) : localCart;

  const [sendCart, { isLoading }] = useSendCartMutation();

  const isSelected: boolean = cart?.cart?.some(
    (item) =>
      item.id === product.id &&
      (item.selected.toString() === '1' || item.selected === true)
  );

  const handleSelectClick = (e: React.MouseEvent<HTMLButtonElement>) => {
    e.preventDefault();
    e.stopPropagation();

    if (isSelected) {
      if (token) {
        sendCart({ id: product.id, quantity: product.quantity, selected: 0 });
      }
      dispatch(unselectItem(product));
    } else {
      if (token) {
        sendCart({ id: product.id, quantity: product.quantity, selected: 1 });
      }
      dispatch(selectItem(product));
    }
  };

  return children({ isLoading, isSelected, handleSelectClick });
};

================
src/features/cart/ui/controls/AddToCartButton.tsx
================

import { useAddToCart } from '@/features/cart';
import { LoadingSmall } from '@/shared/ui/Loader';

import type { Product } from '@/entities/product';

interface AddToCartButtonProps {
  product: Product;
  className?: string;
  variant?: 'primary' | 'secondary';
}

export const AddToCartButton = ({
  product,
  className = '',
  variant = 'primary',
}: AddToCartButtonProps) => {
  const { handleAddToCartClick, buttonState } = useAddToCart(product);

  return (
    <button
      onClick={handleAddToCartClick}
      disabled={buttonState.disabled || buttonState.loading}
      className={`
        flex justify-center items-center min-h-10 
        ${buttonState.disabled ? 'bg-colGray' : 'bg-colGreen cursor-pointer'}
        text-white rounded-md p-2 font-semibold w-full
        ${buttonState.loading ? 'cursor-wait' : ''}
        ${className}
      `}
    >
      {buttonState.loading ? <LoadingSmall /> : buttonState.text}
    </button>
  );
};

================
src/features/cart/ui/controls/index.ts
================

export * from './AddToCartButton';
export * from './QuantityControl';
export * from './RemoveFormCartButton';

================
src/features/cart/ui/controls/QuantityControl.tsx
================

import { AddOutlined, RemoveOutlined } from '@mui/icons-material';

import { useQuantityControl } from '@/features/cart';

import type { CartProduct } from '@/features/cart';

interface QuantityControlProps {
  product: CartProduct;
  enableRemove?: boolean;
  className?: string;
}

export const QuantityControl = ({
  product,
  enableRemove = false,
  className = '',
}: QuantityControlProps) => {
  const { quantity, isLoading, handleIncrease, handleDecrease, isMinQuantity } =
    useQuantityControl({ product, enableRemove });

  return (
    <div className={`flex justify-between items-center grow ${className}`}>
      <button
        className={`${isLoading ? 'cursor-wait' : 'cursor-pointer'} w-10 h-10 bg-colLightGray rounded-full flex items-center justify-center`}
        onClick={handleDecrease}
        disabled={isMinQuantity || isLoading}
      >
        <RemoveOutlined
          className={`${isMinQuantity ? 'text-colGray' : 'text-colGreen'}`}
        />
      </button>

      <span className="text-colGreen font-semibold px-5">{quantity}</span>

      <button
        className={`${isLoading ? 'cursor-wait' : 'cursor-pointer'} w-10 h-10 bg-colLightGray rounded-full flex items-center justify-center`}
        onClick={handleIncrease}
        disabled={isLoading}
      >
        <AddOutlined className="text-colGreen" />
      </button>
    </div>
  );
};

================
src/features/cart/ui/controls/RemoveFormCartButton.tsx
================

import { useRemoveFromCart } from '@/features/cart';
import { DeleteIcon } from '@/shared/ui/icons';

import type { Product } from '@/entities/product';

interface RemoveFromCartButtonProps {
  product: Product;
  withConfirmation?: boolean;
  className?: string;
}

export const RemoveFromCartButton = ({
  product,
  withConfirmation = false,
  className = '',
}: RemoveFromCartButtonProps) => {
  const { handleRemove, isLoading } = useRemoveFromCart(product, {
    withConfirmation,
  });

  return (
    <button
      onClick={handleRemove}
      disabled={isLoading}
      className={`transition-all duration-300 hover:scale-110 ${
        isLoading ? 'cursor-wait' : 'cursor-pointer'
      } ${className}`}
    >
      <DeleteIcon />
    </button>
  );
};

================
src/features/cart/ui/index.ts
================

export { Cart } from './Cart';
export * from './controls';
export * from './components';

================
src/features/catalog/CustomPagination.tsx
================

import { Pagination, Stack } from '@mui/material';

export const CustomPagination = ({page, count, handlePagination }) => {
  const totalPages = Math.ceil(count / 20);
  console.log("pagination page")
  console.log(page)
  return (
    <Stack spacing={2} className='pt-8'>
      <Pagination
        onChange={handlePagination}
        count={totalPages}
        page={page}
        variant='outlined'
        shape='rounded'
        classes={{
          ul: 'pagination-mui',
        }}
        className='flex justify-end'
      />
    </Stack>
  );
};

================
src/features/comparison/api/comparisonApi.ts
================

// src/redux/api/comparisonEndpoints.js
import { api } from '@/shared/api/api';

import type { AdditionalServerResponseData } from '@/shared/types/AdditionalServerResponseData';
import type { ProductListRequest } from '@/shared/types/ProductListRequest';
import type { GetComparisonResponse } from '@/types/ServerData/Comparison/GetComparison';

export const comparisonEndpoints = api.injectEndpoints({
  endpoints: (builder) => ({
    getComparison: builder.query<GetComparisonResponse, void>({
      query: () => '/api/ProductsComparisons/get',
      providesTags: [{ type: 'Comparison', id: 'LIST' }],
    }),
    sendComparison: builder.mutation<
      AdditionalServerResponseData,
      ProductListRequest
    >({
      query: (data) => ({
        url: '/api/ProductsComparisons/set',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: [
        { type: 'Comparison', id: 'LIST' },
        { type: 'User', id: 'DATA' },
      ],
    }),
    removeFromComparison: builder.mutation<
      AdditionalServerResponseData,
      ProductListRequest
    >({
      query: (data) => ({
        url: '/api/ProductsComparisons/delete',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: [
        { type: 'Comparison', id: 'LIST' },
        { type: 'User', id: 'DATA' },
      ],
    }),
  }),
});

// Export hooks for comparison endpoints
export const {
  useGetComparisonQuery,
  useSendComparisonMutation,
  useRemoveFromComparisonMutation,
} = comparisonEndpoints;

================
src/features/comparison/api/index.ts
================

export * from './comparisonApi';
export * from './types';

================
src/features/comparison/api/types.ts
================

import type { ProductListCategoryChain } from '@/entities/category';
import type { Product } from '@/entities/product';
import type { AdditionalServerResponseData } from '@/shared/types';

export interface GetComparisonResponse extends AdditionalServerResponseData {
  data: Product[];
  count: number;
  category_chain: ProductListCategoryChain[];
}

================
src/features/comparison/index.ts
================

export * from './api';
export * from './model';
export * from './ui';

================
src/features/comparison/model/comparisonSlice.ts
================

// src/features/comparison/comparisonSlice.ts
import { createSlice } from '@reduxjs/toolkit';

import { saveToSessionStorage } from '@/features/storage/lib';
import { getTokenFromCookies } from '@/shared/lib';

import type { ComparisonState } from './types';
import type { ProductListCategoryChain } from '@/entities/category';
import type { Product } from '@/entities/product';
import type { PayloadAction } from '@reduxjs/toolkit';

const parseCategories = (products: Product[]): ProductListCategoryChain[] => {
  if (!products?.length) return [];

  // Create a map to count products per category and prevent duplicates
  const categoryMap = products.reduce((acc, product) => {
    const categoryId = product.category.id;
    if (!acc.has(categoryId)) {
      acc.set(categoryId, {
        category: product.category,
        count: 1,
      });
    } else {
      acc.get(categoryId).count++;
    }
    return acc;
  }, new Map<number, { category: (typeof products)[0]['category']; count: number }>());

  // Convert map to array and format as ProductListCategoryChain
  return Array.from(categoryMap.values()).map(({ category, count }) => ({
    chain: [
      {
        id: category.id,
        name: category.name,
        slug: category.slug || '',
        image: category.image || '',
      },
    ],
    count,
  }));
};

const initialState: ComparisonState = {
  comparison: [],
  categories: [],
};

export const comparisonSlice = createSlice({
  name: 'comparison',
  initialState,
  reducers: {
    setComparison: (state, action: PayloadAction<Product[]>) => {
      state.comparison = action.payload || [];
      state.categories = parseCategories(state.comparison);
    },
    addToComparison: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();
      state.comparison.push({ ...action.payload });
      state.categories = parseCategories(state.comparison);
      if (!token) {
        saveToSessionStorage('comparison', state.comparison);
      }
    },
    removeFromComparison: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();
      state.comparison = state.comparison.filter(
        (item) => item.id !== action.payload.id
      );
      state.categories = parseCategories(state.comparison);
      if (!token) {
        saveToSessionStorage('comparison', state.comparison);
      }
    },
  },
});

export const { setComparison, addToComparison, removeFromComparison } =
  comparisonSlice.actions;
export default comparisonSlice.reducer;

================
src/features/comparison/model/hooks/useComparison.ts
================

import { useDispatch, useSelector } from 'react-redux';

import {
  useSendComparisonMutation,
  useRemoveFromComparisonMutation,
  addToComparison,
  removeFromComparison,
} from '@/features/comparison';
import { getTokenFromCookies } from '@/shared/lib';

import type { Product } from '@/entities/product';

export const useComparison = (product: Product) => {
  const dispatch = useDispatch();
  const token = getTokenFromCookies();
  const comparison = useSelector((state) => state.comparison.comparison);

  const [sendComparison, { isLoading: sendLoading }] =
    useSendComparisonMutation();
  const [removeComparison, { isLoading: removeLoading }] =
    useRemoveFromComparisonMutation();

  const isInComparison = comparison.some((el) => el.id === product?.id);
  const isLoading = sendLoading || removeLoading;

  const handleComparisonClick = async (e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation();

    try {
      if (isInComparison) {
        if (token) {
          await removeComparison({ id: product.id });
        }
        dispatch(removeFromComparison(product));
      } else {
        if (token) {
          await sendComparison({ id: product.id });
        }
        dispatch(addToComparison(product));
      }
    } catch (error) {
      console.error('Failed to update comparison:', error);
    }
  };

  return {
    isInComparison,
    isLoading,
    handleComparisonClick,
  };
};

================
src/features/comparison/model/index.ts
================

export * from './comparisonSlice';
export * from './types';
export * from './hooks/useComparison';

================
src/features/comparison/model/types.ts
================

import type { ProductListCategoryChain } from '@/entities/category';
import type { Product } from '@/entities/product';

export interface ComparisonState {
  comparison: Product[];
  categories: ProductListCategoryChain[];
}

================
src/features/comparison/ui/controls/ComparisonButton.tsx
================

import { useComparison } from '@/features/comparison';
import { ComparisonIcon } from '@/shared/ui/icons';

import type { Product } from '@/entities/product';

interface ComparisonButtonProps {
  product: Product;
  className?: string;
}

export const ComparisonButton = ({
  product,
  className = '',
}: ComparisonButtonProps) => {
  const { isInComparison, isLoading, handleComparisonClick } =
    useComparison(product);

  return (
    <button
      onClick={handleComparisonClick}
      disabled={isLoading}
      className={`transition-all duration-300 hover:scale-110 ${isLoading ? 'cursor-wait' : 'cursor-pointer'} ${className}`}
    >
      <ComparisonIcon active={isInComparison} />
    </button>
  );
};

================
src/features/comparison/ui/index.ts
================

export * from './controls/ComparisonButton';

================
src/features/favorite/api/favoritesEndpoints.ts
================

// src/redux/api/favoritesEndpoints.js
import { api } from '@/shared/api/api';

import type { GetFavoriteResponse } from './types';
import type { AdditionalServerResponseData } from '@/shared/types/AdditionalServerResponseData';
import type { ProductListRequest } from '@/shared/types/ProductListRequest';

export const favoritesEndpoints = api.injectEndpoints({
  endpoints: (builder) => ({
    getFavorites: builder.query<GetFavoriteResponse, void>({
      query: () => '/api/ProductsFavourites/get',
      providesTags: [{ type: 'Favorite', id: 'LIST' }],
    }),
    sendFavorites: builder.mutation<
      AdditionalServerResponseData,
      ProductListRequest
    >({
      query: (data) => ({
        url: '/api/ProductsFavourites/set',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: [
        { type: 'Favorite', id: 'LIST' },
        { type: 'User', id: 'DATA' },
      ],
    }),
    removeFromFavorites: builder.mutation<
      AdditionalServerResponseData,
      ProductListRequest
    >({
      query: (data) => ({
        url: '/api/ProductsFavourites/delete',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: [
        { type: 'Favorite', id: 'LIST' },
        { type: 'User', id: 'DATA' },
      ],
    }),
  }),
});

export const {
  useGetFavoritesQuery,
  useSendFavoritesMutation,
  useRemoveFromFavoritesMutation,
} = favoritesEndpoints;

================
src/features/favorite/api/index.ts
================

export * from './favoritesEndpoints';
export * from './types';

================
src/features/favorite/api/types.ts
================

import type { ProductListCategoryChain } from '@/entities/category';
import type { Product } from '@/entities/product';
import type { AdditionalServerResponseData } from '@/shared/types';

export interface GetFavoriteResponse extends AdditionalServerResponseData {
  data: Product[];
  count: number;
  category_chain: ProductListCategoryChain[];
}

================
src/features/favorite/index.ts
================

export * from './api';
export * from './model';
export * from './ui';

================
src/features/favorite/model/favoriteSlice.ts
================

// src/features/favorite/favoriteSlice.ts
import { createSlice } from '@reduxjs/toolkit';

import { saveToSessionStorage } from '@/features/storage/lib';
import { getTokenFromCookies } from '@/shared/lib';

import type { FavoriteState } from './types';
import type { ProductListCategoryChain } from '@/entities/category';
import type { Product } from '@/entities/product';
import type { PayloadAction } from '@reduxjs/toolkit';

const parseCategories = (products: Product[]): ProductListCategoryChain[] => {
  if (!products?.length) return [];

  // Create a map to count products per category and prevent duplicates
  const categoryMap = products.reduce((acc, product) => {
    const categoryId = product.category.id;
    if (!acc.has(categoryId)) {
      acc.set(categoryId, {
        category: product.category,
        count: 1,
      });
    } else {
      acc.get(categoryId).count++;
    }
    return acc;
  }, new Map<number, { category: (typeof products)[0]['category']; count: number }>());

  // Convert map to array and format as ProductListCategoryChain
  return Array.from(categoryMap.values()).map(({ category, count }) => ({
    chain: [
      {
        id: category.id,
        name: category.name,
        slug: category.slug || '',
        image: category.image || '',
      },
    ],
    count,
  }));
};

const initialState: FavoriteState = {
  favorite: [],
  categories: [],
};

export const favoriteSlice = createSlice({
  name: 'favorite',
  initialState,
  reducers: {
    setFavorite: (state, action: PayloadAction<Product[]>) => {
      state.favorite = action.payload || [];
      state.categories = parseCategories(state.favorite);
    },
    addToFavorite: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();
      state.favorite.push({ ...action.payload });
      state.categories = parseCategories(state.favorite);
      if (!token) {
        saveToSessionStorage('favorite', state.favorite);
      }
    },
    removeFromFavorite: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();
      state.favorite = state.favorite.filter(
        (item) => item.id !== action.payload.id
      );
      state.categories = parseCategories(state.favorite);
      if (!token) {
        saveToSessionStorage('favorite', state.favorite);
      }
    },
  },
});

export const { setFavorite, addToFavorite, removeFromFavorite } =
  favoriteSlice.actions;
export default favoriteSlice.reducer;

================
src/features/favorite/model/hooks/useFavorites.ts
================

import { useDispatch, useSelector } from 'react-redux';

import {
  useRemoveFromFavoritesMutation,
  useSendFavoritesMutation,
} from '@/features/favorite';
import { getTokenFromCookies } from '@/shared/lib';

import { addToFavorite, removeFromFavorite } from '../';

import type { Product } from '@/entities/product';

export const useFavorites = (product: Product) => {
  const dispatch = useDispatch();
  const token = getTokenFromCookies();
  const favorite = useSelector((state) => state.favorite.favorite);

  const [sendFavorites, { isLoading: sendLoading }] =
    useSendFavoritesMutation();
  const [removeFavorites, { isLoading: removeLoading }] =
    useRemoveFromFavoritesMutation();

  const isInFavorite = favorite.some((el) => el.id === product?.id);
  const isLoading = sendLoading || removeLoading;

  const handleFavoriteClick = async (e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation();

    try {
      if (isInFavorite) {
        if (token) {
          await removeFavorites(product);
        }
        dispatch(removeFromFavorite(product));
      } else {
        if (token) {
          await sendFavorites(product);
        }
        dispatch(addToFavorite(product));
      }
    } catch (error) {
      console.error('Failed to update favorites:', error);
    }
  };

  return {
    isInFavorite,
    isLoading,
    handleFavoriteClick,
  };
};

================
src/features/favorite/model/index.ts
================

export * from './favoriteSlice';
export * from './hooks/useFavorites';
export * from './types';

================
src/features/favorite/model/types.ts
================

import type { ProductListCategoryChain } from '@/entities/category';
import type { Product } from '@/entities/product';

export interface FavoriteState {
  favorite: Product[];
  categories: ProductListCategoryChain[];
}

================
src/features/favorite/ui/controls/FavoriteButton.tsx
================

import { FavoriteIcon } from '@/shared/ui/icons';

import { useFavorites } from '../../model/hooks/useFavorites';

import type { Product } from '@/entities/product';

interface FavoriteButtonProps {
  product: Product;
  className?: string;
}

export const FavoriteButton = ({
  product,
  className = '',
}: FavoriteButtonProps) => {
  const { isInFavorite, isLoading, handleFavoriteClick } =
    useFavorites(product);

  return (
    <button
      onClick={handleFavoriteClick}
      disabled={isLoading}
      className={`transition-all duration-300 hover:scale-110 ${isLoading ? 'cursor-wait' : 'cursor-pointer'} ${className}`}
    >
      <FavoriteIcon active={isInFavorite} />
    </button>
  );
};

================
src/features/favorite/ui/index.ts
================

export * from './controls/FavoriteButton';

================
src/features/filters/lib/index.ts
================

export * from './queryParams';

================
src/features/filters/lib/queryParams/CatalogQueryParams.ts
================

import type {
  BaseFilterParams,
  GetVariantsRequest,
  PaginationParams,
  SortingParams,
} from '@/types/ServerData/Catalog';

import { OrderBy, SortOrder } from '@/types/ServerData/Catalog';

export interface CatalogQueryParams
  extends BaseFilterParams,
    SortingParams,
    PaginationParams {}

export class CatalogQueryParamsUtil {
  static parseQueryParams(queryString: string): CatalogQueryParams {
    const params = new URLSearchParams(queryString);

    const result: CatalogQueryParams = {
      // BaseFilterParams
      category_id: null,
      search: params.get('search') || null,
      min_price: null,
      max_price: null,
      brands: [],
      tags: [],
      filters: {},
      min_rating: null,
      max_rating: null,
      // SortingParams
      orderBy: (params.get('order_by') as OrderBy) || OrderBy.popularity,
      sortOrder: (params.get('sort_order') as SortOrder) || SortOrder.desc,
      // PaginationParams
      page: params.has('page') ? parseInt(params.get('page'), 10) : 1,
      limit: 20,
    };

    // Parse numeric values
    if (params.has('min_price')) {
      result.min_price =
        params.get('min_price') === 'null'
          ? null
          : parseInt(params.get('min_price'), 10);
    }
    if (params.has('max_price')) {
      result.max_price =
        params.get('max_price') === 'null'
          ? null
          : parseInt(params.get('max_price'), 10);
    }

    // Parse arrays
    if (params.has('brands')) {
      result.brands = params.get('brands').split(',').map(Number);
    }

    if (params.has('tags')) {
      result.tags = params.get('tags').split(',');
    }

    // Parse ratings
    if (params.has('min_rating')) {
      result.min_rating = parseFloat(params.get('min_rating'));
    }
    if (params.has('max_rating')) {
      result.max_rating = parseFloat(params.get('max_rating'));
    }

    // Parse dynamic filters
    params.forEach((value, key) => {
      if (key.startsWith('filter_')) {
        const filterId = parseInt(key.replace('filter_', ''), 10);
        result.filters[filterId] = value.split(',').map(Number);
      }
    });

    return result;
  }

  static buildQueryParams(params: Partial<CatalogQueryParams>): string {
    const urlParams = new URLSearchParams();

    // Helper to set non-null values
    const setIfPresent = <T>(key: string, value: T | null | undefined) => {
      if (value !== null && value !== undefined) {
        urlParams.set(key, value.toString());
      }
    };

    // Add BaseFilterParams
    setIfPresent('search', params.search);
    setIfPresent('min_price', params.min_price);
    setIfPresent('max_price', params.max_price);
    setIfPresent('min_rating', params.min_rating);
    setIfPresent('max_rating', params.max_rating);

    // Add arrays if not empty
    if (params.brands?.length) {
      urlParams.set('brands', params.brands.join(','));
    }

    if (params.tags?.length) {
      urlParams.set('tags', params.tags.join(','));
    }

    // Add dynamic filters
    if (params.filters) {
      Object.entries(params.filters).forEach(([key, value]) => {
        if (value.length > 0) {
          urlParams.set(`filter_${key}`, value.join(','));
        }
      });
    }

    // Add SortingParams
    setIfPresent('order_by', params.orderBy);
    setIfPresent('sort_order', params.sortOrder);

    // Add PaginationParams
    setIfPresent('page', params.page);
    setIfPresent('limit', params.limit);

    return urlParams.toString();
  }

  static createRequestFromParams(
    params: CatalogQueryParams,
    overrides?: Partial<GetVariantsRequest>
  ): GetVariantsRequest {
    return {
      ...params,
      ...overrides,
    };
  }
}

================
src/features/filters/lib/queryParams/index.ts
================

export * from './CatalogQueryParams';

================
src/features/modals/index.ts
================

export * from './model/context';
export * from './ui/ModalManager';
export { AddressModal } from './ui/modals/AddressModal/AddressModal';
export { AllFiltersModal } from './ui/modals/AllFiltersModal/AllFiltersModal';
================
src/features/modals/model/context.tsx
================

import type { ReactNode } from 'react';
import { createContext, useContext, useState } from 'react';

import type { ModalTypes } from './types';

type ModalContent = {
  [K in keyof ModalTypes]: {
    type: K;
  } & ModalTypes[K];
}[keyof ModalTypes];

interface ModalContextType {
  showModal: (content: ModalContent) => void;
  hideModal: () => void;
  modalContent: ModalContent | null;
  isModalVisible: boolean;
  isLoading: boolean;
  setModalLoading: (loading: boolean) => void;
}

const ModalContext = createContext<ModalContextType>({
  showModal: () => {},
  hideModal: () => {},
  modalContent: null,
  isModalVisible: false,
  isLoading: false,
  setModalLoading: () => {},
});

export const ModalProvider = ({ children }: { children: ReactNode }) => {
  const [modalContent, setModalContent] = useState<ModalContent | null>(null);
  const [isModalVisible, setIsModalVisible] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  const showModal = (content: ModalContent) => {
    setModalContent(content);
    setIsModalVisible(true);
    setIsLoading(false);
  };

  const hideModal = () => {
    setIsLoading(false);
    setModalContent(null);
    setIsModalVisible(false);
  };

  const setModalLoading = (loading: boolean) => {
    setIsLoading(loading);
  };

  return (
    <ModalContext.Provider
      value={{
        showModal,
        hideModal,
        modalContent,
        isModalVisible,
        isLoading,
        setModalLoading,
      }}
    >
      {children}
    </ModalContext.Provider>
  );
};

export const useModal = () => useContext(ModalContext);

================
src/features/modals/model/types.ts
================

export type ModalVariant = 'info' | 'success' | 'warning' | 'error';

export type BaseModalProps = {
  title: string;
  isLoading?: boolean;
};

export type ModalTypes = {
  auth: BaseModalProps & {
    content?: string;
  };
  logout: BaseModalProps;
  share: BaseModalProps & {
    url?: string;
  };
  confirmation: BaseModalProps & {
    text: string;
    action: () => Promise<void> | void;
    variant?: ModalVariant;
    confirmText?: string;
    cancelText?: string;
    data?: any;
  };
  question: BaseModalProps & {
    data?: any;
  };
  modificationAttributes: BaseModalProps & {
    attributesList: Record<string, any>;
    handleChangeAttribute: (event: React.MouseEvent<HTMLDivElement>) => void;
  };
  fastOrder: BaseModalProps & {
    product: any;
  };
};

================
src/features/modals/ui/ModalManager.tsx
================

import type React from 'react';

import { AuthModal, LogoutModal } from '@/features/auth/ui/modals';

import {
  ShareModal,
  QuestionModal,
  ConfirmationModal,
  ModificationAttributesModal,
  ShareCartModal,
  ShowSharedCartModal,
} from './modals';

export const ModalManager: React.FC = () => {
  return (
    <>
      <LogoutModal />
      <AuthModal />
      <ShareModal />
      <QuestionModal />
      <ConfirmationModal />
      <ModificationAttributesModal />
      <ShareCartModal />
      <ShowSharedCartModal />
    </>
  );
};

================
src/features/modals/ui/modals/AddOrganizationModal.tsx
================

import { useEffect, useState } from 'react';

import { Box, Modal } from '@mui/material';
import { Controller, useForm } from 'react-hook-form';

import {
  useAddOrganizationMutation,
  useGetOrgSuggestionsMutation,
} from '@/entities/organization/api/organizationEndpoints';
import CTextField from '@/shared/ui/inputs/CTextField';
import { Loading } from '@/shared/ui/Loader';

import ModalSnackbar from './ModalSnackbar';

const AddOrganizationModal = ({
  open,
  close,
  organizations,
  setOpenAddOrgModal,
}) => {
  const {
    control,
    handleSubmit,
    watch,
    formState: { errors },
  } = useForm();

  const [openSnack, setOpenSnack] = useState(false);
  const [isValue, setIsValue] = useState('');
  const [selectedOrg, setSelectedOrg] = useState({ name: null, inn: null });

  const [getOrgSuggestions, { data }] = useGetOrgSuggestionsMutation();
  const [addOrganization, { isLoading, isSuccess }] =
    useAddOrganizationMutation();

  const handleAddOrganization = async () => {
    const data = {
      inn: Number(selectedOrg.inn),
    };
    await addOrganization(data);
    setOpenSnack(true);
    setOpenAddOrgModal(false);
    setSelectedOrg({ name: null, inn: null });
    setIsValue('');
  };

  useEffect(() => {
    if (isValue === '') return;

    const timeoutId = setTimeout(() => {
      getOrgSuggestions(isValue);
    }, 500);

    return () => clearTimeout(timeoutId);
  }, [isValue, getOrgSuggestions]);

  useEffect(() => {
    if (selectedOrg.name) {
      setIsValue(`${selectedOrg.name}, ${selectedOrg.inn}`);
    }
  }, [selectedOrg]);

  return (
    <>
      <Modal
        open={open}
        onClose={close}
        aria-labelledby="modal-modal-title"
        aria-describedby="modal-modal-description"
      >
        <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none py-10 px-4 mm:px-8 max-w-[500px] w-[95%] mm:w-full">
          <span
            onClick={close}
            className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
          >
            &times;
          </span>
          <h1 className="text-2xl mm:text-3xl text-colBlack mm:text-center pb-5 font-semibold">
            Добавление организации
          </h1>
          {isLoading ? (
            <Loading extraStyle="200px" />
          ) : (
            <form onSubmit={handleSubmit(handleAddOrganization)}>
              <div className="w-full">
                <Controller
                  name="inn"
                  control={control}
                  rules={{
                    validate: {
                      exists: (value) => {
                        return (
                          !organizations.some((org) => org.inn === value) ||
                          'Такая организация уже существует'
                        );
                      },
                    },
                  }}
                  render={({ field }) => (
                    <CTextField
                      {...field}
                      label="Введите ИНН или название организации"
                      type="text"
                      required={true}
                      value={isValue}
                      onChange={(e) => {
                        setIsValue(e.target.value);
                        field.onChange(e);
                      }}
                    />
                  )}
                />
                {data?.suggestions?.length ? (
                  <div className="shadow-md p-3 pb-0">
                    <p className="text-xs opacity-60 mb-1 pb-[2px] border-b">
                      Возможно вы искали:
                    </p>
                    <ul className="max-h-[180px] overflow-y-scroll scrollable space-y-2 pb-1">
                      {data?.suggestions?.map((el) => (
                        <li
                          key={el?.data?.inn}
                          onClick={() =>
                            setSelectedOrg({
                              name: el?.data?.name?.short_with_opf,
                              inn: el?.data?.inn,
                            })
                          }
                          className="text-sm cursor-pointer px-1 border-l-2 border-transparent hover:border-gray-500 duration-200 line-clamp-1 break-all"
                        >
                          {el?.data?.name?.short_with_opf}, ИНН: {el?.data?.inn}
                        </li>
                      ))}
                    </ul>
                  </div>
                ) : null}
                {errors.inn?.type === 'exists' ? (
                  <p className="text-red-600 text-sm font-medium" role="alert">
                    {errors.inn?.message}
                  </p>
                ) : null}
              </div>
              <button
                disabled={!watch('inn')}
                className={` w-full h-[38px] px-6 ${
                  !watch('inn') ? 'bg-colGray' : 'bg-colGreen'
                } rounded mt-5 text-white font-semibold`}
              >
                Сохранить
              </button>
            </form>
          )}
        </Box>
      </Modal>
      <ModalSnackbar
        message={
          isSuccess ? 'Организация успешно добавлена!!' : 'Произошла ошибка'
        }
        open={openSnack}
        onClose={() => setOpenSnack(false)}
      />
    </>
  );
};

export default AddOrganizationModal;

================
src/features/modals/ui/modals/AddressModal/AddressBar.tsx
================

import React from 'react'

function AddressBar() {
  return (
    <div>AddressBar</div>
  )
}

export default AddressBar
================
src/features/modals/ui/modals/AddressModal/AddressModal.tsx
================

import React, { createRef, useEffect, useRef, useState } from 'react';

import { Box, Modal } from '@mui/material';
import { YMaps, Map, Placemark } from '@pbe/react-yandex-maps';
import { Controller, useForm } from 'react-hook-form';
import { useDebounce } from 'react-use';

import { SubwayIcon } from '@/shared/ui/icons';
import { CSearchField } from '@/shared/ui/inputs/CSearchField';
// import CustomRadioButton from '@/shared/ui/CustomRadioButton';

export const AddressModal = ({
  open,
  handleClose,
  addressList,
  setAddressList,
}) => {
  const map = createRef(null);
  const throttleInProgress = useRef();
  const timerDebounceRef = useRef();

  // const coords = useRef();
  const [coords, setCoords] = useState([55.75, 37.57]);
  const [newAddress, setNewAddress] = useState({});

  const handleNewAddress = (coords) => {
    if (timerDebounceRef.current) {
      clearTimeout(timerDebounceRef.current);
    }
    timerDebounceRef.current = setTimeout(() => {
      setCoords(coords);
    }, 1000);
  };

  const fetchSuggest = async (text) => {
    try {
      const suggest = await fetch(
        `https://suggest-maps.yandex.ru/v1/suggest?apikey=358e06a3-dbaf-4e30-aafa-e7f34291e8ec&text=${text}`
      );
      const data = await suggest.json();
    } catch (error) {}
  };

  const fetchCoords = async (text) => {
    try {
      const suggest = await fetch(
        `https://geocode-maps.yandex.ru/1.x/?apikey=d624f793-a72c-4bca-8293-119601027ed7&geocode=${text.replace(' ', '+')}&format=json`
      );
      const data = await suggest.json();
      const c =
        data.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(
          ' '
        );
      setCoords([c[1], c[0]]);
    } catch (error) {}
  };

  const handleSearch = (e) => {
    if (timerDebounceRef.current) {
      clearTimeout(timerDebounceRef.current);
    }
    timerDebounceRef.current = setTimeout(() => {
      fetchSuggest(e.target.value);
      fetchCoords(e.target.value);
    }, 1000);
  };

  const fetchAddress = async () => {
    try {
      const address = await fetch(
        `https://geocode-maps.yandex.ru/1.x/?apikey=d624f793-a72c-4bca-8293-119601027ed7&geocode=${coords[1]},${coords[0]}&format=json`
      );
      const data = await address.json();
      setNewAddress(data);
    } catch (error) {}
  };

  useEffect(() => {
    fetchAddress();
  }, [coords]);

  // const [filter, setFilter] = useState('');

  // const handleFilter = (e) => {
  //     setFilter(e.target.value);
  // }

  // console.log(pickupPoint);

  // const handlePointChange = (e) => {
  //     console.log(e.currentTarget.getAttribute("data-customvalue"));
  //     setPickupPoint(points.find((point) => point.id.toString() === e.currentTarget.getAttribute("data-customvalue")))
  //     console.log(pickupPoint);
  // }

  const points = [
    {
      id: 1,
      address: 'г. Москва, Волгоградский проспект, д. 120',
      coord: [55.684758, 37.738521],
    },
    {
      id: 2,
      address: 'г. Москва, Волгоградский проспект, д. 122',
      coord: [55.884758, 37.438521],
    },
    {
      id: 3,
      address: 'г. Москва, Волгоградский проспект, д. 123',
      coord: [55.584758, 37.438521],
    },
    {
      id: 4,
      address: 'г. Москва, Волгоградский проспект, д. 124',
      coord: [55.584758, 37.138521],
    },
  ];

  // const {
  //     control,
  //     handleSubmit,
  //     reset,
  //     register,
  //     watch,
  //     formState: { errors, isValid },
  // } = useForm({
  //     mode: 'onChange',
  // });

  return (
    <Modal
      open={open}
      onClose={handleClose}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="overflow-hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none w-[80%] ">
        <span
          onClick={handleClose}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>

        <div className="flex justify-between items-start border border-colLightGray rounded-[10px] max-h-[500px] overflow-hidden">
          <div className="p-5 flex flex-col justify-between overflow-hidden h-[500px] w-[40%]">
            <div className="flex flex-col gap-2 mb-5 overflow-hidden ">
              <div className="font-semibold text-lg">
                Выберите адрес доставки
              </div>
              <CSearchField
                label="Город, улица, дом, корпус"
                name="search"
                type="search"
                // value={newAddress}
                handleChange={handleSearch}
              />
              <div className="scrollable overflow-y-scroll flex flex-col gap-2 pr-2">
                {/* {points?.map((point, index) => {
                                    return (
                                        <CustomRadioButton key={point.id} value={point.id} handleChange={handlePointChange} checked={point.id.toString() === pickupPoint.id.toString()}>
                                            <div className='flex flex-col gap-2 '>
                                                <div className='flex gap-1'>
                                                    <SubwayIcon />
                                                    <div className=''>Кузьминки</div>
                                                </div>
                                                <div className='font-medium'>{point.address}</div>
                                                <div className='text-[12px] text-colDarkGray'>Пн-Сб: с 9:00 до 21:00 Вс: с 10:00 до 18:00</div>
                                                <div className='font-semibold text-colGreen'>Забирайте сегодня</div>
                                            </div>

                                        </CustomRadioButton>

                                    )

                                })} */}
              </div>
              <button
                onClick={handleClose}
                className="bg-colGreen text-white py-4 rounded font-semibold"
              >
                Выбрать
              </button>
            </div>
          </div>

          <YMaps>
            <div className="rounded overflow-hidden grow ">
              <Map
                className="w-full h-[500px] grow"
                defaultState={{ center: coords, zoom: 9 }}
                instanceRef={map}
              >
                <Placemark
                  geometry={coords}
                  options={{ draggable: true }}
                  instanceRef={(ref) => {
                    if (ref) {
                      ref.geometry.events.add('change', function (e) {
                        const newCoords = e.get('newCoordinates');
                        // coords.current = newCoords
                        handleNewAddress(newCoords);
                      });
                    }
                  }}
                />
              </Map>
            </div>
          </YMaps>
          <div className="bg-white rounded h-10 w-[30%] absolute bottom-[10%] left-1/2 -translate-x-1/2 z-10">
            {`${newAddress?.response?.GeoObjectCollection?.featureMember[0]?.GeoObject?.name}, ${newAddress?.response?.GeoObjectCollection?.featureMember[0]?.GeoObject?.description}` ||
              'Выберите адрес'}
          </div>
        </div>
      </Box>
    </Modal>
  );
};

================
src/features/modals/ui/modals/AllFiltersModal/AllFiltersModal.tsx
================

import React from 'react';

import { Box, Checkbox, FormControlLabel, Modal, Slider } from '@mui/material';

import { IOSSwitch } from '@/shared/ui';
import BrandsFilter from '@components/Catalog/CatalogSidebar/SidebarFilters/BrandsFilter';
import DynamicFilters from '@components/Catalog/CatalogSidebar/SidebarFilters/DynamicFilters';
import PriceFilter from '@components/Catalog/CatalogSidebar/SidebarFilters/PriceFilter';
import TagsFilters from '@components/Catalog/CatalogSidebar/SidebarFilters/TagsFilters';
import SidebarFiltersSkeleton from '@components/Catalog/CatalogSidebar/SidebarFiltersSkeleton';

export const AllFiltersModal = ({
  categoryTree,
  open,
  setOpen,
  filters,
  setFilters,
  trigger,
  setTrigger,
  resetFilters,
  filtersIsLoading,
  filtersBlock,
}) => {
  return (
    <Modal
      open={open}
      onClose={() => setOpen(false)}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full mm:w-[95%] lg:w-[85%] h-full mm:h-[95%] lg:h-[90%] lining-nums proportional-nums bg-white outline-none rounded-lg border-none p-[12px_4px_12px_12px] lg:p-[24px_4px_24px_24px] overflow-x-auto">
        <div className="flex flex-col justify-between h-full">
          <div className="h-[90%]">
            <div className="flex justify-between items-center pr-3 lg:pr-5">
              <h2 className="text-colBlack text-2xl lg:text-3xl font-semibold">
                {/* {!categoryTreeIsLoading &&
          categoryTreeIsSuccess &&
          categoryTree?.category?.name} */}
                {categoryTree?.category?.name}
              </h2>

              <span
                onClick={() => setOpen(false)}
                className="text-4xl lg:text-5xl text-colGray font-light cursor-pointer"
              >
                &times;
              </span>
            </div>
            {filtersIsLoading ? <SidebarFiltersSkeleton /> : null}
            <div
              className={`${
                filtersIsLoading ? 'hidden' : ''
              }  border border-colSuperLight rounded-2xl px-3 pb-5 shadow-[0px_15px_20px_0px_rgba(0,_0,_0,_0.05)] mt-2 relative flex flex-wrap gap-5`}
            >
              {filtersBlock ? (
                <div className=" cursor-wait absolute top-0 left-0 w-full h-full bg-white opacity-30 z-10"></div>
              ) : null}
              {filters?.basics?.price ? (
                <div className=" sm:basis-[calc(33%-(20px*2/3))] md:basis-[calc(25%-(20px*3/4))]">
                  <PriceFilter
                    filters={filters}
                    setFilters={setFilters}
                    trigger={trigger}
                    setTrigger={setTrigger}
                  />
                </div>
              ) : null}

              {filters?.basics?.brands?.length > 0 ? (
                <div className="sm:basis-[calc(33%-(20px*2/3))] md:basis-[calc(25%-(20px*3/4))]">
                  <BrandsFilter filters={filters} setFilters={setFilters} />
                </div>
              ) : null}
              {filters?.basics?.tags?.length > 0 ? (
                <div className="sm:basis-[calc(33%-(20px*2/3))] md:basis-[calc(25%-(20px*3/4))]">
                  <TagsFilters filters={filters} setFilters={setFilters} />
                </div>
              ) : null}
              {filters?.dynamics?.length > 0 ? (
                <DynamicFilters
                  filters={filters}
                  setFilters={setFilters}
                  hideAdditional={false}
                />
              ) : null}
              <FormControlLabel
                sx={{ margin: '10px 0' }}
                control={
                  <IOSSwitch
                    sx={{ m: 1 }}
                    defaultChecked
                    onChange={(e) =>
                      handleChange('highRating', e.target.checked)
                    }
                  />
                }
                labelPlacement="start"
                label={
                  <p className="text-sm font-semibold text-colBlack">
                    Высокий рейтинг
                  </p>
                }
              />
              {filters?.more?.length > 0 ? (
                <button
                  onClick={() => setOpen(true)}
                  className="bg-white border border-colGreen w-full rounded-md mb-3 p-2 text-colBlack font-semibold outline-none"
                >
                  Все фильтры
                </button>
              ) : null}
              <span
                onClick={resetFilters}
                className="text-colDarkGray font-semibold flex justify-center cursor-pointer"
              >
                Очистить фильтр
              </span>
            </div>
          </div>
        </div>
      </Box>
    </Modal>
  );
};


================
src/features/modals/ui/modals/CatalogModal.tsx
================

import { useEffect, useState } from 'react';

import { NavLink } from 'react-router-dom';

import { useGetCategoryTreeQuery } from '@/entities/category';
import { useGetBasicFiltersQuery } from '@/entities/filter';
import noImg from '@/shared/assets/images/no-image.png';
import { ArrowIcon } from '@/shared/ui/icons';

const CatalogModal = ({ showCatalog, setShowCatalog }) => {
  const { data } = useGetCategoryTreeQuery();
  const categoryTree = data?.children;

  // const { hideModal, modalContent, isModalVisible } = useModal();

  const { data: basicFilters } = useGetBasicFiltersQuery();

  const [scrollPosition, setScrollPosition] = useState(0);
  const [activeItem, setActiveItem] = useState(null);
  const [showAll, setShowAll] = useState(null);

  const handleItemClick = (el) => {
    setActiveItem(el);
  };

  useEffect(() => {
    const handleBodyOverflow = () => {
      if (showCatalog) {
        // if (isModalVisible && modalContent.type === 'catalog') {
        document.body.style.overflowY = 'hidden';
      } else {
        document.body.style.overflowY = 'auto';
      }
    };

    handleBodyOverflow();

    return () => {
      document.body.style.overflowY = 'auto';
    };
  }, [showCatalog]);
  // }, [isModalVisible]);

  useEffect(() => {
    const handleScroll = () => {
      const position = window.pageYOffset || document.documentElement.scrollTop;
      setScrollPosition(position);
    };

    window.addEventListener('scroll', handleScroll);

    return () => {
      window.removeEventListener('scroll', handleScroll);
    };
  }, []);

  return (
    <div
      className={`fixed left-0 w-full h-full z-[999] hidden md:block ${
        scrollPosition > 32 ? 'top-[65px]' : 'top-[100px]'
      } bg-white duration-300 overflow-hidden`}
    >
      <div
        className={`${
          scrollPosition > 32 ? 'h-[90%]' : 'h-[85%]'
        } content overflow-y-auto`}
      >
        <div className="flex pt-5">
          <div className="max-w-[220px] w-full">
            <ul className="pr-4 border-r border-[#EBEBEB] space-y-3 sticky top-0">
              {basicFilters?.tags?.map((tag) => (
                <NavLink
                  to={`/catalog/tags?tags=${tag?.tag}`}
                  onClick={() => setShowCatalog(false)}
                  key={tag?.tag}
                  className="rounded h-[27px] flex items-end p-1"
                >
                  <img
                    src={tag?.dark_icon?.medium}
                    className="w-7 h-7"
                    alt="*"
                  />

                  <span className="text-colBlack leading-[115%] font-semibold pl-2">
                    {tag?.tag}
                  </span>
                </NavLink>
              ))}
              {categoryTree?.map((el) => (
                <li key={el?.id}>
                  <NavLink
                    to={`/catalog/${el?.slug}`}
                    onMouseOver={() => handleItemClick(el)}
                    onClick={() => setShowCatalog(false)}
                    className={`${
                      activeItem?.id === el?.id && 'bg-colSuperLight'
                    } flex justify-between items-center hover:bg-colSuperLight rounded-md p-1`}
                  >
                    <div className="flex items-center">
                      <img
                        className="w-7"
                        onError={(e) => {
                          e.target.onError = null;
                          e.target.src = noImg;
                        }}
                        src={el?.image?.small || noImg}
                        alt="*"
                      />
                      <span className="text-colBlack leading-[115%] font-semibold pl-2">
                        {el?.name}
                      </span>
                      <ArrowIcon className="rotate-[90deg] min-w-[12px]" />
                    </div>
                  </NavLink>
                </li>
              ))}
            </ul>
          </div>
          <div className="w-full pl-5">
            <h2 className="text-2xl text-colBlack font-semibold pb-4">
              {activeItem?.name}
            </h2>
            {activeItem?.children?.length > 0 ? (
              <div className="grid grid-cols-2 lg:grid-cols-3 gap-5">
                {activeItem?.children?.map((el) => (
                  <div key={el?.id}>
                    <NavLink
                      to={`/catalog/${el?.slug}`}
                      onClick={() => setShowCatalog(false)}
                      className="font-semibold text-colBlack hover:text-colGreen leading-[120%]"
                    >
                      {el?.name}
                    </NavLink>
                    {el?.children?.length > 0 ? (
                      <div className="pt-1">
                        {el?.children
                          ?.slice(0, showAll === el?.id ? undefined : 5)
                          ?.map((child) => (
                            <div key={child?.id}>
                              <NavLink
                                to={`/catalog/${child?.slug}`}
                                onClick={() => setShowCatalog(false)}
                                className="text-colBlack text-sm hover:text-colGreen"
                              >
                                {child?.name}
                              </NavLink>
                            </div>
                          ))}
                        {showAll !== el?.id && el?.children?.length > 5 ? (
                          <div
                            onClick={() => setShowAll(el?.id)}
                            className="cursor-pointer font-medium text-sm text-colGreen"
                          >
                            Показать еще
                          </div>
                        ) : null}
                      </div>
                    ) : null}
                  </div>
                ))}
              </div>
            ) : null}
          </div>
        </div>
      </div>
    </div>
  );
};

export default CatalogModal;

================
src/features/modals/ui/modals/CatalogModalMobile.tsx
================

import { useEffect, useState } from 'react';

import { NavLink, useLocation } from 'react-router-dom';

import { useGetCategoryTreeQuery } from '@/entities/category';
import { useGetBasicFiltersQuery } from '@/entities/filter';
import arrowBack from '@/shared/assets/icons/arrow-black.svg';
import noImg from '@/shared/assets/images/no-image.png';
import { ArrowIcon } from '@/shared/ui/icons';

const CatalogModalMobile = ({ showCatalog, setShowCatalog }) => {
  const { data } = useGetCategoryTreeQuery();
  const categoryTree = data?.children;
  const { pathname } = useLocation();

  const { data: basicFilters } = useGetBasicFiltersQuery();

  const [scrollPosition, setScrollPosition] = useState(0);
  const [activeItem, setActiveItem] = useState({});
  const [isOpen, setIsOpen] = useState(null);

  useEffect(() => {
    const handleBodyOverflow = () => {
      if (showCatalog) {
        document.body.style.overflowY = 'hidden';
      } else {
        document.body.style.overflowY = 'auto';
      }
    };
    handleBodyOverflow();

    return () => {
      document.body.style.overflowY = 'auto';
    };
  }, [showCatalog]);

  useEffect(() => {
    const handleScroll = () => {
      const position = window.pageYOffset || document.documentElement.scrollTop;
      setScrollPosition(position);
    };

    window.addEventListener('scroll', handleScroll);

    return () => {
      window.removeEventListener('scroll', handleScroll);
    };
  }, []);

  useEffect(() => {
    setShowCatalog(false);
  }, [pathname]);

  return (
    <div
      className={`fixed left-0 w-full h-full z-[50] md:hidden ${
        scrollPosition > 32 ? 'top-[64px]' : 'top-[105px]'
      } bg-white duration-300 `}
    >
      <div
        className={`${
          scrollPosition > 32
            ? 'h-[calc(100dvh-136px)] overflow-y-auto'
            : 'h-[calc(100dvh-182px)] overflow-y-auto'
        } content scrollable relative`}
      >
        <div className="flex pt-5">
          <div className="w-full">
            <ul className="space-y-3">
              {basicFilters?.tags?.map((tag) => (
                <NavLink
                  to={`/catalog/tags?tags=${tag?.tag}`}
                  onClick={() => setShowCatalog(false)}
                  key={tag?.tag}
                  className="rounded h-[27px] flex items-end p-1"
                >
                  <img
                    src={tag?.dark_icon?.medium}
                    className="w-7 h-7"
                    alt="*"
                  />

                  <span className="text-colBlack leading-[115%] font-semibold pl-2">
                    {tag?.tag}
                  </span>
                </NavLink>
              ))}
              {categoryTree?.map((el) => {
                if (!el?.children) {
                  return (
                    <div
                      key={el?.id}
                      className="flex justify-between items-center p-1 w-full border-b pb-2"
                    >
                      <div className="flex items-center">
                        <img
                          className="w-7"
                          onError={(e) => {
                            e.target.onError = null;
                            e.target.src = noImg;
                          }}
                          src={el?.image?.small || noImg}
                          alt="*"
                        />
                        <NavLink
                          to={`/catalog/${el?.slug}`}
                          onClick={() => setShowCatalog(false)}
                          className="text-colBlack leading-[115%] font-semibold pl-2 text-left"
                        >
                          {el?.name}
                        </NavLink>
                      </div>
                    </div>
                  );
                }

                if (el?.children) {
                  return (
                    <li key={el?.id}>
                      <button
                        onClick={() => setActiveItem(el)}
                        className={`${
                          activeItem?.id === el?.id && 'bg-colSuperLight'
                        } flex justify-between items-center p-1 w-full border-b pb-2`}
                      >
                        <div className="flex items-center">
                          <img
                            className="w-7"
                            onError={(e) => {
                              e.target.onError = null;
                              e.target.src = noImg;
                            }}
                            src={el?.image?.small || noImg}
                            alt="*"
                          />
                          <span className="text-colBlack leading-[115%] font-semibold pl-2 text-left">
                            {el?.name}
                          </span>
                        </div>
                        <ArrowIcon className="rotate-[90deg] min-w-[12px]" />
                      </button>
                    </li>
                  );
                }
              })}
            </ul>
          </div>
        </div>
        {Object.keys(activeItem)?.length > 0 ? (
          <div
            className={`${
              scrollPosition > 32
                ? 'h-[calc(100vh-136px)] top-[64px] overflow-y-auto'
                : 'h-[calc(100vh-182px)] top-[105px] overflow-y-auto'
            } fixed left-0 bg-white px-3 w-full scrollable`}
          >
            <button
              onClick={() => setActiveItem({})}
              className="flex items-center"
            >
              <img className="rotate-[90deg]" src={arrowBack} alt="*" />
              <span className="ml-1 font-medium text-sm py-1">
                Вернуться к каталогу
              </span>
            </button>
            <h2 className="text-2xl text-colBlack font-semibold pt-1 pb-3">
              {activeItem?.name}
            </h2>
            {activeItem?.children?.length > 0 ? (
              <div className="space-y-2">
                {activeItem?.children?.map((el) => (
                  <div key={el?.id}>
                    <div className="font-semibold text-colBlack leading-[120%] border-b w-full flex justify-between items-center pb-1">
                      <NavLink
                        to={`/catalog/${el?.slug}`}
                        onClick={() => setShowCatalog(false)}
                      >
                        {el?.name}
                      </NavLink>
                      {el?.children?.length > 0 ? (
                        <button
                          onClick={() =>
                            setIsOpen(isOpen === el?.id ? null : el?.id)
                          }
                          className={`${
                            isOpen === el?.id
                              ? 'rotate-[180deg]'
                              : 'rotate-[0deg]'
                          } w-6 h-6 flex justify-center items-center duration-200`}
                        >
                          <img src={arrowBack} alt="*" />
                        </button>
                      ) : null}
                    </div>
                    {el?.children?.length > 0 && isOpen === el?.id ? (
                      <div className="pt-1 pl-3">
                        {el?.children?.map((child) => (
                          <div key={child?.id}>
                            <NavLink
                              to={`/catalog/${child?.slug}`}
                              onClick={() => setShowCatalog(false)}
                              className="text-colBlack text-sm hover:text-colGreen"
                            >
                              {child?.name}
                            </NavLink>
                          </div>
                        ))}
                      </div>
                    ) : null}
                  </div>
                ))}
              </div>
            ) : null}
          </div>
        ) : null}
      </div>
    </div>
  );
};

export default CatalogModalMobile;

================
src/features/modals/ui/modals/CitiesModal.tsx
================

import { useEffect, useState } from 'react';

import { Box, Modal } from '@mui/material';

import { useGetCitiesAndRegionsQuery } from '@/entities/order/api/orderApi';
import ErrorEmpty from '@/helpers/Errors/ErrorEmpty';
import search from '@/shared/assets/icons/search.svg';
import { Loading } from '@/shared/ui/Loader';

const CitiesModal = ({ open, setOpen, city, setCity }) => {
  const { isLoading, isError, data: locations } = useGetCitiesAndRegionsQuery();
  const [regionID, setRegionID] = useState(null);
  const [cities, setCities] = useState([]);
  const [regions, setRegions] = useState([]);

  const handleFilterByRegion = (regionId) => {
    const filteredCities = locations?.cities?.filter(
      (city) => city?.region_id === regionId
    );
    setCities(filteredCities);
  };

  const handleCitySearch = (e) => {
    e.preventDefault();
    const value = e.target.value;
    if (value) {
      const normalizedQuery = value.toLowerCase();
      const filteredCities = locations?.cities?.filter((city) =>
        city?.name ? city.name.toLowerCase().includes(normalizedQuery) : false
      );
      const filteredRegions = locations?.regions?.filter((region) =>
        region?.name
          ? region.name.toLowerCase().includes(normalizedQuery)
          : false
      );
      setCities(filteredCities);
      setRegions(filteredRegions);
    }
  };

  useEffect(() => {
    setCities(locations?.cities);
    setRegions(locations?.regions);
  }, [isLoading]);

  if (!open) return null;

  return (
    <Modal
      open={open}
      onClose={() => setOpen(false)}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute mm:top-1/2 mm:left-1/2 mm:-translate-x-1/2 mm:-translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none p-3 mm:p-8 max-w-[1180px] w-full mm:w-[95%] xl:w-full h-full mm:h-[600px] overflow-hidden">
        <span
          onClick={() => setOpen(false)}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>
        <h2 className="text-2xl text-colBlack pb-5 font-bold mm:text-left pt-6 text-center">
          Выберите ваш город
        </h2>
        <form
          onSubmit={(e) => handleCitySearch(e)}
          className="max-w-[580px] w-full border-colGreen border rounded-md flex justify-between"
        >
          <input
            className="w-full h-10 outline-none rounded-l-md bg-white px-3 border-none"
            type="search"
            onChange={(e) => handleCitySearch(e)}
            placeholder="Название города или области"
          />
          <div className="bg-colGreen w-14 flex justify-center items-center">
            <img className="mx-auto" src={search} alt="*" />
          </div>
        </form>
        {isLoading ? (
          <div className="h-[430px]">
            <Loading />
          </div>
        ) : isError ? (
          <ErrorEmpty
            title="Что-то пошло не так!"
            desc="Произошла ошибка! Пожалуйста, повторите попытку еще раз."
            height="420px"
          />
        ) : (
          <div className="flex mt-8">
            <ul className="hidden md:block w-[220px] h-[430px] space-y-2 overflow-y-scroll scrollable pr-2">
              {regions?.length > 0 ? (
                <>
                  {regions?.map((el) => (
                    <li
                      className={`${
                        regionID === el?.id && 'bg-colSuperLight'
                      } cursor-pointer font-semibold text-colBlack px-2 py-[5px] rounded leading-[120%]`}
                      onClick={() => {
                        setRegionID(el?.id);
                        handleFilterByRegion(el?.id);
                      }}
                      key={el?.id}
                    >
                      {el?.name}
                    </li>
                  ))}
                </>
              ) : (
                <div className="text-center h-[430px] flex flex-col justify-center items-center">
                  <h3 className="font-semibold text-lg">Список пуст!</h3>
                  <p className="text-sm leading-[115%] pt-2">
                    Ничего не найдено для указанного региона.
                  </p>
                </div>
              )}
            </ul>
            <div className="w-full h-screen mm:h-[430px] md:px-4 overflow-y-scroll scrollable">
              {cities?.length > 0 ? (
                <ul className="flex flex-wrap">
                  {cities?.map((el) => (
                    <li
                      className={`${
                        city?.id === el?.id && 'text-colGreen'
                      } w-2/4 lg:w-2/6 xl:w-1/4 text-sm leading-[120%] cursor-pointer hover:text-colGreen duration-200 p-2 my-1 md:my-5`}
                      key={el?.id}
                      onClick={() => {
                        setCity(el);
                        setOpen(false);
                      }}
                    >
                      {el?.name}
                    </li>
                  ))}
                </ul>
              ) : (
                <ErrorEmpty
                  title="Список пуст!"
                  desc="К сожалению, по вашему запросу ничего не нашли."
                  height="420px"
                />
              )}
            </div>
          </div>
        )}
      </Box>
    </Modal>
  );
};

export default CitiesModal;

================
src/features/modals/ui/modals/ConfirmationModal.tsx
================

// src/components/ConfirmationModal.js

import { Box, Modal } from '@mui/material';

import { useModal } from '@/features/modals/model/context';

const ConfirmationModal = () => {
  const { hideModal, modalContent, isModalVisible } = useModal();

  if (!isModalVisible) return null;

  return (
    <Modal
      open={isModalVisible ? modalContent.type === 'confirmation' : null}
      onClose={hideModal}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none px-6 py-8 max-w-[480px] w-[95%] mm:w-full">
        <span
          onClick={hideModal}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>
        <h1 className="pt-1 text-2xl mm:text-3xl text-colBlack font-semibold">
          {modalContent.title}
        </h1>
        <p className="text-colBlack my-2">{modalContent.text}</p>
        <div className="flex space-x-3 pt-5">
          <button
            onClick={() => hideModal()}
            className="w-1/2 h-[38px] px-6 border border-colGreen bg-white rounded text-colGreen font-semibold"
          >
            Отменить
          </button>
          <button
            onClick={() => {
              modalContent.action(modalContent.product);
              hideModal();
            }}
            className="w-1/2 h-[38px] px-6 bg-colGreen rounded text-white font-semibold"
          >
            Да
          </button>
        </div>
      </Box>
    </Modal>
  );
};

export default ConfirmationModal;

================
src/features/modals/ui/modals/DeleteOrganizationModal.tsx
================

import { Box, Modal } from '@mui/material';

import { Loading } from '@/shared/ui/Loader';

const DeleteOrganizationModal = ({
  open,
  close,
  item,
  handleDeleteOrganization,
  deleteLoading,
  delOrgSuccess,
}) => {
  const handleDelete = () => {
    handleDeleteOrganization(item?.id);
    if (delOrgSuccess) {
      close();
    }
  };

  return (
    <Modal
      open={open}
      onClose={close}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none py-10 px-4 mm:px-8 max-w-[500px] w-[95%] mm:w-full">
        {deleteLoading ? (
          <div className="h-[162px]">
            <Loading />
          </div>
        ) : (
          <div>
            {' '}
            <span
              onClick={close}
              className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
            >
              &times;
            </span>
            <h1 className="text-2xl mm:text-3xl text-colBlack font-semibold">
              Удаление организации
            </h1>
            <p className="text-colBlack my-2">
              Вы уверены, что хотите удалить организацию:
            </p>
            <h4 className="text-xl font-semibold text-colBlack">
              {item?.name}
            </h4>
            <div className="flex space-x-3 pt-5">
              <button
                onClick={close}
                className="w-1/2 h-[38px] px-6 border border-colGreen bg-white rounded text-colGreen font-semibold"
              >
                Отменить
              </button>
              <button
                onClick={handleDelete}
                className="w-1/2 h-[38px] px-6 bg-colGreen rounded text-white font-semibold"
              >
                Удалить
              </button>
            </div>
          </div>
        )}
      </Box>
    </Modal>
  );
};

export default DeleteOrganizationModal;

================
src/features/modals/ui/modals/FastOrderModal.tsx
================

import React, { useState } from 'react';

import { Box, Modal } from '@mui/material';
import { Controller, useForm } from 'react-hook-form';
import { NavLink } from 'react-router-dom';

import { useModal } from '@/features/modals/model/context';
import CPhoneField from '@/shared/ui/inputs/CPhoneField';
import CTextField from '@/shared/ui/inputs/CTextField';

const FastOrderModal = () => {
  const { hideModal, isModalVisible, modalContent } = useModal();

  const [privacyPolicy, setPrivacyPolicy] = useState(true);

  const {
    control,
    handleSubmit,
    reset,
    register,
    watch,
    formState: { errors, isValid },
  } = useForm({
    mode: 'onChange',
  });

  const onSubmitAuthCheck = async (data) => {
    reset();
  };

  return (
    <Modal
      open={isModalVisible ? modalContent.type === 'fastOrder' : null}
      onClose={hideModal}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none py-10 px-8 max-w-[500px] w-full">
        <span
          onClick={hideModal}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>
        <div className=" font-semibold text-3xl mb-3"> Быстрый заказ</div>
        <div className="mb-5">
          Укажите контактные данные, менеджер свяжется в ближайшее время для
          уточнения деталей
        </div>
        <form
          onSubmit={handleSubmit(onSubmitAuthCheck)}
          className="flex flex-col gap-4"
        >
          <div className="flex flex-col gap-4">
            <div className="">
              <Controller
                name="name"
                control={control}
                defaultValue=""
                render={({ field }) => (
                  <CTextField
                    label="Имя"
                    type="text"
                    required={true}
                    onChange={field.onChange}
                    value={field.value}
                  />
                )}
              />
            </div>

            <div className="">
              <Controller
                name="phone"
                control={control}
                defaultValue=""
                rules={{
                  required: 'Поле обязательно к заполнению!',
                  pattern: {
                    value:
                      /^((\+7|7|8)[\s\-]?)?(\(?\d{3}\)?[\s\-]?)?[\d\s\-]{10}$/,
                    message: 'Введите корректный номер телефона',
                  },
                }}
                render={({ field }) => (
                  <CPhoneField required={true} label="Телефон" {...field} />
                )}
              />
            </div>
          </div>

          <button className=" bg-colGreen rounded p-3 text-white font-semibold">
            Отправить
          </button>

          <input className="hidden" type="checkbox" id="checkbox" />
          <label
            htmlFor="checkbox"
            onClick={() => setPrivacyPolicy(!privacyPolicy)}
            className="text-sm flex cursor-pointer mm:items-center w-full"
          >
            <div className="w-5 h-5 min-w-[20px] mr-2 flex justify-center items-center bg-colGreen rounded-sm">
              {privacyPolicy ? (
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="12"
                  height="9"
                  viewBox="0 0 12 9"
                  fill="none"
                >
                  <g clipPath="url(#clip0_701_1390)">
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M11.8546 0.646894C11.9012 0.693339 11.9381 0.748515 11.9633 0.80926C11.9886 0.870005 12.0015 0.935127 12.0015 1.00089C12.0015 1.06666 11.9886 1.13178 11.9633 1.19253C11.9381 1.25327 11.9012 1.30845 11.8546 1.35489L4.85463 8.35489C4.80819 8.40146 4.75301 8.4384 4.69227 8.46361C4.63152 8.48881 4.5664 8.50179 4.50063 8.50179C4.43486 8.50179 4.36974 8.48881 4.309 8.46361C4.24825 8.4384 4.19308 8.40146 4.14663 8.35489L0.646631 4.85489C0.552745 4.76101 0.5 4.63367 0.5 4.50089C0.5 4.36812 0.552745 4.24078 0.646631 4.14689C0.740518 4.05301 0.867856 4.00026 1.00063 4.00026C1.13341 4.00026 1.26075 4.05301 1.35463 4.14689L4.50063 7.29389L11.1466 0.646894C11.1931 0.600331 11.2483 0.563388 11.309 0.538181C11.3697 0.512975 11.4349 0.5 11.5006 0.5C11.5664 0.5 11.6315 0.512975 11.6923 0.538181C11.753 0.563388 11.8082 0.600331 11.8546 0.646894Z"
                      fill="white"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_701_1390">
                      <rect
                        width="11.5015"
                        height="8.00179"
                        fill="white"
                        transform="translate(0.5 0.5)"
                      />
                    </clipPath>
                  </defs>
                </svg>
              ) : null}
            </div>
            <p className="text-[10px] leading-3 text-colDarkGray">
              Я даю согласие на обработку моих персональных данных и принимаю
              условия
              <NavLink className="ml-1 text-colGreen" tablet="_blank" to="#">
                Пользовательского соглашения и Политики обработки персональных
                данных
              </NavLink>
            </p>
          </label>
        </form>
      </Box>
    </Modal>
  );
};

export default FastOrderModal;

================
src/features/modals/ui/modals/index.ts
================

export { default as AddOrganizationModal } from './AddOrganizationModal';
export { AddressModal } from './AddressModal/AddressModal';
export { AllFiltersModal } from './AllFiltersModal/AllFiltersModal';
export { default as CatalogModal } from './CatalogModal';
export { default as CatalogModalMobile } from './CatalogModalMobile';
export { default as CitiesModal } from './CitiesModal';
export { default as ConfirmationModal } from './ConfirmationModal';
export { default as DeleteOrganizationModal } from './DeleteOrganizationModal';
export { default as FastOrderModal } from './FastOrderModal';
export { default as ModalSnackbar } from './ModalSnackbar';
export { default as ModificationAttributesModal } from './ModificationAttributesModal';
export { default as PickupPointModal } from './PickupPointModal';
export { default as QuestionModal } from './QuestionModal';
export { default as ReviewModal } from './ReviewModal';
export { default as SearchFiltersModal } from './SearchFiltersModal';
export { ShareCartModal } from './ShareCartModal';
export { default as ShareModal } from './ShareModal';
export { default as ShowSharedCartModal } from './ShowSharedCartModal';
export { default as UpdateOrganizationModal } from './UpdateOrganizationModal';

================
src/features/modals/ui/modals/ModalSnackbar.tsx
================

import CloseIcon from '@mui/icons-material/Close';
import IconButton from '@mui/material/IconButton';
import Snackbar from '@mui/material/Snackbar';

const ModalSnackbar = ({ message, open, onClose }) => {
  const action = (
    <IconButton
      size="small"
      aria-label="close"
      color="inherit"
      onClick={onClose}
    >
      <CloseIcon fontSize="small" />
    </IconButton>
  );

  return (
    <div>
      <Snackbar
        open={open}
        autoHideDuration={6000}
        onClose={onClose}
        message={message}
        action={action}
        style={{ maxWidth: '400px' }}
      />
    </div>
  );
};

export default ModalSnackbar;

================
src/features/modals/ui/modals/ModificationAttributesModal.tsx
================

import React from 'react';

import { Box, Modal } from '@mui/material';
import { useSelector } from 'react-redux';

import ProductAttributeValue from '@/components/ProductPage/Attributes/ProductAttributeValue';
import { AddToCartButton, QuantityControl } from '@/features/cart';
import { useModal } from '@/features/modals/model/context';
import { LoadingSmall } from '@/shared/ui/Loader';

import type { RootState } from '@/app/providers/store';

// Выносим содержимое в отдельный компонент
const ModalContent = ({ modalContent, hideModal }) => {
  const { attributesList, handleChangeAttribute, product } = modalContent;

  const { cart } = useSelector((state: RootState) => state.cart);

  const productInCart = cart.find((el) => el.id === product.id);

  return (
    <Box
      className="absolute top-4 left-4  md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2  lining-nums proportional-nums
     bg-white rounded-lg border-none outline-none max-w-[calc(100vw-32px)] max-h-[calc(100vh-32px)] 
     md:max-w-[50vw]  md:w-full overflow-y-auto flex flex-col"
    >
      <span
        onClick={() => hideModal()}
        className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
      >
        &times;
      </span>
      <h1 className="text-2xl mm:text-3xl text-colBlack font-semibold mt-7 px-2">
        {product?.fullName}
      </h1>
      <div className="max-h-[60vh] lg:h-auto overflow-auto w-full p-2">
        {attributesList
          ? Object.keys(attributesList).map((attr) => (
              <div key={attr} className="mb-4">
                <div className="flex mb-2">
                  <p className="text-colDarkGray mr-1">{attr}:</p>
                  {attributesList[attr]?.values[0]?.type === 'color'
                    ? attributesList[attr]?.values?.find(
                        (value) => value.current
                      )?.text
                    : null}
                </div>
                <div className="flex flex-wrap gap-2">
                  {attributesList[attr].values.map((value) => (
                    <ProductAttributeValue
                      key={value.value}
                      id={attributesList[attr].id}
                      value={value}
                      handleChangeAttribute={handleChangeAttribute}
                    />
                  ))}
                </div>
              </div>
            ))
          : null}
      </div>
      <div className="mx-auto lg:mx-3 self-end w-[300px]   my-3">
        {!productInCart ? (
          <AddToCartButton product={product}>
            {({
              handleAddToCartClick,
              isLoading,
              isSuccess,
              buttonText,
              disabled,
            }) => (
              <button
                disabled={disabled || isLoading}
                onClick={handleAddToCartClick}
                className={`transition-all flex justify-center items-center min-h-10 xs:text-sm sm:text-base duration-200 ${
                  disabled ? 'bg-colGray ' : 'bg-colGreen cursor-pointer'
                }  text-white rounded-md p-2 font-semibold w-full ${
                  isLoading && !disabled ? 'cursor-wait' : ''
                } lining-nums proportional-nums`}
              >
                {isLoading && !isSuccess ? (
                  <LoadingSmall extraStyle="white" />
                ) : (
                  buttonText
                )}
              </button>
            )}
          </AddToCartButton>
        ) : null}
        {productInCart ? (
          <div className="flex justify-between gap-2">
            <QuantityControl product={productInCart} enableRemove={true} />
          </div>
        ) : null}
      </div>
    </Box>
  );
};

const ModificationAttributesModal = () => {
  const { hideModal, modalContent, isModalVisible } = useModal();

  if (
    !isModalVisible ||
    !modalContent ||
    modalContent.type !== 'modificationAttributes'
  ) {
    return null;
  }

  return (
    <Modal
      open={true}
      onClose={hideModal}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <ModalContent
        key={JSON.stringify(modalContent.attributesList)}
        modalContent={modalContent}
        hideModal={hideModal}
      />
    </Modal>
  );
};

export default ModificationAttributesModal;

================
src/features/modals/ui/modals/PickupPointModal.tsx
================

import React, { useState } from 'react';

import { Box, Modal } from '@mui/material';
import { YMaps, Map, Placemark } from '@pbe/react-yandex-maps';

import { CSearchField } from '@/shared/ui';
import { SubwayIcon } from '@/shared/ui/icons';
import { CustomRadioButton } from '@pages/Checkout/CustomRadioButton';

const PickupPointModal = ({
  open,
  handleClose,
  pickupPoint,
  setPickupPoint,
}) => {
  const [filter, setFilter] = useState('');

  const handleFilter = (e) => {
    setFilter(e.target.value);
  };

  const handlePointChange = (e) => {
    setPickupPoint(
      points.find(
        (point) =>
          point.id.toString() ===
          e.currentTarget.getAttribute('data-customvalue')
      )
    );
  };

  const points = [
    {
      id: 1,
      address: 'г. Москва, Волгоградский проспект, д. 120',
      coord: [55.684758, 37.738521],
    },
    {
      id: 2,
      address: 'г. Москва, Волгоградский проспект, д. 122',
      coord: [55.884758, 37.438521],
    },
    {
      id: 3,
      address: 'г. Москва, Волгоградский проспект, д. 123',
      coord: [55.584758, 37.438521],
    },
    {
      id: 4,
      address: 'г. Москва, Волгоградский проспект, д. 124',
      coord: [55.584758, 37.138521],
    },
  ];

  return (
    <Modal
      open={open}
      onClose={handleClose}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="overflow-hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none w-[80%] ">
        <span
          onClick={handleClose}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>

        <div className="flex justify-between items-start border border-colLightGray rounded-[10px] max-h-[500px] overflow-hidden">
          <div className="p-5 flex flex-col justify-between overflow-hidden h-[500px]">
            <div className="flex flex-col gap-2 mb-5 overflow-hidden">
              <div className="font-semibold text-lg">
                Выберите пункт самовывоза
              </div>
              <CSearchField
                label="Город, адрес или метро"
                name="search"
                type="search"
                handleChange={handleFilter}
              />
              <div className="scrollable overflow-y-scroll flex flex-col gap-2 pr-2">
                {points?.map((point, index) => {
                  return (
                    <CustomRadioButton
                      key={point.id}
                      value={point.id}
                      handleChange={handlePointChange}
                      checked={
                        point.id.toString() === pickupPoint.id.toString()
                      }
                    >
                      <div className="flex flex-col gap-2 ">
                        <div className="flex gap-1">
                          <SubwayIcon />
                          <div className="">Кузьминки</div>
                        </div>
                        <div className="font-medium">{point.address}</div>
                        <div className="text-[12px] text-colDarkGray">
                          Пн-Сб: с 9:00 до 21:00 Вс: с 10:00 до 18:00
                        </div>
                        <div className="font-semibold text-colGreen">
                          Забирайте сегодня
                        </div>
                      </div>
                    </CustomRadioButton>
                  );
                })}
              </div>
              <button
                onClick={handleClose}
                className="bg-colGreen text-white py-4 rounded font-semibold"
              >
                Выбрать
              </button>
            </div>
          </div>

          <YMaps>
            <div className="rounded overflow-hidden grow ">
              <Map
                className="w-full h-[500px] grow"
                defaultState={{ center: [55.75, 37.57], zoom: 9 }}
              >
                {points?.map((point, index) => {
                  return <Placemark geometry={point.coord} />;
                })}
              </Map>
            </div>
          </YMaps>
        </div>
      </Box>
    </Modal>
  );
};

export default PickupPointModal;

================
src/features/modals/ui/modals/QuestionModal.tsx
================

import { Box, Modal } from '@mui/material';

import { useModal } from '@/features/modals/model/context';
import QuestionForm from '@/helpers/QuestionForm';

const QuestionModal = () => {
  const { hideModal, modalContent, isModalVisible } = useModal();

  return (
    <Modal
      open={isModalVisible ? modalContent?.type === 'question' : null}
      onClose={hideModal}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none py-10 px-8 max-w-[500px] w-full">
        <span
          onClick={hideModal}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>
        <div className=" font-semibold text-3xl mb-3">Задайте вопрос</div>
        <div className="mb-5">
          Укажите контактные данные, менеджер свяжется в ближайшее время и
          ответит на все вопросы
        </div>
        <QuestionForm data={modalContent?.data} hideModal={hideModal} />
      </Box>
    </Modal>
  );
};

export default QuestionModal;

================
src/features/modals/ui/modals/ReviewModal.tsx
================

import React, { useState } from 'react';

import { Box, Modal } from '@mui/material';
import { Controller, useForm } from 'react-hook-form';
import { useSelector } from 'react-redux';
import { NavLink } from 'react-router-dom';

import { useSubmitReviewMutation } from '@/entities/review/api/reviewEndpoints';
import RatingStars from '@/helpers/RatingStars';
import CTextField from '@/shared/ui/inputs/CTextField';

const ReviewModal = ({ product, open, handleClose }) => {
  const [rating, setRating] = useState(5);

  const { user } = useSelector((state) => state.user);

  const {
    control,
    handleSubmit,
    reset,
    register,
    watch,
    formState: { errors, isValid },
  } = useForm({
    mode: 'onChange',
  });

  // Use mutation for form submission
  const [submitReview, { isLoading, isError, error }] =
    useSubmitReviewMutation();

  const onSubmit = async (data) => {
    // Prepare data to send
    const reviewData = {
      id: product.id,
      rating: rating,
      text: data.text,
      advantages: data.advantages,
      disadvantages: data.disadvantages,
    };

    // Submit data
    try {
      await submitReview(reviewData).unwrap();
      reset();
      handleClose();
    } catch (err) {
      console.error('Error submitting review:', err);
    }
  };

  // id (text): Идентификатор продукта.
  // text (text): Текст отзыва.
  // advantages (text): Преимущества продукта.
  // disadvantages (text): Недостатки продукта.
  // rating (number): Оценка продукта.

  return (
    <Modal
      open={open}
      onClose={handleClose}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none py-10 px-8 max-w-[500px] w-full">
        <span
          onClick={handleClose}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>
        <form className="flex flex-col gap-5" onSubmit={handleSubmit(onSubmit)}>
          <div className=" font-semibold text-3xl">Ваш отзыв о товаре</div>

          <div className="flex p-2">
            <div className="w-20 h-20 rounded mr-5">
              <NavLink
                to={`/catalog/'${product.category.slug}'/${product.slug}`}
                className="cursor-pointer min-w-[56px] w-14 h-14 overflow-hidden bg-gray-100 rounded-md"
              >
                <img
                  className="w-full h-full object-contain"
                  src={product?.files[0]?.large || noImg}
                  onError={(e) => {
                    e.target.onError = null;
                    e.target.src = noImg;
                  }}
                  alt="*"
                />
              </NavLink>
            </div>
            <div className="flex flex-col gap-2 ">
              <div className="text-sm font-medium">{`${product.groupName} ${product.name}`}</div>
              <div className="text-xs font-medium text-colDarkGray flex items-center space-x-1">
                {product.sku}
              </div>

              <div className="flex gap-x-2 flex-wrap">
                {product.attributes
                  ? product?.attributes?.map((attribute, index) => (
                      <p
                        key={index}
                        className="text-xs font-medium text-colDarkGray flex items-center space-x-1"
                      >
                        <span>{attribute?.name}:</span>
                        <span className="font-semibold">
                          {attribute.color ? (
                            <div
                              style={{ backgroundColor: `${attribute.color}` }}
                              className="w-3 h-3 rounded-full border"
                            ></div>
                          ) : (
                            attribute.text
                          )}
                        </span>
                      </p>
                    ))
                  : null}
              </div>
            </div>
          </div>

          <div className="flex items-center gap-3 ">
            <div className=" font-semibold text-lg">Общая оценка</div>
            <div className="flex">
              <RatingStars
                totalStars={5}
                initialRating={rating}
                isActive={true}
                handleSetRating={setRating}
              />
            </div>
          </div>

          <div>
            <div className=" font-semibold text-lg mb-3">Мнение о товаре</div>
            <Controller
              name="text"
              control={control}
              defaultValue=""
              render={({ field }) => (
                <CTextField
                  multiline
                  minRows={2}
                  label="Напишите ваше мнение"
                  type="text"
                  onChange={field.onChange}
                  value={field.value}
                />
              )}
            />
          </div>
          <div>
            <div className=" font-semibold text-lg mb-3">Плюсы</div>
            <Controller
              name="advantages"
              control={control}
              defaultValue=""
              render={({ field }) => (
                <CTextField
                  multiline
                  minRows={2}
                  label="Напишите ваше мнение"
                  type="text"
                  onChange={field.onChange}
                  value={field.value}
                />
              )}
            />
          </div>
          <div>
            <div className=" font-semibold text-lg mb-3">Минусы</div>
            <Controller
              name="disadvantages"
              control={control}
              defaultValue=""
              render={({ field }) => (
                <CTextField
                  multiline
                  minRows={2}
                  label="Напишите ваше мнение"
                  type="text"
                  onChange={field.onChange}
                  value={field.value}
                />
              )}
            />
          </div>
          {/* <div>
            <div className=' font-semibold text-lg mb-3'>Вы оставляете отзыв, как</div>
            <div className='flex gap-2'>
              <Controller
                name='name'
                control={control}
                defaultValue={user ? user?.user?.name : ''}
                rules={{
                  required: 'Поле обязательно к заполнению!',
                }}
                render={({ field }) => (


                  <CTextField
                    required={true}

                    label='Имя'
                    type='text'
                    {...field} />
                )}
              />
              {errors?.name && (
                <p className='text-red-500 mt-1 text-xs font-medium'>
                  {errors?.name?.message || 'Error!'}
                </p>
              )}
              <Controller
                name='email'
                control={control}
                defaultValue={user ? user?.user?.email : ''}
                rules={{
                  required: 'Поле обязательно к заполнению!',
                  pattern: {
                    value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,
                    message:
                      'Введите корректный адрес электронной почты',
                  },
                }}
                render={({ field }) => (
                  <CTextField
                    label='Электронная почта'
                    type='email'
                    required={true}
                    {...field}
                  />
                )}
              />
            </div>
            <div className='text-xs mt-1 text-colDarkGray'>Заполните, чтобы получать ответы на ваш отзыв. Ваша электронная почта не будет видна другим пользователям</div>

          </div> */}
          <button className="py-3 flex justify-center text-white font-semibold bg-colGreen w-full rounded cursor-pointer">
            Отправить отзыв
          </button>
        </form>
      </Box>
    </Modal>
  );
};

export default ReviewModal;

================
src/features/modals/ui/modals/SearchFiltersModal.tsx
================

import { useState } from 'react';

import { Box, Checkbox, FormControlLabel, Modal, Slider } from '@mui/material';

import ErrorEmpty from '@/helpers/Errors/ErrorEmpty';
import { ArrowIcon } from '@/shared/ui/icons';
import CTextField from '@/shared/ui/inputs/CTextField';
import { Loading } from '@/shared/ui/Loader';

const SearchFiltersModal = ({
  open,
  setOpen,
  filters,
  filterLoading,
  setFiltersValue,
}) => {
  const [accordion, setAccordion] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [selectedValues, setSelectedValues] = useState({});
  const [selectedValuesTwo, setSelectedValuesTwo] = useState({
    brands: [],
    tags: [],
    min_price: Number(filters?.basics?.price?.min || 0),
    max_price: Number(filters?.basics?.price?.max || 0),
  });

  const toggleValue = (filterId, valueId) => {
    setSelectedValues((prevState) => ({
      ...prevState,
      [filterId]: prevState[filterId]
        ? prevState[filterId].includes(valueId)
          ? prevState[filterId].filter((id) => id !== valueId)
          : [...prevState[filterId], valueId]
        : [valueId],
    }));
  };

  const toggleAccordion = (id) => {
    setAccordion(accordion === id ? null : id);
  };

  const handleChange = (name, value) => {
    let updatedFilters = { ...selectedValuesTwo };

    if (name === 'min_price' && parseInt(value) > selectedValuesTwo.max_price) {
      updatedFilters = {
        ...updatedFilters,
        min_price: parseInt(value),
        max_price: parseInt(value),
      };
    } else if (
      name === 'max_price' &&
      parseInt(value) < selectedValuesTwo.min_price
    ) {
      updatedFilters = {
        ...updatedFilters,
        max_price: parseInt(value),
        min_price: parseInt(value),
      };
    } else {
      updatedFilters = {
        ...updatedFilters,
        [name]: value,
      };
    }

    setSelectedValuesTwo(updatedFilters);
  };

  const handleSliderChange = (newValue) => {
    const [newMinPrice, newMaxPrice] = newValue;
    const updatedFilters = {
      ...selectedValuesTwo,
      min_price: newMinPrice,
      max_price: newMaxPrice,
    };
    setSelectedValuesTwo(updatedFilters);
  };

  const handleCheckboxChange = (name, value) => {
    const updatedFilters = {
      ...selectedValuesTwo,
      [name]: selectedValuesTwo[name].includes(value)
        ? selectedValuesTwo[name].filter((item) => item !== value)
        : [...selectedValuesTwo[name], value],
    };
    setSelectedValuesTwo(updatedFilters);
  };

  const handleClearFilter = () => {
    setSelectedValues({});
    setSelectedValuesTwo({
      brands: [],
      tags: [],
      min_price: 0,
      max_price: 900000,
    });
  };

  const onSubmit = async () => {
    setIsLoading(true);
    setFiltersValue((prev) => ({ ...prev, ...selectedValues }));
    setOpen(false);
    setIsLoading(false);
  };

  const dynamicFilters = filters?.dynamics?.filter(
    (el) => el?.display_in_filters !== '1'
  );

  if (!open) return null;

  return (
    <Modal
      open={open}
      onClose={() => setOpen(false)}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full mm:w-[95%] lg:w-[85%] h-full mm:h-[95%] lg:h-[90%] lining-nums proportional-nums bg-white outline-none rounded-lg border-none p-3 md:p-6 overflow-hidden">
        <div className="flex flex-col justify-between h-full">
          <div className="h-[90%]">
            <div className="flex justify-between items-center">
              <h2 className="text-colBlack text-2xl lg:text-3xl font-semibold">
                Все фильтры
              </h2>
              <span
                onClick={() => setOpen(false)}
                className="text-4xl lg:text-5xl text-colGray font-light cursor-pointer pr-2"
              >
                &times;
              </span>
            </div>
            {isLoading || filterLoading ? (
              <Loading />
            ) : (filters?.basics && Object.keys(filters.basics).length > 0) ||
              filters.dynamics.length > 0 ||
              filters.more.length > 0 ? (
              <div className="mt-2 pr-3 md:border-t md:border-b border-[#EBEBEB] overflow-y-scroll overflow-hidden h-[calc(100vh_-_136px)] md:h-[calc(100vh_-_205px)] lg:h-[92%]">
                <div className="pt-5">
                  <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-5 lg:gap-8">
                    <div className="md:hidden border-b pb-2">
                      <div
                        className="flex justify-between items-center cursor-pointer"
                        onClick={() => toggleAccordion('cost')}
                      >
                        <span className="text-colBlack font-semibold">
                          Цена, ₽
                        </span>
                        <ArrowIcon
                          className={`!m-0 !w-4 !h-4 ${
                            accordion === 'cost'
                              ? 'rotate-[0deg]'
                              : 'rotate-[180deg]'
                          }`}
                        />
                      </div>
                      {accordion === 'cost' ? (
                        <>
                          <div className="grid grid-cols-2 gap-3 py-3 pl-2">
                            <CTextField
                              label={`от ${filters?.basics?.price?.min}`}
                              name="min_price"
                              type="number"
                              value={selectedValuesTwo.min_price}
                              onChange={(e) =>
                                handleChange('min_price', e.target.value)
                              }
                            />
                            <CTextField
                              label={`до ${filters?.basics?.price?.max}`}
                              name="max_price"
                              type="number"
                              value={selectedValuesTwo.max_price}
                              onChange={(e) =>
                                handleChange('max_price', e.target.value)
                              }
                            />
                          </div>
                          <Box sx={{ padding: '0 8px 0 14px' }}>
                            <Slider
                              sx={{ color: '#15765B' }}
                              size="small"
                              getAriaLabel={() => 'Price range'}
                              value={[
                                selectedValuesTwo?.min_price,
                                selectedValuesTwo?.max_price,
                              ]}
                              min={Number(filters?.basics?.price?.min)}
                              max={Number(filters?.basics?.price?.max)}
                              onChange={(event, newValue) =>
                                handleSliderChange(newValue)
                              }
                              valueLabelDisplay="auto"
                            />
                          </Box>
                        </>
                      ) : null}
                    </div>
                    {filters?.basics?.brands?.length > 0 ? (
                      <div className="md:hidden border-b pb-3">
                        <div
                          className="flex justify-between items-center cursor-pointer"
                          onClick={() => toggleAccordion('brand')}
                        >
                          <span className="text-colBlack font-semibold">
                            Производитель
                          </span>
                          <ArrowIcon
                            className={`!m-0 !w-4 !h-4 ${
                              accordion === 'brand'
                                ? 'rotate-[0deg]'
                                : 'rotate-[180deg]'
                            }`}
                          />
                        </div>
                        {accordion === 'brand'
                          ? filters?.basics?.brands?.map((el) => (
                              <div className="pl-2" key={el?.id}>
                                <FormControlLabel
                                  control={
                                    <Checkbox
                                      style={{
                                        color: '#15765B',
                                        padding: '5px 4px 5px 8px',
                                      }}
                                      name="brands"
                                      checked={selectedValuesTwo.brands.includes(
                                        el?.id
                                      )}
                                      onChange={() =>
                                        handleCheckboxChange('brands', el?.id)
                                      }
                                    />
                                  }
                                  label={
                                    <p className="text-sm font-medium text-colBlack">
                                      {el?.name}
                                    </p>
                                  }
                                />
                              </div>
                            ))
                          : null}
                      </div>
                    ) : null}
                    {filters?.basics?.tags?.length > 0 ? (
                      <div className="md:hidden border-b pb-3">
                        <div
                          className="flex justify-between items-center cursor-pointer"
                          onClick={() => toggleAccordion('status')}
                        >
                          <span className="text-colBlack font-semibold">
                            Статус
                          </span>
                          <ArrowIcon
                            className={`!m-0 !w-4 !h-4 ${
                              accordion === 'status'
                                ? 'rotate-[0deg]'
                                : 'rotate-[180deg]'
                            }`}
                          />
                        </div>
                        {accordion === 'status'
                          ? filters?.basics?.tags?.map((el, index) => (
                              <div className="pt-2 pl-2" key={index}>
                                <FormControlLabel
                                  control={
                                    <Checkbox
                                      style={{
                                        color: '#15765B',
                                        padding: '1px 4px 1px 8px',
                                      }}
                                      checked={selectedValuesTwo.tags.includes(
                                        el?.tag
                                      )}
                                      onChange={() =>
                                        handleCheckboxChange('tags', el?.tag)
                                      }
                                    />
                                  }
                                  label={
                                    <span
                                      style={{
                                        color: el?.text_color,
                                        backgroundColor: el?.background_color,
                                      }}
                                      className="py-1 px-2 uppercase text-xs font-bold rounded-xl"
                                    >
                                      {el?.tag}
                                    </span>
                                  }
                                />
                              </div>
                            ))
                          : null}
                      </div>
                    ) : null}
                    {window.innerWidth > 768
                      ? dynamicFilters?.map((el) => (
                          <div
                            className="border-b md:border-b-0 pb-2"
                            key={el?.id}
                          >
                            <div
                              className="flex justify-between items-center cursor-pointer"
                              onClick={() => toggleAccordion(el?.id)}
                            >
                              <span className="text-colBlack font-semibold">
                                {el?.name}
                              </span>
                              <ArrowIcon
                                className={`!m-0 !w-4 !h-4 ${
                                  accordion === el?.id
                                    ? 'rotate-[0deg]'
                                    : 'rotate-[180deg]'
                                }`}
                              />
                            </div>
                            {accordion === el?.id && el?.values?.length > 0 ? (
                              <div
                                className={`${
                                  el?.values?.length > 10 &&
                                  'h-[274px] overflow-hidden overflow-y-scroll scrollable'
                                } `}
                              >
                                {el?.values?.map((val) => (
                                  <div key={val?.id}>
                                    <FormControlLabel
                                      style={{ margin: 0 }}
                                      control={
                                        <Checkbox
                                          style={{
                                            color: '#15765B',
                                            padding: '2px 3px',
                                          }}
                                          checked={
                                            selectedValues[el?.id]?.includes(
                                              val?.id
                                            ) || false
                                          }
                                          onChange={() =>
                                            toggleValue(el?.id, val?.id)
                                          }
                                        />
                                      }
                                      label={
                                        <div className="flex space-x-2 items-center">
                                          {el?.type === 'color' ? (
                                            <span
                                              style={{
                                                backgroundColor: val?.color,
                                              }}
                                              className="w-5 h-5 min-w-[20px] rounded-full border border-colGray"
                                            ></span>
                                          ) : null}
                                          <p className="text-sm font-medium text-colBlack">
                                            {val?.text}
                                          </p>
                                        </div>
                                      }
                                    />
                                  </div>
                                ))}
                              </div>
                            ) : null}
                          </div>
                        ))
                      : filters?.dynamics?.map((el) => (
                          <div
                            className="border-b md:border-b-0 pb-2"
                            key={el?.id}
                          >
                            <div
                              className="flex justify-between items-center cursor-pointer"
                              onClick={() => toggleAccordion(el?.id)}
                            >
                              <span className="text-colBlack font-semibold">
                                {el?.name}
                              </span>
                              <ArrowIcon
                                className={`!m-0 !w-4 !h-4 ${
                                  accordion === el?.id
                                    ? 'rotate-[0deg]'
                                    : 'rotate-[180deg]'
                                }`}
                              />
                            </div>
                            {accordion === el?.id && el?.values?.length > 0 ? (
                              <div
                                className={`${
                                  el?.values?.length > 10 &&
                                  'h-[274px] overflow-hidden overflow-y-scroll scrollable'
                                } `}
                              >
                                {el?.values?.map((val) => (
                                  <div key={val?.id}>
                                    <FormControlLabel
                                      style={{ margin: 0 }}
                                      control={
                                        <Checkbox
                                          style={{
                                            color: '#15765B',
                                            padding: '2px 3px',
                                          }}
                                          checked={
                                            selectedValues[el?.id]?.includes(
                                              val?.id
                                            ) || false
                                          }
                                          onChange={() =>
                                            toggleValue(el?.id, val?.id)
                                          }
                                        />
                                      }
                                      label={
                                        <div className="flex space-x-2 items-center">
                                          {el?.type === 'color' ? (
                                            <span
                                              style={{
                                                backgroundColor: val?.color,
                                              }}
                                              className="w-5 h-5 min-w-[20px] rounded-full border border-colGray"
                                            ></span>
                                          ) : null}
                                          <p className="text-sm font-medium text-colBlack">
                                            {val?.text}
                                          </p>
                                        </div>
                                      }
                                    />
                                  </div>
                                ))}
                              </div>
                            ) : null}
                          </div>
                        ))}
                  </div>
                </div>
              </div>
            ) : (
              <ErrorEmpty
                title="Список пуст!"
                desc="К сожалению, для этой категории нет фильтров."
                height="420px"
              />
            )}
          </div>
          <div className="flex space-x-3 h-10">
            <span
              onClick={handleClearFilter}
              className="bg-white text-colGreen border border-colGreen rounded-md py-2 px-4 font-semibold w-max text-sm cursor-pointer"
            >
              Сбросить
            </span>
            <button
              onClick={onSubmit}
              className="bg-colGreen text-white rounded-md py-2 px-4 font-semibold w-max text-sm"
            >
              Применить
            </button>
          </div>
        </div>
      </Box>
    </Modal>
  );
};

export default SearchFiltersModal;

================
src/features/modals/ui/modals/ShareCartModal.tsx
================

import type React from 'react';
import { useEffect, useState } from 'react';

import { Box, Modal } from '@mui/material';
import { set } from 'js-cookie';
import { useLocation, useNavigate } from 'react-router-dom';
import {
  OKIcon,
  OKShareButton,
  TelegramIcon,
  TelegramShareButton,
  VKIcon,
  VKShareButton,
  WhatsappIcon,
  WhatsappShareButton,
} from 'react-share';
import { toast } from 'sonner';

import {
  useGetCartShareCodeMutation,
  //  useGetCartShareCodeQuery,
  useGetCartShareItemsByCodeMutation,
} from '@/features/cart';
import { useModal } from '@/features/modals';
import { CTextField, CopyButton } from '@/shared/ui';
import { ProductCardLine, ProductCardLineSmall } from '@/widgets/product-card';

export const ShareCartModal: React.FC = () => {
  const { hideModal, modalContent, isModalVisible } = useModal();

  if (!isModalVisible && modalContent?.type !== 'shareCart') {
    return null;
  }
  const location = useLocation();

  const [getCode, { isLoading: getIsLoading }] = useGetCartShareCodeMutation();
  // const { data: shareCode, isLoading, isSuccess, refetch } = useGetCartShareCodeQuery();
  const [getCart, { isLoading: sendIsLoading }] =
    useGetCartShareItemsByCodeMutation();

  const [url, setUrl] = useState('');
  const [sharedCart, setSharedCart] = useState([]);

  useEffect(() => {
    getSharedCart();
  }, []);

  const getSharedCart = async () => {
    const code = await getCode();

    setUrl(`https://rosstok.ru/shopping-cart?cart=${code?.data?.code}`);

    const sharedCart = await getCart({ code: code?.data?.code });
    setSharedCart(sharedCart?.data?.data);
  };

  return (
    <Modal
      open={isModalVisible ? modalContent?.type === 'shareCart' : null}
      onClose={hideModal}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none px-6 py-8">
        <span
          onClick={hideModal}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>
        <h1 className="pt-1 text-2xl mm:text-3xl text-colBlack font-semibold mb-5">
          Поделиться корзиной
        </h1>
        <div className="flex flex-col w-full max-h-[60vh] overflow-y-auto overflow-x-hidden">
          {sharedCart?.length > 0
            ? sharedCart?.map((item, index) => {
                return (
                  <div
                    key={index}
                    className="flex w-full gap-3 items-center justify-between"
                  >
                    <ProductCardLineSmall
                      product={item}
                      showChangeQuantity={false}
                    />
                  </div>
                );
              })
            : null}
        </div>
        <div className="flex items-center gap-2">
          <input
            type="text"
            className="w-full p-2 border rounded"
            value={url || ''}
            readOnly
          />
          <CopyButton
            textToCopy={url || ''}
            toastMessage="Ссылка скопирована"
            iconClassName="w-6 h-6 rounded-full cursor-pointer hover:opacity-80"
            containerClassName="flex-shrink-0"
          />
        </div>

        <div className="flex pt-5 justify-center gap-1">
          <OKShareButton url={url || ''}>
            <OKIcon />
          </OKShareButton>

          <VKShareButton url={url || ''}>
            <VKIcon />
          </VKShareButton>
          <TelegramShareButton url={url || ''}>
            <TelegramIcon />
          </TelegramShareButton>
          <WhatsappShareButton url={url || ''}>
            <WhatsappIcon />
          </WhatsappShareButton>

          {/* <button
                onClick={() => hideModal()}
                className='w-1/2 h-[38px] px-6 border border-colGreen bg-white rounded text-colGreen font-semibold'
              >
                Отменить
              </button>
              <button
                onClick={logout}
                className='w-1/2 h-[38px] px-6 bg-colGreen rounded text-white font-semibold'
              >
                Да
              </button> */}
        </div>
      </Box>
    </Modal>
  );
};

================
src/features/modals/ui/modals/ShareModal.tsx
================

import type React from 'react';
import { useEffect, useState } from 'react';

import { Box, Modal } from '@mui/material';
import { useLocation, useNavigate } from 'react-router-dom';
import {
  OKIcon,
  OKShareButton,
  TelegramIcon,
  TelegramShareButton,
  VKIcon,
  VKShareButton,
  WhatsappIcon,
  WhatsappShareButton,
} from 'react-share';
import { toast } from 'sonner';

import { useModal } from '@/features/modals';
import { CopyButton, CTextField } from '@/shared/ui';

const ShareModal: React.FC = () => {
  const { hideModal, modalContent, isModalVisible } = useModal();
  const location = useLocation();

  const [url, setUrl] = useState(
    modalContent?.url || `https://rosstok.ru${location.pathname}`
  );

  useEffect(() => {
    setUrl(modalContent?.url || `https://rosstok.ru${location.pathname}`);
  }, [modalContent, location.pathname]);

  if (!isModalVisible) return null;

  return (
    <Modal
      open={isModalVisible ? modalContent?.type === 'share' : null}
      onClose={hideModal}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none px-6 py-8 max-w-[480px] w-[95%] mm:w-full">
        <span
          onClick={hideModal}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>
        <h1 className="pt-1 text-2xl mm:text-3xl text-colBlack font-semibold mb-5">
          Поделиться
        </h1>
        <div className="flex items-center gap-2">
          <input
            type="text"
            className="w-full p-2 border rounded"
            value={url || ''}
            readOnly
          />
          <CopyButton
            textToCopy={url || ''}
            toastMessage="Ссылка скопирована"
            iconClassName="w-6 h-6 rounded-full cursor-pointer hover:opacity-80"
            containerClassName="flex-shrink-0"
          />
        </div>

        <div className="flex pt-5 justify-center gap-1">
          <OKShareButton url={url || ''}>
            <OKIcon />
          </OKShareButton>

          <VKShareButton url={url || ''}>
            <VKIcon />
          </VKShareButton>
          <TelegramShareButton url={url || ''}>
            <TelegramIcon />
          </TelegramShareButton>
          <WhatsappShareButton url={url || ''}>
            <WhatsappIcon />
          </WhatsappShareButton>
          {/* <button
                onClick={() => hideModal()}
                className='w-1/2 h-[38px] px-6 border border-colGreen bg-white rounded text-colGreen font-semibold'
              >
                Отменить
              </button>
              <button
                onClick={logout}
                className='w-1/2 h-[38px] px-6 bg-colGreen rounded text-white font-semibold'
              >
                Да
              </button> */}
        </div>
      </Box>
    </Modal>
  );
};

export default ShareModal;

================
src/features/modals/ui/modals/ShowSharedCartModal.tsx
================

import type React from 'react';
import { useEffect, useState } from 'react';

import { Box, Modal } from '@mui/material';
import { set } from 'js-cookie';
import { useLocation, useNavigate } from 'react-router-dom';
import {
  OKIcon,
  OKShareButton,
  TelegramIcon,
  TelegramShareButton,
  VKIcon,
  VKShareButton,
  WhatsappIcon,
  WhatsappShareButton,
} from 'react-share';
import { toast } from 'sonner';

import {
  useAddSharedCartMutation,
  useGetCartShareItemsByCodeMutation,
} from '@/features/cart';
import { useModal } from '@/features/modals/model/context';
import copyicon from '@/shared/assets/icons/copy-icon.svg';
import { CTextField } from '@/shared/ui';
import { ProductCardLine, ProductCardLineSmall } from '@/widgets/product-card';

const ShareCartModal: React.FC = () => {
  const { hideModal, modalContent, isModalVisible } = useModal();

  if (!isModalVisible && modalContent?.type !== 'showSharedCart') {
    return null;
  }

  const [getCart, { isLoading: sendIsLoading }] =
    useGetCartShareItemsByCodeMutation();
  const [addSharedCart, { isLoading: addIsLoading, isSuccess: addIsSuccess }] =
    useAddSharedCartMutation();

  const [sharedCart, setSharedCart] = useState([]);

  useEffect(() => {
    getSharedCart(modalContent.code);
  }, []);

  const getSharedCart = async (code) => {
    const sharedCart = await getCart({ code: code });
    setSharedCart(sharedCart?.data?.data);
  };

  return (
    <Modal
      open={isModalVisible ? modalContent?.type === 'showSharedCart' : null}
      onClose={() => {
        hideModal();
        setUrl('');
      }}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col gap-2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none px-6 py-8">
        <span
          onClick={() => {
            hideModal();
          }}
          className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
        >
          &times;
        </span>
        <h1 className="pt-1 text-2xl mm:text-3xl text-colBlack font-semibold mb-5">
          Корзина
        </h1>
        <div className="flex flex-col w-full max-h-[60vh] overflow-y-auto overflow-x-hidden">
          {sharedCart?.length > 0
            ? sharedCart?.map((item, index) => {
                return (
                  <div
                    key={index}
                    className="flex w-full gap-3 items-center justify-between"
                  >
                    <ProductCardLineSmall
                      product={item}
                      showChangeQuantity={false}
                    />
                  </div>
                );
              })
            : null}
        </div>
        <button
          disabled={addIsSuccess}
          onClick={() => addSharedCart({ code: modalContent.code })}
          className={`w-[300px] h-[38px] px-6 ${addIsSuccess ? 'bg-colDarkGray' : 'bg-colGreen'}  rounded text-white font-semibold`}
        >
          {!addIsSuccess ? 'Добавить в корзину' : 'Добавлено в корзину'}
        </button>
      </Box>
    </Modal>
  );
};

export default ShareCartModal;

================
src/features/modals/ui/modals/UpdateOrganizationModal.tsx
================

import { Box, Modal } from '@mui/material';
import { Controller, useForm } from 'react-hook-form';

import CTextField from '@/shared/ui/inputs/CTextField';
import { Loading } from '@/shared/ui/Loader';

const UpdateOrganizationModal = ({
  open,
  close,
  item,
  handleEditOrganization,
  editLoading,
  editOrgSuccess,
}) => {
  const { control, handleSubmit } = useForm({
    mode: 'onChange',
    defaultValues: {
      inn: item?.inn || '',
      kpp: item?.kpp || '',
      name: item?.name || '',
      u_address: item?.u_address || '',
      f_address: item?.f_address || '',
      ogrn: item?.ogrn || '',
      bank_account: item?.bank_account || '',
      bank_bik: item?.bank_bik || '',
      correspondent_account: item?.correspondent_account || '',
      bank_name: item?.bank_name || '',
    },
  });

  const handleUpdateOrganization = (data) => {
    data.id = item?.id;
    handleEditOrganization(data);
    if (editOrgSuccess) {
      close();
    }
  };

  return (
    <Modal
      open={open}
      onClose={close}
      aria-labelledby="modal-modal-title"
      aria-describedby="modal-modal-description"
    >
      <Box className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 lining-nums proportional-nums bg-white rounded-lg border-none outline-none py-10 px-8 max-w-[500px] w-full">
        {editLoading ? (
          <div className="h-[162px]">
            <Loading />
          </div>
        ) : (
          <div>
            <span
              onClick={close}
              className="absolute top-0 right-0 text-4xl text-colGray font-light cursor-pointer pr-4"
            >
              &times;
            </span>
            <h1 className="text-3xl text-colBlack text-center pb-2 font-semibold">
              Редактирование организации
            </h1>
            <h4 className="text-xl text-center font-semibold pb-4 text-colBlack">
              {item?.name}
            </h4>
            <form onSubmit={handleSubmit(handleUpdateOrganization)}>
              <div className="w-full space-y-3">
                <div className="grid grid-cols-2 gap-3">
                  <Controller
                    name="inn"
                    control={control}
                    rules={{}}
                    render={({ field }) => (
                      <CTextField
                        {...field}
                        label="ИНН"
                        type="number"
                        borderColor="#222"
                        focusedBorderColor="#15765B"
                        labelColor="#15765B"
                        required={true}
                      />
                    )}
                  />
                  <Controller
                    name="kpp"
                    control={control}
                    rules={{}}
                    render={({ field }) => (
                      <CTextField
                        {...field}
                        label="КПП"
                        type="number"
                        borderColor="#222"
                        focusedBorderColor="#15765B"
                        labelColor="#15765B"
                        required={true}
                      />
                    )}
                  />
                </div>
                <Controller
                  name="name"
                  control={control}
                  rules={{}}
                  render={({ field }) => (
                    <CTextField
                      {...field}
                      label="Название организации"
                      type="text"
                      required={true}
                    />
                  )}
                />

                <Controller
                  name="u_address"
                  control={control}
                  rules={{}}
                  render={({ field }) => (
                    <CTextField
                      {...field}
                      label="Юридический адрес"
                      type="text"
                      required={true}
                    />
                  )}
                />

                <Controller
                  name="f_address"
                  control={control}
                  rules={{}}
                  render={({ field }) => (
                    <CTextField
                      {...field}
                      label="Фактический адрес"
                      type="text"
                      required={true}
                    />
                  )}
                />
                <Controller
                  name="ogrn"
                  control={control}
                  rules={{}}
                  render={({ field }) => (
                    <CTextField
                      {...field}
                      label="ОГРН"
                      type="number"
                      required={true}
                    />
                  )}
                />

                <div className="grid grid-cols-2 gap-3">
                  <Controller
                    name="bank_account"
                    control={control}
                    rules={{}}
                    render={({ field }) => (
                      <CTextField
                        {...field}
                        label="Расчётный счёт"
                        type="number"
                        borderColor="#222"
                        focusedBorderColor="#15765B"
                        labelColor="#15765B"
                      />
                    )}
                  />

                  <Controller
                    name="bank_bik"
                    control={control}
                    rules={{}}
                    render={({ field }) => (
                      <CTextField
                        {...field}
                        label="БИК Банка"
                        type="number"
                        borderColor="#222"
                        focusedBorderColor="#15765B"
                        labelColor="#15765B"
                      />
                    )}
                  />

                  <Controller
                    name="correspondent_account"
                    control={control}
                    rules={{}}
                    render={({ field }) => (
                      <CTextField
                        {...field}
                        label="Корр. счёт"
                        type="number"
                        borderColor="#222"
                        focusedBorderColor="#15765B"
                        labelColor="#15765B"
                      />
                    )}
                  />

                  <Controller
                    name="bank_name"
                    control={control}
                    rules={{}}
                    render={({ field }) => (
                      <CTextField
                        {...field}
                        label="Наименование банка"
                        type="text"
                        borderColor="#222"
                        focusedBorderColor="#15765B"
                        labelColor="#15765B"
                      />
                    )}
                  />
                </div>
              </div>
              <button className="w-full h-[38px] px-6 bg-colGreen rounded mt-5 text-white font-semibold">
                Сохранить
              </button>
            </form>
          </div>
        )}
      </Box>
    </Modal>
  );
};

export default UpdateOrganizationModal;

================
src/features/recent-items/api/recentItemsApi.ts
================

import { api } from '@/shared/api/api';

export const recentItemsEndpoints = api.injectEndpoints({
  endpoints: (builder) => ({
    getRecentItems: builder.query({
      query: () => ({
        url: '/api/Products/recentlyViewed',
        method: 'GET',
      }),
      providesTags: [{ type: 'User', id: 'RECENT-ITEMS' }],
      keepUnusedDataFor: 0,
    }),
  }),
});

export const { useGetRecentItemsQuery } = recentItemsEndpoints;

================
src/features/recent-items/api/types.ts
================

import type { AdditionalServerResponseData } from '@/shared/types/AdditionalServerResponseData';

//TODO
export interface GetRecentItemsResponse extends AdditionalServerResponseData {}

================
src/features/recent-items/index.ts
================

export * from './lib/hooks/useAddToRecentItems';
export * from './api/recentItemsApi';
export * from './model/recentItemsSlice';
export * from './ui/RecentlyVisitedSection';

================
src/features/recent-items/lib/hooks/useAddToRecentItems.ts
================

import { useEffect } from 'react';

import { useDispatch } from 'react-redux';

import { addToRecentItems } from '@/features/recent-items/';
import { getTokenFromCookies } from '@/shared/lib';

import type { AppDispatch } from '@/app/providers/store';
import type { Product } from '@/entities/product';

export const useAddToRecentItems = (product: Product | null) => {
  const dispatch: AppDispatch = useDispatch();
  const token = getTokenFromCookies();

  useEffect(() => {
    if (!token && product?.id) {
      dispatch(addToRecentItems(product));
    }
  }, [product?.id, dispatch, token]); // Only re-run when product ID, dispatch, or token changes
};

================
src/features/recent-items/model/recentItemsSlice.ts
================

// src/features/favorite/recentItems.ts
import { createSlice } from '@reduxjs/toolkit';

import { saveToSessionStorage } from '@/features/storage/lib';
import { getTokenFromCookies } from '@/shared/lib';

import type { RecentItemsProduct, RecentItemsState } from './types';
import type { Product } from '@/entities/product';
import type { PayloadAction } from '@reduxjs/toolkit';

const initialState: RecentItemsState = {
  recentItems: [],
};

export const recentItems = createSlice({
  name: 'recentItems',
  initialState,
  reducers: {
    setRecentItems: (state, action: PayloadAction<RecentItemsProduct[]>) => {
      state.recentItems = action.payload || [];
    },
    addToRecentItems: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();
      if (!token) {
        // Remove the item if it already exists
        state.recentItems = state.recentItems.filter(
          (item) => item.id !== action.payload.id
        );

        // Add the item to the beginning of the array with current visit time
        state.recentItems.unshift({ ...action.payload, visitTime: new Date() });

        // Keep only the last 20 items
        if (state.recentItems.length > 20) {
          state.recentItems = state.recentItems.slice(0, 20);
        }

        saveToSessionStorage('recentItems', state.recentItems);
      }
    },
    removeFromRecentItems: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();
      if (!token) {
        state.recentItems = state.recentItems.filter(
          (item) => item.id !== action.payload.id
        );
        saveToSessionStorage('recentItems', state.recentItems);
      }
    },
  },
});

export const { setRecentItems, addToRecentItems, removeFromRecentItems } =
  recentItems.actions;
export default recentItems.reducer;

================
src/features/recent-items/model/types.ts
================

import type { Product } from '@/entities/product';

export interface RecentItemsProduct extends Product {
  visitTime: Date;
}

export interface RecentItemsState {
  recentItems: RecentItemsProduct[];
}

================
src/features/recent-items/ui/RecentlyVisitedSection.tsx
================

import { useSelector } from 'react-redux';
import { Navigation } from 'swiper/modules';
import { Swiper, SwiperSlide } from 'swiper/react';

import { useGetRecentItemsQuery } from '@/features/auth';
import { getTokenFromCookies } from '@/shared/lib';
import { ProductCard } from '@/widgets/product-card';

export const RecentlyVisitedSection = () => {
  const token = getTokenFromCookies();

  const { recentItems: localRecentItems } = useSelector(
    (state) => state.recentItems
  );

  // Fetching favorites from the server if the user is logged in
  const { data: serverRecentItems } = useGetRecentItemsQuery(undefined, {
    skip: !token,
  });

  const recentItems = token
    ? serverRecentItems?.data
    : localRecentItems.toReversed().slice(0, 20);

  return (
    <>
      {recentItems?.length > 0 ? (
        <div className=" bg-red py-10 slider">
          <h1 className="text-colBlack text-4xl font-semibold pb-5">
            Вы недавно смотрели
          </h1>
          <Swiper
            modules={[Navigation]}
            navigation={true}
            spaceBetween={20}
            breakpoints={{
              260: {
                slidesPerView: 2,
              },
              768: {
                slidesPerView: 3,
              },
              992: {
                slidesPerView: 4,
              },
              1200: {
                slidesPerView: 6,
              },
            }}
          >
            {recentItems?.map((el) => (
              <SwiperSlide key={el?.id}>
                <ProductCard product={el} />
              </SwiperSlide>
            ))}
          </Swiper>
        </div>
      ) : null}
    </>
  );
};

================
src/features/storage/lib/index.ts
================

export * from './storageManagement';

================
src/features/storage/lib/storageManagement.ts
================

export const saveToSessionStorage = (key: string, data: unknown): void => {
  sessionStorage.setItem(key, JSON.stringify(data));
};

export const getFromSessionStorage = (key: string): unknown => {
  const data = sessionStorage.getItem(key);
  return data ? JSON.parse(data) : null;
};
