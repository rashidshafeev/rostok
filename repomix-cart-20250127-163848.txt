This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-01-27T13:39:40.442Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

Additional Info:
----------------

================================================================
Directory Structure
================================================================
api/cartApi.ts
api/index.ts
api/types.ts
index.ts
lib/transformData.ts
model/cartSlice.ts
model/hooks/index.ts
model/hooks/useAddToCart.ts
model/hooks/useCart.ts
model/hooks/useCartSelection.ts
model/hooks/useContainerHeight.ts
model/hooks/useQuantityControl.ts
model/hooks/useRemoveFromCart.ts
model/index.ts
model/types.ts
ui/Cart.tsx
ui/components/CartDetail.tsx
ui/components/CartItem.tsx
ui/components/CartItemLine.tsx
ui/components/CartOrderInfo.tsx
ui/components/index.ts
ui/components/MobileCartItem.tsx
ui/components/MobileToCheckoutBar.tsx
ui/components/RecommendedWithSection.tsx
ui/components/SelectCartItemButton.tsx
ui/controls/AddToCartButton.tsx
ui/controls/index.ts
ui/controls/QuantityControl.tsx
ui/controls/RemoveFormCartButton.tsx
ui/index.ts

================================================================
Files
================================================================

================
File: api/cartApi.ts
================
import { api } from '@/shared/api/api';

import type {
  GetUserCartResponse,
  SendCartResponse,
  SendCartRequest,
} from './types';
import type { AdditionalServerResponseData } from '@/shared/types/AdditionalServerResponseData';
import type { ProductListRequest } from '@/shared/types/ProductListRequest';

export const cartEndpoints = api.injectEndpoints({
  endpoints: (builder) => ({
    getSuggestions: builder.mutation({
      query: (params) => ({
        url: '/api/Products/search/suggestions',
        method: 'POST',
        body: params,
      }),
    }),
    getUserCart: builder.query<GetUserCartResponse, void>({
      query: () => '/api/ProductsCart/get',
      providesTags: [{ type: 'Cart', id: 'LIST' }],
    }),
    sendCart: builder.mutation<SendCartResponse, SendCartRequest>({
      query: (data) => ({
        url: '/api/ProductsCart/set',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: (result, error, { products }) => [
        { type: 'Cart', id: 'LIST' },
        { type: 'User', id: 'DATA' },
      ],
    }),
    removeFromCart: builder.mutation<
      AdditionalServerResponseData,
      ProductListRequest
    >({
      query: (data) => ({
        url: '/api/ProductsCart/delete',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: (result, error, { products }) => [
        { type: 'Cart', id: 'LIST' },
        { type: 'User', id: 'DATA' },
      ],
    }),
    getCartShareCode: builder.mutation({
      query: () => ({
        url: '/api/ProductsCart/share/create',
        method: 'POST',
      }),
    }),
    getCartShareItemsByCode: builder.mutation({
      query: (data) => ({
        url: '/api/ProductsCart/share/get',
        method: 'POST',
        body: data,
      }),
    }),
    addSharedCart: builder.mutation({
      query: (data) => ({
        url: '/api/ProductsCart/share/add',
        method: 'POST',
        body: data,
      }),
      invalidatesTags: [
        { type: 'Cart', id: 'LIST' },
        { type: 'User', id: 'DATA' },
      ],
    }),
  }),
});

// Export hooks for cart endpoints
export const {
  useSendCartMutation,
  useGetSuggestionsMutation,
  useGetUserCartQuery,
  useRemoveFromCartMutation,
  useGetCartShareCodeMutation,
  useGetCartShareItemsByCodeMutation,
  useAddSharedCartMutation,
} = cartEndpoints;

================
File: api/index.ts
================
export * from './cartApi';
export * from './types';

================
File: api/types.ts
================
import type { ServerCartState } from '../';
import type { AdditionalServerResponseData, PriceType } from '@/shared/types';

export interface GetUserCartResponse
  extends AdditionalServerResponseData,
    ServerCartState {}

export interface SendCartPayload {
  id: number;
  quantity: number;
  selected: boolean;
}

export type SendCartRequest = SendCartPayload | { items: SendCartPayload[] };

export interface SendCartResponse extends AdditionalServerResponseData {
  data: [];
  total_amount: number;
  total_quantity: number;
}
export interface GetCartItemPriceResponse extends AdditionalServerResponseData {
  data: null | {
    item_id: number;
    price: PriceType;
  };
  total_amount: number;
  total_quantity: number;
}

export interface GetCartItemPriceRequest {
  item_id: number;
  quantity: number;
}

export interface GetCartShareLinkResponse {
  data: string;
}

================
File: index.ts
================
// Core cart functionality
export * from './model';
export * from './api';
export * from './lib/transformData';

// UI components
export * from './ui';

// Documentation: See /docs/features/cart.md for architecture overview

================
File: lib/transformData.ts
================
import type {
  ServerCartState,
  LocalCartState,
} from '@/features/cart/model/types';

export const transformServerCartToLocalCart = (
  serverCart: ServerCartState
): LocalCartState => ({
  cart: serverCart.data,
  total: serverCart.total,
  selected: serverCart.selected,
  currency: serverCart.current_currency,
});

================
File: model/cartSlice.ts
================
import { createSlice } from '@reduxjs/toolkit';

import { saveToSessionStorage } from '@/features/storage/lib';
import { getTokenFromCookies } from '@/shared/lib';

import type { LocalCartState } from './types';
import type { PriceType } from '@/entities/price';
import type { Product } from '@/entities/product';
import type { PayloadAction } from '@reduxjs/toolkit';

const initialState: LocalCartState = {
  cart: [],
  total: {
    items_count: 0,
    quantity: 0,
    price_before_discount: 0,
    discount: 0,
    price_after_discount: 0,
  },
  selected: {
    items_count: 0,
    quantity: 0,
    price_before_discount: 0,
    discount: 0,
    price_after_discount: 0,
  },
  currency: {
    code: 'RUB',
    title: 'Рубль',
    symbol: '₽',
  },
};

const updateTotals = (state: LocalCartState) => {
  let totalItemsCount = 0;
  let totalQuantity = 0;
  let totalPriceBeforeDiscount = 0;
  let totalDiscount = 0;
  let selectedItemsCount = 0;
  let selectedQuantity = 0;
  let selectedPriceBeforeDiscount = 0;
  let selectedDiscount = 0;

  state?.cart?.forEach((product) => {
    const quantity = Number(product.quantity);
    const priceBeforeDiscount = product.price.base * quantity;
    const discount = product.price.discount
      ? product.price.discount.discount_amount * quantity
      : 0;

    totalItemsCount += 1;
    totalQuantity += quantity;
    totalPriceBeforeDiscount += priceBeforeDiscount;
    totalDiscount += discount;

    if (product.selected) {
      selectedItemsCount += 1;
      selectedQuantity += quantity;
      selectedPriceBeforeDiscount += priceBeforeDiscount;
      selectedDiscount += discount;
    }
  });

  state.total = {
    items_count: totalItemsCount,
    quantity: totalQuantity,
    price_before_discount: totalPriceBeforeDiscount,
    discount: totalDiscount,
    price_after_discount: totalPriceBeforeDiscount - totalDiscount,
  };

  state.selected = {
    items_count: selectedItemsCount,
    quantity: selectedQuantity,
    price_before_discount: selectedPriceBeforeDiscount,
    discount: selectedDiscount,
    price_after_discount: selectedPriceBeforeDiscount - selectedDiscount,
  };
};

export const cartSlice = createSlice({
  name: 'cart',
  initialState,
  reducers: {
    setCart: (state, action: PayloadAction<LocalCartState>) => {
      if (!action.payload) {
        // Reset state to initial state
        state.cart = [];
        state.total = initialState.total;
        state.selected = initialState.selected;
        state.currency = initialState.currency;
      } else {
        // Update state with the payload
        state.cart = action.payload.cart;
        state.total = action.payload.total;
        state.selected = action.payload.selected;
        state.currency = action.payload.currency;
      }

      updateTotals(state);
    },
    addToCart: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();
      const product = state.cart.find((item) => item.id === action.payload.id);
      if (product) {
        product.quantity += 1;
      } else {
        const newProduct = { ...action.payload, quantity: 1, selected: false };
        state.cart.push(newProduct);
      }
      updateTotals(state);

      if (!token) {
        saveToSessionStorage('cart', state);
      }
    },
    removeFromCart: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();
      state.cart = state.cart.filter(
        (product) => product.id !== action.payload.id
      );
      updateTotals(state);

      if (!token) {
        saveToSessionStorage('cart', state);
      }
    },
    changeQuantity: (
      state,
      action: PayloadAction<{ id: number; quantity: number; price: PriceType }>
    ) => {
      const token = getTokenFromCookies();
      const product = state.cart.find((item) => item.id === action.payload.id);
      console.log('action.payload.quantity', action.payload.quantity);

      if (product) {
        if (action.payload.quantity <= 0) {
          // Remove product if quantity is 0 or negative
          state.cart = state.cart.filter(
            (item) => item.id !== action.payload.id
          );
        } else {
          // Update quantity and price
          product.quantity = action.payload.quantity;
          product.price = action.payload.price;
        }

        updateTotals(state);

        if (!token) {
          saveToSessionStorage('cart', state);
        }
      }
    },
    selectItem: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();

      const product = state.cart.find((item) => item.id === action.payload.id);
      if (product) {
        product.selected = true;
        updateTotals(state);
      }

      if (!token) {
        saveToSessionStorage('cart', state);
      }
    },
    unselectItem: (state, action: PayloadAction<Product>) => {
      const token = getTokenFromCookies();

      const product = state.cart.find((item) => item.id === action.payload.id);
      if (product) {
        product.selected = false;
        updateTotals(state);
      }

      if (!token) {
        saveToSessionStorage('cart', state);
      }
    },
  },
});

export const {
  setCart,
  addToCart,
  removeFromCart,
  changeQuantity,
  selectItem,
  unselectItem,
} = cartSlice.actions;

export default cartSlice.reducer;

================
File: model/hooks/index.ts
================
export * from './useAddToCart';
export * from './useRemoveFromCart';
export * from './useQuantityControl';
export * from './useCart';

================
File: model/hooks/useAddToCart.ts
================
import { useMemo } from 'react';

import { useDispatch } from 'react-redux';
import { toast } from 'sonner';

import { useGetCartItemPriceMutation } from '@/entities/price';
import { useSendCartMutation, addToCart } from '@/features/cart';
import { getTokenFromCookies } from '@/shared/lib';

import type { Product } from '@/entities/product';

interface UseAddToCartReturn {
  handleAddToCartClick: (e: React.MouseEvent) => Promise<void>;
  buttonState: {
    text: string;
    disabled: boolean;
    loading: boolean;
  };
}

export const useAddToCart = (product: Product): UseAddToCartReturn => {
  const dispatch = useDispatch();
  const token = getTokenFromCookies();

  const [sendCart, { isLoading: sendCartLoading }] = useSendCartMutation();
  const [getItemPrice, { isLoading: priceLoading }] =
    useGetCartItemPriceMutation();

  const handleAddToCartClick = async (e: React.MouseEvent) => {
    e.preventDefault();

    try {
      if (token) {
        const result = await sendCart({
          id: product.id,
          quantity: 1,
          selected: 0,
        });
        if ('error' in result) {
          toast.error('Failed to add product to cart');
          return;
        }
      }

      const price = await getItemPrice({ item_id: product.id });
      if ('data' in price) {
        const newProduct = { ...product, price: price.data.data.price };
        dispatch(addToCart(newProduct));
      }
    } catch (error) {
      toast.error('Failed to add product to cart');
    }
  };

  // Determine button state based on product availability
  const buttonState = useMemo(() => {
    let text = 'В корзину';
    let disabled = false;

    if (product?.availability) {
      if (product.availability.stock === 0) {
        if (product.availability.preorder === null) {
          disabled = true;
          text = 'Нет в наличии';
        } else {
          text = product.availability.preorder.formatted;
        }
      }
    } else {
      disabled = true;
      text = 'Нет в наличии';
    }

    return {
      text,
      disabled,
      loading: sendCartLoading || priceLoading,
    };
  }, [product?.availability, sendCartLoading, priceLoading]);

  return {
    handleAddToCartClick,
    buttonState,
  };
};

================
File: model/hooks/useCart.ts
================
import { useSelector } from 'react-redux';

import {
  useGetUserCartQuery,
  transformServerCartToLocalCart,
} from '@/features/cart';
import { getTokenFromCookies } from '@/shared/lib';

import type { RootState } from '@/app/providers/store';
import type { LocalCartState } from '@/features/cart';

export const useCart = () => {
  const token = getTokenFromCookies();
  const localCart = useSelector((state: RootState) => state.cart);

  const {
    data: serverCart,
    isLoading,
    isSuccess,
    error,
  } = useGetUserCartQuery(undefined, { skip: !token });

  const cart: LocalCartState =
    token && isSuccess ? transformServerCartToLocalCart(serverCart) : localCart;

  return {
    cart,
    isLoading,
    isError: !!error,
  };
};

================
File: model/hooks/useCartSelection.ts
================
import { useDispatch, useSelector } from 'react-redux';
import { useSendCartMutation } from '@/features/cart';
import { getTokenFromCookies } from '@/shared/lib';
import type { AppDispatch, RootState } from '@/app/providers/store';
import type { CartProduct, SendCartPayload } from '@/features/cart';
import { selectItem, unselectItem, removeFromCart } from '@/features/cart';

export const useCartSelection = () => {
  const token = getTokenFromCookies();
  const dispatch: AppDispatch = useDispatch();
  const [sendCart] = useSendCartMutation();

  const cart = useSelector((state: RootState) => state.cart);
  const selectedItems = cart?.cart?.filter(
    (item) => item.selected === true || item.selected.toString() === '1'
  );

  const handleSelectionChange = async (
    items: CartProduct[],
    selected: boolean
  ) => {
    const payload: SendCartPayload[] = items.map((item) => ({
      id: item.id,
      quantity: item.quantity,
      selected,
    }));

    if (token) {
      await sendCart({ items: payload });
    } else {
      items.forEach((item) =>
        dispatch(selected ? selectItem(item) : unselectItem(item))
      );
    }
  };

  const handleRemoveItems = async (items: CartProduct[]) => {
    const payload = items.map((item) => ({
      id: item.id,
      quantity: 0,
      selected: 0,
    }));

    if (token) {
      await sendCart({ items: payload });
    }
    items.forEach((item) => dispatch(removeFromCart(item)));
  };

  return {
    selectedItems,
    handleSelectionChange,
    handleRemoveItems,
  };
};

================
File: model/hooks/useContainerHeight.ts
================
import { useEffect, useRef, useState } from 'react';

interface ContainerHeight {
  height: string | number;
  ref: React.RefObject<HTMLDivElement>;
}

export const useContainerHeight = (itemCount: number, itemHeight = 138): ContainerHeight => {
  const [height, setHeight] = useState<string | number>('auto');
  const ref = useRef<HTMLDivElement>(null);
  const previousCountRef = useRef(itemCount);

  useEffect(() => {
    if (ref.current) {
      const heightChange = (itemCount - previousCountRef.current) * itemHeight;
      const newHeight = ref.current.scrollHeight + heightChange;
      setHeight(`${newHeight}px`);
      
      window.scroll({
        top: window.scrollY + heightChange,
        behavior: 'smooth',
      });
      
      previousCountRef.current = itemCount;
    }
  }, [itemCount, itemHeight]);

  useEffect(() => {
    if (ref.current) {
      setHeight('auto');
    }
  }, []);

  return {
    height,
    ref,
  };
};

================
File: model/hooks/useQuantityControl.ts
================
import { useState, useRef, useEffect } from 'react';

import { useDispatch } from 'react-redux';

import { useGetCartItemPriceMutation } from '@/entities/price';
import { useSendCartMutation } from '@/features/cart';
import { getTokenFromCookies } from '@/shared/lib';

import { changeQuantity, removeFromCart } from '../';

import type { CartProduct } from '../types';

interface UseQuantityControlProps {
  product: CartProduct;
  enableRemove?: boolean;
}

export const useQuantityControl = ({
  product,
  enableRemove = false,
}: UseQuantityControlProps) => {
  const token = getTokenFromCookies();
  const dispatch = useDispatch();
  const [quantity, setQuantity] = useState(product.quantity || 1);
  const isFirstRender = useRef(true);
  const debounceTimer = useRef<NodeJS.Timeout | null>(null);

  const [sendCart, { isLoading }] = useSendCartMutation();
  const [getItemPrice] = useGetCartItemPriceMutation();

  useEffect(() => {
    setQuantity(Number(product.quantity));
  }, [product.quantity]);

  useEffect(() => {
    if (isFirstRender.current) {
      isFirstRender.current = false;
    }

    return () => {
      if (debounceTimer.current) {
        clearTimeout(debounceTimer.current);
      }
    };
  }, []);

  const updateQuantity = async (newQuantity: number) => {
    setQuantity(newQuantity);

    if (debounceTimer.current) {
      clearTimeout(debounceTimer.current);
    }

    debounceTimer.current = setTimeout(async () => {
      try {
        if (!isFirstRender.current) {
          if (token) {
            await sendCart({
              id: product.id,
              quantity: newQuantity,
              selected: product.selected,
            });
          }

          const priceResponse = await getItemPrice({
            item_id: product.id,
            quantity: newQuantity,
          });

          dispatch(
            changeQuantity({
              id: product.id,
              quantity: newQuantity,
              price: priceResponse.data?.data?.price || product.price,
            })
          );
        }
      } catch (error) {
        console.error('Failed to update quantity:', error);
        setQuantity(product.quantity);
      }
    }, 500);
  };

  const handleIncrease = (e: React.MouseEvent) => {
    e.preventDefault();
    updateQuantity(quantity + 1);
  };

  const handleDecrease = async (e: React.MouseEvent) => {
    e.preventDefault();
    if (quantity > 1) {
      updateQuantity(quantity - 1);
    } else if (enableRemove && quantity === 1) {
      if (debounceTimer.current) {
        clearTimeout(debounceTimer.current);
      }
      if (token) {
        await sendCart({
          id: product.id,
          quantity: 0,
          selected: product.selected,
        });
      }
      dispatch(removeFromCart(product));
    }
  };

  return {
    quantity,
    isLoading,
    handleIncrease,
    handleDecrease,
    isMinQuantity: !enableRemove && quantity === 1,
  };
};

================
File: model/hooks/useRemoveFromCart.ts
================
import { useDispatch } from 'react-redux';

import { useSendCartMutation } from '@/features/cart';
import { useModal } from '@/features/modals/model/context';
import { getTokenFromCookies } from '@/shared/lib';

import { removeFromCart } from '../';

import type { Product } from '@/entities/product';

interface UseRemoveFromCartOptions {
  withConfirmation?: boolean;
}

export const useRemoveFromCart = (
  product: Product,
  options: UseRemoveFromCartOptions = {}
) => {
  const { withConfirmation = false } = options;
  const { showModal } = useModal();
  const token = getTokenFromCookies();
  const dispatch = useDispatch();

  const [sendCart, { isLoading }] = useSendCartMutation();

  const remove = async () => {
    if (token) {
      await sendCart({ id: product.id, quantity: 0, selected: 0 });
    }
    dispatch(removeFromCart(product));
  };

  const handleRemove = (e: React.MouseEvent) => {
    e.preventDefault();

    if (withConfirmation) {
      showModal({
        type: 'confirmation',
        title: 'Удаление',
        text: 'Удалить товар из корзины?',
        action: () => remove(),
        product,
      });
      return;
    }

    remove();
  };

  return {
    handleRemove,
    isLoading,
  };
};

================
File: model/index.ts
================
export * from './cartSlice';
export * from './types';
export * from './hooks';

================
File: model/types.ts
================
import type { Currency } from '@/entities/price';
import type { Product } from '@/entities/product';

export interface ServerCartState {
  data: CartProduct[];
  total: CartTotals;
  selected: CartTotals;
  current_currency: Currency;
}

export interface LocalCartState {
  cart: CartProduct[];
  total: CartTotals;
  selected: CartTotals;
  currency: Currency;
}

export interface CartProduct extends Product {
  quantity: number;
  selected: boolean;
}

export interface CartTotals {
  items_count: number;
  quantity: number;
  price_before_discount: number;
  discount: number;
  price_after_discount: number;
}

export type CartModalType = 'showSharedCart' | 'shareCart';

================
File: ui/Cart.tsx
================
import React, { useEffect, useRef, useState } from 'react';

import { useSelector } from 'react-redux';
import { useLocation } from 'react-router-dom';
import { useIntersection } from 'react-use';
import { toast } from 'sonner';

import {
  CartDetail,
  CartOrderInfo,
  MobileToCheckoutBar,
  transformServerCartToLocalCart,
} from '@/features/cart';
import { useGetUserCartQuery } from '@/features/cart/api/cartApi';
import { useModal } from '@/features/modals/model/context';
import { RecentlyVisitedSection } from '@/features/recent-items';
import ErrorEmpty from '@/helpers/Errors/ErrorEmpty';
import docIcon from '@/shared/assets/icons/download-pdf.svg';
import shareIcon from '@/shared/assets/icons/share.svg';
import { getTokenFromCookies } from '@/shared/lib';
import { scrollToTop } from '@/shared/lib/scrollToTop';
import { CSearchField } from '@/shared/ui/inputs/CSearchField';
import { Breadcrumbs } from '@/widgets/breadcrumbs';

import type { RootState } from '@/app/providers/store';
import type { LocalCartState, CartProduct } from '@/features/cart';

export const Cart = (): JSX.Element => {
  const token = getTokenFromCookies();

  const localCart: LocalCartState = useSelector(
    (state: RootState) => state.cart
  );
  const {
    data: serverCart,
    isLoading,
    isSuccess,
    error,
  } = useGetUserCartQuery(undefined, { skip: !token });

  const cart: LocalCartState =
    token && isSuccess ? transformServerCartToLocalCart(serverCart) : localCart;

  const selected: CartProduct[] = cart?.cart?.filter(
    (item) => item.selected === true || item.selected.toString() === '1'
  );

  useEffect(() => {
    scrollToTop();
  }, []);

  const [filteredCart, setFilteredCart] = useState<CartProduct[]>([]);

  const handleFilter = (event) => {
    const filterValue = event.target.value;

    const filteredCart = cart?.cart?.filter(
      (product) =>
        product.name.toLowerCase().includes(filterValue.toLowerCase()) ||
        product.groupName.toLowerCase().includes(filterValue.toLowerCase()) ||
        product.sku.toString().includes(filterValue)
    );

    setFilteredCart(filteredCart);
  };

  useEffect(() => {
    setFilteredCart(cart?.cart);
  }, [cart]);

  const orderInfo = useRef(null);
  const orderInfoVisible = useIntersection(orderInfo, {
    root: null,
    rootMargin: '0px',
    threshold: 1,
  });
  const { showModal } = useModal();

  const location = useLocation();

  useEffect(() => {
    const params = new URLSearchParams(location.search);
    const cartCode = params.get('cart');

    if (cartCode) {
      showModal({ type: 'showSharedCart', code: cartCode });
    }
  }, [location.search]);

  return (
    <div className="content pb-6 lining-nums proportional-nums">
      <Breadcrumbs />
      <h1 className="block text-2xl md:text-[40px] font-semibold text-colBlack">
        Корзина
      </h1>
      {cart?.cart?.length > 0 ? (
        <>
          <div className="hidden lg:flex justify-between items-end">
            <div className="flex max-w-[460px] w-full pt-3">
              <CSearchField
                label="Введите наименование или код товара"
                name="search"
                type="search"
                handleChange={handleFilter}
              />
            </div>
            <div className="flex justify-end items-center space-x-4 ">
              <div
                className="flex cursor-pointer"
                onClick={() => {
                  if (selected.length === 0) {
                    toast('Выберите товары, которыми хотите поделиться');
                    return;
                  }
                  showModal({ type: 'shareCart', showLink: true });
                }}
              >
                <img src={shareIcon} alt="*" />
                <span className="text-xs font-medium text-colBlack pl-2">
                  Поделиться
                </span>
              </div>
              <div className="flex cursor-pointer">
                <img src={docIcon} alt="*" />
                <span className="text-xs font-medium text-colBlack pl-2">
                  Скачать PDF заказа
                </span>
              </div>
            </div>
          </div>
          <div className="flex flex-wrap gap-10 py-5">
            <div className="lg:basis-[calc(70%-20px)] basis-full">
              <CartDetail
                cart={cart}
                isLoading={isLoading}
                filteredCart={filteredCart}
                selected={selected}
              />
            </div>

            <div
              ref={orderInfo}
              className="lg:basis-[calc(30%-20px)] basis-full"
            >
              <CartOrderInfo cart={cart} selected={selected} />
            </div>
          </div>

          {orderInfoVisible && orderInfoVisible.intersectionRatio < 1 ? (
            <MobileToCheckoutBar cart={cart} selected={selected} />
          ) : null}
        </>
      ) : null}
      {cart?.cart?.length === 0 ? (
        <ErrorEmpty
          title="Корзина пуста!"
          desc="Воспользуйтесь поиском, чтобы найти всё, что нужно."
          height="230px"
          hideBtn={true}
        />
      ) : null}
      <RecentlyVisitedSection />
    </div>
  );
};

================
File: ui/components/CartDetail.tsx
================
import type React from 'react';
import { useEffect, useRef, useState } from 'react';

import { useWindowSize } from 'react-use';
import { toast } from 'sonner';

import { useCartSelection } from '@/features/cart/model/hooks/useCartSelection';
import { useContainerHeight } from '@/features/cart/model/hooks/useContainerHeight';
import { useModal } from '@/features/modals/model/context';
import shareIcon from '@/shared/assets/icons/share.svg';
import { CCheckBoxField } from '@/shared/ui';
import { ProductCardLineSkeleton } from '@/widgets/product-card';

import { CartItem } from './CartItem';
import { CartItemLine } from './CartItemLine';
import { MobileCartItem } from './MobileCartItem';

import type { CartProduct, LocalCartState } from '@/features/cart';

type CartDetailProps = {
  cart: LocalCartState;
  isLoading: boolean;
  filteredCart: CartProduct[];
  selected: CartProduct[];
};

export const CartDetail: React.FC<CartDetailProps> = ({
  cart,
  isLoading,
  filteredCart,
  selected,
}) => {
  const { width } = useWindowSize();
  const { showModal } = useModal();
  const { handleSelectionChange, handleRemoveItems } = useCartSelection();
  const [itemType, setItemType] = useState<'lineBig' | 'lineSmall'>('lineBig');
  const { height, ref } = useContainerHeight(cart?.cart?.length || 0);

  const handleSelectAllChange = (
    event: React.ChangeEvent<HTMLInputElement>
  ) => {
    const isChecked = event.target.checked;
    const itemsToUpdate = isChecked
      ? cart?.cart?.filter((item) => !item.selected) || []
      : selected;

    handleSelectionChange(itemsToUpdate, isChecked);
  };

  const renderCartItem = (product: CartProduct) => {
    if (itemType === 'lineBig' && width > 991) {
      return (
        <CartItem product={product} isSelected={selected.includes(product)} />
      );
    }
    if (itemType === 'lineSmall' && width > 991) {
      return (
        <CartItemLine
          product={product}
          isSelected={selected.includes(product)}
        />
      );
    }
    return (
      <MobileCartItem
        product={product}
        isSelected={selected.includes(product)}
      />
    );
  };

  return (
    <>
      <div className="flex justify-between items-center pb-2">
        <div className="flex items-center">
          <div className="pb-[3px]">
            <CCheckBoxField
              label="Выбрать всё"
              onChange={handleSelectAllChange}
              checked={
                cart?.cart?.length > 0
                  ? cart?.cart?.length === selected?.length
                  : null
              }
              styles="text-colBlack font-medium text-sm"
            />
          </div>
          {selected?.length !== 0 ? (
            <button
              onClick={() => handleRemoveItems(selected)}
              className="text-colDarkGray font-medium text-sm ml-4"
            >
              Удалить выбранные
            </button>
          ) : null}
        </div>
        <div className="block lg:hidden">
          <img
            className="w-6 h-6"
            src={shareIcon}
            alt=""
            onClick={() => {
              if (selected.length === 0) {
                toast('Выберите товары, которыми хотите поделиться');
                return;
              }
              showModal({ type: 'shareCart', showLink: true });
            }}
          />
        </div>
        <div className="hidden lg:flex justify-end items-center space-x-2">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            className="cursor-pointer"
            onClick={() => setItemType('lineBig')}
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M2.33301 2.6665C1.78072 2.6665 1.33301 3.11422 1.33301 3.6665V5.6665C1.33301 6.21879 1.78072 6.6665 2.33301 6.6665H4.33301C4.88529 6.6665 5.33301 6.21879 5.33301 5.6665V3.6665C5.33301 3.11422 4.88529 2.6665 4.33301 2.6665H2.33301ZM2.33301 7.99984C1.78072 7.99984 1.33301 8.44755 1.33301 8.99984V10.9998C1.33301 11.5521 1.78072 11.9998 2.33301 11.9998H4.33301C4.88529 11.9998 5.33301 11.5521 5.33301 10.9998V8.99984C5.33301 8.44755 4.88529 7.99984 4.33301 7.99984H2.33301ZM1.33301 14.3332C1.33301 13.7809 1.78072 13.3332 2.33301 13.3332H4.33301C4.88529 13.3332 5.33301 13.7809 5.33301 14.3332V16.3332C5.33301 16.8855 4.88529 17.3332 4.33301 17.3332H2.33301C1.78072 17.3332 1.33301 16.8855 1.33301 16.3332V14.3332ZM9 2.6665C8.44772 2.6665 8 3.11422 8 3.6665V5.6665C8 6.21879 8.44772 6.6665 9 6.6665H17.6667C18.219 6.6665 18.6667 6.21879 18.6667 5.6665V3.6665C18.6667 3.11422 18.219 2.6665 17.6667 2.6665H9ZM8 9C8 8.44772 8.44772 8 9 8H17.6667C18.219 8 18.6667 8.44772 18.6667 9V11C18.6667 11.5523 18.219 12 17.6667 12H9C8.44772 12 8 11.5523 8 11V9ZM9 13.333C8.44772 13.333 8 13.7807 8 14.333V16.333C8 16.8853 8.44772 17.333 9 17.333H17.6667C18.219 17.333 18.6667 16.8853 18.6667 16.333V14.333C18.6667 13.7807 18.219 13.333 17.6667 13.333H9Z"
              fill={`${itemType === 'lineSmall' ? '#B5B5B5' : '#15765B'}`}
            />
          </svg>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            className="cursor-pointer"
            onClick={() => setItemType('lineSmall')}
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M1.33301 3.6665C1.33301 3.11422 1.78072 2.6665 2.33301 2.6665H17.6663C18.2186 2.6665 18.6663 3.11422 18.6663 3.6665V5.6665C18.6663 6.21879 18.2186 6.6665 17.6663 6.6665H2.33301C1.78072 6.6665 1.33301 6.21879 1.33301 5.6665V3.6665ZM1.33301 8.99984C1.33301 8.44755 1.78072 7.99984 2.33301 7.99984H17.6663C18.2186 7.99984 18.6663 8.44755 18.6663 8.99984V10.9998C18.6663 11.5521 18.2186 11.9998 17.6663 11.9998H2.33301C1.78072 11.9998 1.33301 11.5521 1.33301 10.9998V8.99984ZM2.33301 13.3332C1.78072 13.3332 1.33301 13.7809 1.33301 14.3332V16.3332C1.33301 16.8855 1.78072 17.3332 2.33301 17.3332H17.6663C18.2186 17.3332 18.6663 16.8855 18.6663 16.3332V14.3332C18.6663 13.7809 18.2186 13.3332 17.6663 13.3332H2.33301Z"
              fill={`${itemType === 'lineBig' ? '#B5B5B5' : '#15765B'}`}
            />
          </svg>
        </div>
      </div>
      {isLoading ? (
        <div className="flex flex-col gap-3">
          {Array.from({ length: 6 }).map((_, index) => (
            <ProductCardLineSkeleton key={index} />
          ))}
        </div>
      ) : (
        <div
          ref={ref}
          style={{ height }}
          className="transition-all duration-700"
        >
          {filteredCart.map((product) => (
            <div key={product.id}>{renderCartItem(product)}</div>
          ))}
        </div>
      )}
    </>
  );
};

================
File: ui/components/CartItem.tsx
================
import { ExpandMore } from '@mui/icons-material';
import { useDispatch } from 'react-redux';
import { NavLink, useNavigate } from 'react-router-dom';

import { QuantityControl, RemoveFromCartButton } from '@/features/cart';
import { FavoriteButton } from '@/features/favorite';
import noImg from '@/shared/assets/images/no-image.png';
import { CCheckBoxField } from '@/shared/ui/inputs';
import { DeleteIcon, FavoriteIcon } from '@/shared/ui/icons';
import { PreviewGallery, PriceDisplay } from '@/widgets/product-card';

import { SelectCartItemButton } from './SelectCartItemButton';

import type { CartProduct } from '@/features/cart/model/types';

type CartItemProps = {
  product: CartProduct;
  isSelected: boolean;
};

export const CartItem = ({
  product,
  isSelected,
}: CartItemProps): JSX.Element => {
  const navigate = useNavigate();
  const dispatch = useDispatch();

  const firstTag = Array.isArray(product.tags) && product.tags.length > 0 
    ? product.tags[0] 
    : null;

  return (
    <div className="flex border-t border-b border-[#EBEBEB] pt-2 pb-4">
      <div className="w-1/2 flex space-x-4">
        <div className="flex items-start">
          <SelectCartItemButton product={product}>
            {({ isLoading, handleSelectClick }) => (
              <CCheckBoxField
                checked={isSelected}
                onChange={handleSelectClick}
                isLoading={isLoading}
              />
            )}
          </SelectCartItemButton>
          <NavLink to={`/catalog/${product?.category?.slug}/${product?.slug}`}>
            <div>
              <PreviewGallery product={product} />
            </div>
          </NavLink>
        </div>
        <div className="pr-3">
          {firstTag && (
            <span
              style={{ color: firstTag.text_color }}
              className={`bg-[${firstTag.background_color}] py-1 px-2 uppercase text-xs font-bold rounded-xl`}
            >
              {firstTag.text}
            </span>
          )}
          <NavLink to={`/catalog/${product?.category?.slug}/${product?.slug}`}>
            <span className="font-semibold cursor-pointer text-colBlack leading-5 hover:underline line-clamp-3 break-all mt-1">
              {`${product?.groupName} ${product?.name}`}
            </span>
          </NavLink>

          <div className="space-y-1 pt-1">
            <p className="text-xs text-colDarkGray flex items-center space-x-2">
              <span>Код товара:</span>
              <span>{product?.sku}</span>
            </p>
            <div className="flex gap-x-2 flex-wrap">
              {product.attributes?.map((attribute, index) => (
                <p
                  key={index}
                  className="text-xs text-colDarkGray flex items-center space-x-1"
                >
                  <span>{attribute?.name}:</span>
                  <span className="font-semibold">
                    {attribute.color ? (
                      <div
                        style={{ backgroundColor: `${attribute.color}` }}
                        className="w-3 h-3 rounded-full border"
                      ></div>
                    ) : (
                      attribute.text
                    )}
                  </span>
                </p>
              ))}
            </div>
          </div>
          <div className="flex pt-2">
            <button className="flex items-center outline-none">
              <span className="text-sm font-semibold text-colBlack">
                С этим товаром покупают
              </span>
              <ExpandMore />
            </button>
            <div className="flex space-x-2 pl-5">
              <FavoriteButton product={product} />
              <RemoveFromCartButton product={product} withConfirmation={true} />
            </div>
          </div>
        </div>
      </div>
      <div className="w-1/2">
        <div className="grid grid-cols-3 items-center gap-4 pt-[27px]">
          <div className="text-center">
            <QuantityControl product={product} />
          </div>
          <div className="text-center font-bold text-colBlack">
            {product?.price?.total
              ? `${product?.price?.total}${product?.price?.currency?.symbol || ''}`
              : 'Цена не указана'}
          </div>
        </div>
      </div>
    </div>
  );
};

================
File: ui/components/CartItemLine.tsx
================
import { useDispatch } from 'react-redux';
import { useNavigate } from 'react-router-dom';

import { QuantityControl, RemoveFromCartButton } from '@/features/cart';
import { FavoriteButton } from '@/features/favorite';
import noImg from '@/shared/assets/images/no-image.png';
import { CCheckBoxField } from '@/shared/ui/inputs';
import { FavoriteIcon, DeleteIcon } from '@/shared/ui/icons';
import { PriceDisplay } from '@/widgets/product-card';

import { SelectCartItemButton } from './SelectCartItemButton';

import type { CartProduct } from '@/features/cart/model/types';

type CartItemLineProps = {
  product: CartProduct;
  isSelected: boolean;
};

export const CartItemLine = ({
  product,
  isSelected,
}: CartItemLineProps): JSX.Element => {
  const navigate = useNavigate();
  const dispatch = useDispatch();

  return (
    <div className="flex justify-between items-center border-t border-b border-[#EBEBEB] pt-2 pb-4">
      <div className="max-w-[480px] pr-8 w-full flex space-x-4">
        <div className="flex items-start">
          <SelectCartItemButton product={product}>
            {({ isLoading, handleSelectClick }) => (
              <CCheckBoxField
                checked={isSelected}
                onChange={handleSelectClick}
                isLoading={isLoading}
              />
            )}
          </SelectCartItemButton>
          <div
            onClick={(e) => {
              e.preventDefault();
              navigate(`/catalog/category/${product.slug}`);
            }}
            className="cursor-pointer min-w-[56px] w-14 h-14 overflow-hidden bg-gray-100 rounded-md"
          >
            <img
              className="w-full h-full object-contain"
              src={product?.files[0]?.large || noImg}
              onError={(e) => {
                e.target.onError = null;
                e.target.src = noImg;
              }}
              alt="*"
            />
          </div>
        </div>
        <div className="pr-3">
          <span
            onClick={(e) => {
              e.preventDefault();
              navigate(`/catalog/category/${product.slug}`);
            }}
            className="font-semibold cursor-pointer text-colBlack leading-5 hover:underline line-clamp-1 break-all mt-1"
          >
            {`${product?.groupName} ${product?.name}`}
          </span>
          <div className="space-y-1 pt-1">
            <p className="text-xs text-colDarkGray flex items-center space-x-2">
              <span>Код товара:</span>
              <span>{product?.sku}</span>
            </p>
          </div>
        </div>
      </div>
      <div className="flex items-center justify-between space-x-5 pt-3">
        <PriceDisplay price={product?.price} />
        <div className="flex items-center justify-between">
          <QuantityControl product={product} />
        </div>
        <div className="flex items-center text-colBlack font-bold">
          <div>
            {product?.price?.total
              ? `${product?.price?.total}${product?.price?.currency?.symbol || ''}`
              : 'Цена не указана'}
          </div>
        </div>
        <div className="flex space-x-2">
          <FavoriteButton product={product} />
          <RemoveFromCartButton product={product} withConfirmation={true} />
        </div>
      </div>
    </div>
  );
};

================
File: ui/components/CartOrderInfo.tsx
================
import type React from 'react';
import { useRef } from 'react';

import plural from 'plural-ru';
import { NavLink } from 'react-router-dom';
import { useIntersection } from 'react-use';

import { getTokenFromCookies } from '@/shared/lib';

import type { CartProduct } from '@/types/Store/Cart/CartProduct';
import type { LocalCartState } from '@/types/Store/Cart/CartState';

type CartOrderInfoProps = {
  cart: LocalCartState;
  selected: CartProduct[];
};

export const CartOrderInfo: React.FC<CartOrderInfoProps> = ({
  cart,
  selected,
}) => {
  
  const hasZeroPriceItems =
    selected.filter((item) => item.price.base === null || item.price.base === 0)
      .length > 0;

  return (
    <div className="border border-[#EBEBEB] rounded-[10px] p-5">
      {selected?.length === 0 ? (
        <div className="text-center text-[#828282] text-lg font-medium mb-5">
          Выберите товары, которые хотите заказать
        </div>
      ) : (
        <>
          <div className="flex justify-between items-center pb-3">
            <span className="text-xl font-semibold text-colBlack">Итого</span>
            <span className="text-xl font-semibold text-colBlack">
              {cart?.selected?.items_count}{' '}
              {plural(
                cart?.selected?.items_count,
                'товар',
                'товара',
                'товаров'
              )}
            </span>
          </div>
          <div className="flex justify-between items-center">
            <span className="text-colBlack text-sm whitespace-nowrap">
              Количество
            </span>
            <span className="w-full border-b border-colGray border-dashed mt-2 mx-1"></span>
            <span className="font-bold whitespace-nowrap">
              {cart?.selected?.quantity} шт
            </span>
          </div>
          {/* <div className='flex justify-between items-center pt-2'>
            <span className='text-colBlack text-sm'>Вес</span>
            <span className='w-full border-b border-colGray border-dashed mt-2 mx-1'></span>
            <span className='font-bold whitespace-nowrap'>19.5 кг</span>
          </div> */}
          <br />
          <div className="flex justify-between items-center">
            <span className="text-colBlack text-sm">Сумма</span>
            <span className="w-full border-b border-colGray border-dashed mt-2 mx-1"></span>
            <span className="font-bold whitespace-nowrap">
              {cart?.selected?.price_before_discount} {cart.currency.symbol}
            </span>
          </div>
          {cart?.selected?.discount > 0 ? (
            <div className="flex justify-between items-center pt-2">
              <span className="text-colBlack text-sm">Скидка</span>
              <span className="w-full border-b border-colGray border-dashed mt-2 mx-1"></span>
              <span className="font-bold whitespace-nowrap">
                -{cart?.selected?.discount} {cart?.currency?.symbol}
              </span>
            </div>
          ) : null}
          <div className="flex justify-between items-center pt-3 pb-5">
            <span className="text-lg font-semibold text-colBlack">Итого</span>
            <span className="text-lg font-semibold text-colBlack">
              {cart?.selected?.price_after_discount} {cart.currency.symbol}
            </span>
          </div>
        </>
      )}

      {selected?.length === 0 ? (
        <button className="text-white cursor-auto font-semibold bg-colGray rounded w-full h-[50px] flex justify-center items-center">
          Перейти к оформлению
        </button>
      ) : null}
      {selected?.length !== 0 && hasZeroPriceItems ? (
        <>
          <button className="text-white cursor-not-allowed font-semibold bg-colGray rounded w-full h-[50px] flex justify-center items-center">
            Перейти к оформлению
          </button>
          <div className="text-sm mt-2 text-center">
            Нельзя оформить заказ на товары с не указанной ценой
          </div>
        </>
      ) : null}
      {selected?.length !== 0 && !hasZeroPriceItems ? (
        <NavLink
          to="/checkout"
          className="text-white font-semibold bg-colGreen rounded w-full h-[50px] flex justify-center items-center"
        >
          Перейти к оформлению
        </NavLink>
      ) : null}
    </div>
  );
};

================
File: ui/components/index.ts
================
export * from './CartItem';
export * from './CartItemLine';
// export * from './CartItemSkeleton';
// export * from './CartItemLineSkeleton';
// export * from './MobileCartItemSkeleton';
export * from './CartOrderInfo';
export * from './CartDetail';
export * from './MobileCartItem';
export * from './MobileToCheckoutBar';
export * from './RecommendedWithSection';

================
File: ui/components/MobileCartItem.tsx
================
import { useDispatch, useSelector } from 'react-redux';
import { useNavigate } from 'react-router-dom';

import { QuantityControl, RemoveFromCartButton } from '@/features/cart';
import { FavoriteButton } from '@/features/favorite';
import noImg from '@/shared/assets/images/no-image.png';
import { DeleteIcon, FavoriteIcon } from '@/shared/ui/icons';
import { CCheckBoxField } from '@/shared/ui/inputs';
import { PriceDisplay } from '@/widgets/product-card';

import { SelectCartItemButton } from './SelectCartItemButton';

import type { CartProduct } from '@/features/cart/model/types';

type MobileCartItemProps = {
  product: CartProduct;
  isSelected: boolean;
};

export const MobileCartItem = ({
  product,
  isSelected,
}: MobileCartItemProps): JSX.Element => {
  const navigate = useNavigate();
  const dispatch = useDispatch();

  const firstTag =
    Array.isArray(product.tags) && product.tags.length > 0
      ? product.tags[0]
      : null;

  return (
    <div className="flex flex-col border-t border-b border-[#EBEBEB] pt-2 pb-4">
      <div className="flex space-x-4">
        <div className="flex items-start">
          <SelectCartItemButton product={product}>
            {({ isLoading, handleSelectClick }) => (
              <CCheckBoxField
                checked={isSelected}
                onChange={handleSelectClick}
                isLoading={isLoading}
              />
            )}
          </SelectCartItemButton>
          <div
            onClick={(e) => {
              e.preventDefault();
              navigate(`/catalog/category/${product.slug}`);
            }}
            className="cursor-pointer min-w-[112px] w-28 h-28 overflow-hidden bg-gray-100 rounded-md"
          >
            <img
              className="w-full h-full object-contain"
              src={product?.files[0]?.large || noImg}
              onError={(e) => {
                e.target.onError = null;
                e.target.src = noImg;
              }}
              alt="*"
            />
          </div>
        </div>
        <div className="pr-3">
          {firstTag ? (
            <span
              style={{ color: firstTag.text_color }}
              className={`bg-[${firstTag.background_color}] py-1 px-2 uppercase text-xs font-bold rounded-xl`}
            >
              {firstTag.text}
            </span>
          ) : null}
          <span
            onClick={(e) => {
              e.preventDefault();
              navigate(`/catalog/category/${product.slug}`);
            }}
            className="font-semibold cursor-pointer text-colBlack leading-5 hover:underline line-clamp-3 break-all mt-1"
          >
            {product?.name}
          </span>
          <div className="space-y-1 pt-1">
            <p className="text-xs text-colDarkGray flex items-center space-x-2">
              {product?.price?.discount
                ? `${product?.price?.discount?.price} ${product?.price?.currency?.symbol}/${product?.price?.unit}`
                : product?.price?.default
                  ? `${product?.price?.default} ${product?.price?.currency?.symbol}/${product?.price?.unit}`
                  : 'Не указано'}
            </p>
          </div>
          <div className="flex pt-2">
            <p className="text-xs text-colDarkGray flex items-center space-x-2">
              <span>Цвет:</span>
              <span className="w-3 h-3 min-w-[12px] bg-black rounded-full"></span>
              <span>Чёрный</span>
            </p>
          </div>
          <div className="flex pt-2">
            <p className="text-xs text-colDarkGray flex items-center space-x-2">
              <span>Можно забрать</span>
              <span className="text-colGreen">сегодня</span>
            </p>
          </div>
        </div>
      </div>
      <div className="flex items-center justify-between space-x-3 pt-[27px]">
        <div className="flex space-x-2 pl-5">
          <FavoriteButton product={product} />
          <RemoveFromCartButton product={product} />
        </div>
        <div className="flex items-center text-colBlack font-bold">
          <PriceDisplay price={product?.price} />
        </div>
        <div className="flex items-center space-x-3">
          <QuantityControl product={product} />
        </div>
      </div>
    </div>
  );
};

================
File: ui/components/MobileToCheckoutBar.tsx
================
import React from 'react';

import plural from 'plural-ru';
import { NavLink } from 'react-router-dom';

import type { CartProduct, LocalCartState } from '@/features/cart';

export type MobileToCheckoutBarProps = {
  cart: LocalCartState;
  selected: CartProduct[];
};

export const MobileToCheckoutBar = ({
  cart,
  selected,
}: MobileToCheckoutBarProps) => {
  const hasZeroPriceItems =
    selected.filter((item) => item.price.base === null || item.price.base === 0)
      .length > 0;
  return (
    <div className="lg:hidden z-10 fixed bottom-[72px] left-0 w-[100vw] bg-white">
      <div className="flex justify-between px-5 py-3">
        <div className="flex flex-col gap-2 justify-between w-full">
          <div className="flex justify-between items-center">
            {selected?.length === 0 ? (
              <div className="text-center text-[#828282] text-lg font-medium">
                Выберите товары, которые хотите заказать
              </div>
            ) : (
              <>
                <span className="text-xl font-semibold text-colBlack">
                  {cart?.selected?.price_before_discount} {cart.currency.symbol}
                </span>
                <span className="text-xl font-semibold text-colBlack">
                  {cart?.selected?.items_count}{' '}
                  {plural(
                    cart?.selected?.items_count,
                    'товар',
                    'товара',
                    'товаров'
                  )}
                </span>
              </>
            )}
          </div>
          {selected?.length === 0 ? (
            <button className="text-white cursor-auto font-semibold bg-colGray rounded w-full h-[50px] flex justify-center items-center">
              Перейти к оформлению
            </button>
          ) : null}
          {selected?.length !== 0 && hasZeroPriceItems ? (
            <>
              <button className="text-white cursor-not-allowed font-semibold bg-colGray rounded w-full h-[50px] flex justify-center items-center">
                Перейти к оформлению
              </button>
              <div className="text-sm mt-2 text-center">
                Нельзя оформить заказ на товары с не указанной ценой
              </div>
            </>
          ) : null}
          {selected?.length !== 0 && !hasZeroPriceItems ? (
            <NavLink
              to="/checkout"
              className="text-white font-semibold bg-colGreen rounded w-full h-[50px] flex justify-center items-center"
            >
              Перейти к оформлению
            </NavLink>
          ) : null}
        </div>
      </div>
    </div>
  );
};

export default MobileToCheckoutBar;

================
File: ui/components/RecommendedWithSection.tsx
================
import React, { useState } from 'react';

export const RecommendedWithSection = ({ title, content }) => {
  const [isActive, setIsActive] = useState(false);

  return (
    <div className="accordion-item">
      <div className="accordion-title" onClick={() => setIsActive(!isActive)}>
        <div>{title}</div>
        <div>{isActive ? '-' : '+'}</div>
      </div>
      {isActive ? <div className="accordion-content">{content}</div> : null}
    </div>
  );
};

================
File: ui/components/SelectCartItemButton.tsx
================
// src/helpers/SelectCartItemButton/SelectCartItemButton.jsx

import type React from 'react';

import { useDispatch, useSelector } from 'react-redux';

import {
  selectItem,
  unselectItem,
  transformServerCartToLocalCart,
  useGetUserCartQuery,
  useSendCartMutation,
} from '@/features/cart';
import { getTokenFromCookies } from '@/shared/lib';

import type { AppDispatch, RootState } from '@/app/providers/store';
import type { CartProduct, LocalCartState } from '@/features/cart';

interface SelectCartItemButtonProps {
  product: CartProduct;
  children: (props: {
    isLoading: boolean;
    isSelected: boolean;
    handleSelectClick: (e: React.MouseEvent<HTMLButtonElement>) => void;
  }) => React.ReactNode;
}

export const SelectCartItemButton: React.FC<SelectCartItemButtonProps> = ({
  product,
  children,
}) => {
  const dispatch: AppDispatch = useDispatch();
  const token = getTokenFromCookies();

  const localCart: LocalCartState = useSelector(
    (state: RootState) => state.cart
  );

  // Fetching cart data from the server if the user is logged in
  const {
    data: serverCart,
    // isLoading,
    isSuccess,
    error,
  } = useGetUserCartQuery(undefined, { skip: !token });

  const cart: LocalCartState =
    token && isSuccess ? transformServerCartToLocalCart(serverCart) : localCart;

  const [sendCart, { isLoading }] = useSendCartMutation();

  const isSelected: boolean = cart?.cart?.some(
    (item) =>
      item.id === product.id &&
      (item.selected.toString() === '1' || item.selected === true)
  );

  const handleSelectClick = (e: React.MouseEvent<HTMLButtonElement>) => {
    e.preventDefault();
    e.stopPropagation();

    if (isSelected) {
      if (token) {
        sendCart({ id: product.id, quantity: product.quantity, selected: 0 });
      }
      dispatch(unselectItem(product));
    } else {
      if (token) {
        sendCart({ id: product.id, quantity: product.quantity, selected: 1 });
      }
      dispatch(selectItem(product));
    }
  };

  return children({ isLoading, isSelected, handleSelectClick });
};

================
File: ui/controls/AddToCartButton.tsx
================
import { Button } from '@/shared/ui';
import { useAddToCart } from '@/features/cart';

import type { Product } from '@/entities/product';
import type { ButtonProps } from '@/shared/ui/button';

type AddToCartButtonProps = {
  product: Product;
} & Omit<ButtonProps, 'onClick' | 'disabled' | 'isLoading' | 'children'>;

export const AddToCartButton = ({
  product,
  className = '',
  variant = 'primary',
  size = 'md',
  fullWidth = true,
  asChild = false,
  ...props
}: AddToCartButtonProps) => {
  const { handleAddToCartClick, buttonState } = useAddToCart(product);

  return (
    <Button
      onClick={handleAddToCartClick}
      disabled={buttonState.disabled}
      isLoading={buttonState.loading}
      variant={variant}
      size={size}
      fullWidth={fullWidth}
      asChild={asChild}
      className={className}
      {...props}
    >
      {buttonState.text}
    </Button>
  );
};

================
File: ui/controls/index.ts
================
export * from './AddToCartButton';
export * from './QuantityControl';
export * from './RemoveFormCartButton';

================
File: ui/controls/QuantityControl.tsx
================
import { AddOutlined, RemoveOutlined } from '@mui/icons-material';

import { useQuantityControl } from '@/features/cart';

import type { CartProduct } from '@/features/cart';

interface QuantityControlProps {
  product: CartProduct;
  enableRemove?: boolean;
  className?: string;
}

export const QuantityControl = ({
  product,
  enableRemove = false,
  className = '',
}: QuantityControlProps) => {
  const { quantity, isLoading, handleIncrease, handleDecrease, isMinQuantity } =
    useQuantityControl({ product, enableRemove });

  return (
    <div className={`flex justify-between items-center grow ${className}`}>
      <button
        className={`${isLoading ? 'cursor-wait' : 'cursor-pointer'} w-10 h-10 bg-colLightGray rounded-full flex items-center justify-center`}
        onClick={handleDecrease}
        disabled={isMinQuantity || isLoading}
      >
        <RemoveOutlined
          className={`${isMinQuantity ? 'text-colGray' : 'text-colGreen'}`}
        />
      </button>

      <span className="text-colGreen font-semibold px-5">{quantity}</span>

      <button
        className={`${isLoading ? 'cursor-wait' : 'cursor-pointer'} w-10 h-10 bg-colLightGray rounded-full flex items-center justify-center`}
        onClick={handleIncrease}
        disabled={isLoading}
      >
        <AddOutlined className="text-colGreen" />
      </button>
    </div>
  );
};

================
File: ui/controls/RemoveFormCartButton.tsx
================
import { useRemoveFromCart } from '@/features/cart';
import { DeleteIcon } from '@/shared/ui/icons';

import type { Product } from '@/entities/product';

interface RemoveFromCartButtonProps {
  product: Product;
  withConfirmation?: boolean;
  className?: string;
}

export const RemoveFromCartButton = ({
  product,
  withConfirmation = false,
  className = '',
}: RemoveFromCartButtonProps) => {
  const { handleRemove, isLoading } = useRemoveFromCart(product, {
    withConfirmation,
  });

  return (
    <button
      onClick={handleRemove}
      disabled={isLoading}
      className={`transition-all duration-300 hover:scale-110 ${
        isLoading ? 'cursor-wait' : 'cursor-pointer'
      } ${className}`}
    >
      <DeleteIcon />
    </button>
  );
};

================
File: ui/index.ts
================
export { Cart } from './Cart';
export * from './controls';
export * from './components';
